/*********************************************************************
*
* (C) Copyright Broadcom Corporation 2001-2007
*
**********************************************************************
* @filename  ospf_trap_api.c
*
* @purpose   Ospf Trap Api functions
*
* @component Ospf Mapping Layer
*
* @comments  
*            
*
* @create    07/10/2001
*
* @author    anayar
*
* @end
*             
**********************************************************************/

/*************************************************************
                    
*************************************************************/



#include "l7_ospfinclude.h"

/*
***********************************************************************
*                     API FUNCTIONS  -  OSPF TRAPS
***********************************************************************
*/

/*---------------------------------------------------------------------------*/
/* OSPF is an event driven routing protocol, where an event can be a change  */
/* in an OSPF interface's link-level status, the expiration of an OSPF       */
/* timer or the reception of an OSPF protocol packet. Many of the actions    */
/* that OSPF takes as a result of these events will result in a change of    */
/* the routing topology. As routing topologies become large and complex      */
/* it is often difficult to locate the source of a topology change or        */
/* unpredicted routing path by polling a large number of routers. Another    */
/* approach is to notify a network manager of potentially critical OSPF      */
/* events with SNMP traps. These apis issue ospf traps by invoking the       */
/* LVL7 Trap manager which in turn calls SNMP to send the traps.             */
/*---------------------------------------------------------------------------*/

/*********************************************************************
*
* @purpose  Signifies a change in the state of an OSPF virtual interface.
*
* @param  Routerid        The ip address of the router originating the trap.
*         VirtIfAreaId    The area ID of the Virtual Interface to which
*                         this RTO is attached.
*         VirtIfNeighbor  The Neighbor Router ID to which this interface
*                         is connected.
*         VirtIfState     The Virtual Interface Hello protocol State machine state.
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes  " This trap is generated when the interface state regresses or 
*           progresses to a terminal state."
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapVirtIfStateChange(L7_uint32 routerId, L7_uint32 virtIfAreaId,
                                     L7_uint32 virtIfNeighbor, L7_uint32 virtIfState)
{
  return trapMgrVirtIfStateChange(routerId,virtIfAreaId,virtIfNeighbor,virtIfState);
}

/*********************************************************************
*
* @purpose  Signifies a change in the state of a non-virtual OSPF neighbor.
*
* @param    routerId    The ip address of the router originating the trap.
*           nbrIpAddr   The IP address this neighbor is using as this 
*                       IP Source Address.
*           intIfNum    On an interface having and IP Address, "0".  
*                                On an interface without an address, the 
*                                corresponding value of ifIndex for this
*                                interface in the Internet Standard MIB 
*                                ifTable.  This index is usually used in 
*                                an unnumbered interface as a reference to
*                                the local router's control application 
*                                interface table.
*           nbrRtrId     A 32-bit integer uniquely indentifying the neighboring
*                        router in the AS (Autonomous System).
*           nbrState     The new NBR state.  NBR states are defined in the 
*                        OSPF MIB.(pg. 126)
*
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes  " This trap is generated when the neighbor state regresses or 
*           progresses to a terminal state.  When a neighbor transitions 
*           from or to Full on non-broadcast multi-access and broadcast 
*           networks, the trap should be generated by the designated router.
*           A designated router transitioning to Down will be noted by 
*           ospfIfStateChange."
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapNbrStateChange(L7_uint32 routerId, L7_uint32 nbrIpAddr,
                                  L7_uint32 intIfNum,
                                  L7_uint32 nbrRtrId, L7_uint32 nbrState)
{
  return trapMgrNbrStateChange(routerId,nbrIpAddr,intIfNum,
                               nbrRtrId,nbrState);
}

/*********************************************************************
*
* @purpose  Signifies that there  has been a change in the state of a 
*           virtual OSPF neighbor.
*
* @param    routerId      The originator of the trap
*           virtNbrArea
*           virtNbrRtrId
*           virtNbrState  The new state
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes   " This  trap  should  be generated  when  the  neighbor
*           state regresses (e.g., goes from Attempt or Full 
*           to  1-Way  or Down)  or progresses to a terminal 
*           state (e.g., 2-Way or Full).  When an  neighbor 
*           transitions from  or  to Full on non-broadcast
*           multi-access and broadcast networks, the trap should
*           be generated  by the designated router.  A designated      
*           router transitioning to Down will be  noted  by      
*           ospfIfStateChange." 
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapVirtNbrStateChange(L7_uint32 routerId, L7_uint32 virtNbrArea,
                                      L7_uint32 virtNbrRtrId, L7_uint32 virtNbrState)
{
  return trapMgrVirtNbrStateChange(routerId,virtNbrArea,virtNbrRtrId,virtNbrState);
}

/*********************************************************************
*
* @purpose  Signifies that a packet has been received on a non-virtual 
*           interface from a router whose configuration parameters  conflict  
*           with this router's configuration parameters.
*
* @param    routerId          The originator of the trap.
*           ifIpAddress
*           intIfNum          internal interface number
*           packetSrc         The source IP Address
*           configErrorType   Type of error
*           packetType
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes   Note that the event optionMismatch should cause a trap only
*          if it prevents an adjacency from forming. 
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapIfConfigError(L7_uint32 routerId, L7_uint32 ifIpAddress,
                                 L7_uint32 intIfNum, L7_uint32 packetSrc,
                                 L7_uint32 configErrorType, L7_uint32 packetType)
{
  return trapMgrIfConfigError(routerId,ifIpAddress,intIfNum,packetSrc,
                              configErrorType,packetType);
}

/*********************************************************************
*
* @purpose  Signifies that a packet has been received on a virtual 
*           interface from a router whose configuration parameters  conflict  
*           with this router's configuration parameters.
*
* @param    routerId        The originator of the Trap
*           virtIfAreaId
*           virtIfNeighbor
*           configErrorType Type of error
*           packetType
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes   Note that the event optionMismatch should cause a trap only
*          if it prevents an adjacency from forming. 
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapVirtIfConfigError(L7_uint32 routerId, L7_uint32 virtIfAreaId,
                                     L7_uint32 virtIfNeighbor,
                                     L7_uint32 configErrorType,
                                     L7_uint32 packetType)
{
  return trapMgrVirtIfConfigError(routerId,virtIfAreaId,virtIfNeighbor,
                                  configErrorType,packetType);
}

/*********************************************************************
*
* @purpose Signifies that a packet has been received on a non-virtual
*          interface from a router whose authentication key or 
*          authentication type conflicts with this router's 
*          authentication key or authentication type.
*
* @param   routerId         The originator of the trap.
*          ifIpAddress
*          intIfNum         internal interface number
*          packetSrc        The source IP Address
*          configErrorType  authType mismatch or auth failure
*          packetType 
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes   
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapIfAuthFailure(L7_uint32 routerId, L7_uint32 ifIpAddress,
                                 L7_uint32 intIfNum, L7_uint32 packetSrc,
                                 L7_uint32 configErrorType, L7_uint32 packetType)
{
  return trapMgrIfAuthFailure(routerId,ifIpAddress,intIfNum,
                              packetSrc,configErrorType,packetType);
}

/*********************************************************************
*
* @purpose Signifies that a packet has been received on a virtual
*          interface from a router whose authentication key or 
*          authentication type conflicts with this router's 
*          authentication key or authentication type.
*
* @param   routerId         The originator of the trap.
*          virtIfAreaId
*          virtIfNeighbor
*          configErrorType  Auth type mismatch or auth failure
*          packetType
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes   
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapVirtIfAuthFailure(L7_uint32 routerId, L7_uint32 virtIfAreaId,
                                     L7_uint32 virtIfNeighbor,
                                     L7_uint32 configErrorType,
                                     L7_uint32 packetType)
{
  return trapMgrVirtIfAuthFailure(routerId,virtIfAreaId,virtIfNeighbor,
                                  configErrorType,packetType);
}

/*********************************************************************
*
* @purpose  Signifies that an OSPF packet has been received on a 
*           non-virtual interface that cannot be parsed.
*
* @param    routerId        The originator of the Trap
*           ifIpAddress
*           intIfNum        internal interface number
*           packetSrc       The source ip address
*           packetType
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes    
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapIfRxBadPacket(L7_uint32 routerId, L7_uint32 ifIpAddress,
                                 L7_uint32 intIfNum, L7_uint32 packetSrc,
                                 L7_uint32 packetType)
{
  return trapMgrIfRxBadPacket(routerId,ifIpAddress,intIfNum,
                              packetSrc,packetType);
}

/*********************************************************************
*
* @purpose  Signifies that an OSPF packet has been received on a 
*           virtual interface that cannot be parsed.
*
* @param    routerId        The originator of the trap
*           virtIfAreaId
*           virtIfNeighbor
*           packetType
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes    
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapVirtIfRxBadPacket(L7_uint32 routerId, L7_uint32 virtIfAreaId,
                                     L7_uint32 virtIfNeighbor, L7_uint32 packetType)
{
  return trapMgrVirtIfRxBadPacket(routerId,virtIfAreaId,virtIfNeighbor,packetType);
}

/*********************************************************************
*
* @purpose  Signifies than an OSPF packet has been retransmitted on a 
*           non-virtual interface.
*
* @param    routerId        The originator of the trap
*           ifIpAddress
*           intIfNum        internal interface number
*           nbrRtrId        Destination
*           packetType
*           lsdbType
*           lsdbLsid
*           lsdbRouterId
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes    All packets that may be re-transmitted  are associated 
*           with an LSDB entry.  The LS type, LS ID, and Router ID 
*           are used to identify the LSDB entry.
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapTxRetransmit(L7_uint32 routerId, L7_uint32 ifIpAddress,
                                L7_uint32 intIfNum, L7_uint32 nbrRtrId,
                                L7_uint32 packetType, L7_uint32 lsdbType,
                                L7_uint32 lsdbLsid, L7_uint32 lsdbRouterId)
{
  return trapMgrTxRetransmit(routerId,ifIpAddress,intIfNum,nbrRtrId,
                             packetType,lsdbType,lsdbLsid,lsdbRouterId);
}

/*********************************************************************
*
* @purpose  Signifies than an OSPF packet has been retransmitted on a 
*           virtual interface.
*
* @param    routerId        The originator of the trap
*           virtIfAreaId
*           virtIfNeighbor
*           packetType
*           lsdbType
*           lsdbLsid
*           lsdbRouterId
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes    All packets that may be re-transmitted  are associated 
*           with an LSDB entry.  The LS type, LS ID, and Router ID 
*           are used to identify the LSDB entry.
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapVirtTxRetransmit(L7_uint32 routerId, L7_uint32 virtIfAreaId,
                                    L7_uint32 virtIfNeighbor, L7_uint32 packetType,
                                    L7_uint32 lsdbType, L7_uint32 lsdbLsid,
                                    L7_uint32 lsdbRouterId)
{
  return trapMgrVirtTxRetransmit(routerId,virtIfAreaId,virtIfNeighbor,
                                 packetType,lsdbType,lsdbLsid,lsdbRouterId);
}

/*********************************************************************
*
* @purpose  Signifies that a  new LSA  has  been originated by this router.
*
* @param    routerId        The originator of the trap.
*           lsdbAreaId      0.0.0.0 for AS Externals
*           lsdbType
*           lsdbLsid
*           lsdbRouterId
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes    This trap should not be invoked for simple refreshes of  
*           LSAs  (which happesn every 30 minutes), but       
*           instead will only be invoked  when  an  LSA  is       
*           (re)originated due to a topology change.  Addi-       
*           tionally, this trap does not include LSAs  that       
*           are  being  flushed  because  they have reached       
*           MaxAge.
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapOriginateLsa(L7_uint32 routerId, L7_uint32 lsdbAreaId,
                                L7_uint32 lsdbType, L7_uint32 lsdbLsid,
                                L7_uint32 lsdbRouterId)
{
  return trapMgrOriginateLsa(routerId,lsdbAreaId,lsdbType,lsdbLsid,
                             lsdbRouterId);
}

/*********************************************************************
*
* @purpose  Signifies that one of the LSA in the router's link-state 
*           database has aged to MaxAge.
*
* @param    routerId         The originator of the trap
*           lsdbAreaId       0.0.0.0 for AS Externals
*           lsdbType
*           lsdbLsid
*           lsdbRouterId
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes    
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapMaxAgeLsa(L7_uint32 routerId, L7_uint32 lsdbAreaId,
                             L7_uint32 lsdbType, L7_uint32 lsdbLsid,
                             L7_uint32 lsdbRouterId)
{
  return trapMgrMaxAgeLsa(routerId,lsdbAreaId,lsdbType,lsdbLsid,
                          lsdbRouterId);
}

/*********************************************************************
*
* @purpose  Signifies that the number of LSAs in the router's link-state 
*           data-base has exceeded ospfExtLsdbLimit.
*
* @param    routerId      The originator of the trap
*           extLsdbLimit
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes    
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapLsdbOverflow(L7_uint32 routerId, L7_uint32 extLsdbLimit)
{
  return trapMgrLsdbOverflow(routerId,extLsdbLimit);
}

/*********************************************************************
*
* @purpose  Signifies that  the  number of LSAs in the router's link-
*           state database has exceeded ninety  percent  of      
*           ospfExtLsdbLimit.
*
* @param    routerId      The originator of the trap
*           extLsdbLimit
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes    
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapLsdbApproachingOverflow(L7_uint32 routerId,
                                       L7_uint32 extLsdbLimit)
{
  return trapMgrLsdbApproachingOverflow(routerId,extLsdbLimit);
}

/*********************************************************************
*
* @purpose  Signifies that there has been a change in the state of a 
*           non-virtual OSPF interface.
*
* @param    routerId      The originator of the trap
*           ifIpAddress
*           intIfNum      internal interface number
*           ifState       New state
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes   This trap should  be  generated when  the interface state 
*          regresses (e.g., goes from Dr to Down) or progresses  to  a  terminal      
*          state  (i.e.,  Point-to-Point, DR Other, Dr, or Backup).
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapIfStateChange(L7_uint32 routerId, L7_uint32 ifIpAddress,
                                 L7_uint32 intIfNum, L7_uint32 ifState)
{
  return trapMgrIfStateChange(routerId,ifIpAddress,intIfNum,ifState);
}

/*********************************************************************
*
* @purpose  Signifies that an OSPF packet was received on a non-virtual interface. 
*
* @param    
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes   
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapIfRxPacket()
{
  return trapMgrIfRxPacket();
}

/*********************************************************************
*
* @purpose  Signifies that an entry has been made in the OSPF routing table. 
*
* @param    
*
* @returns  L7_SUCCESS
* @returns  L7_FAILURE
*
* @notes    vendor proprietary Routing Table Entry Information trap.
*
* @end
*********************************************************************/
L7_RC_t ospfMapTrapRtbEntryInfo()
{
  return trapMgrRtbEntryInfo();
}

