
<HTML>
<EMWEB_IF ID="USMWEB_IF_QOS_PACKAGE">
<EMWEB_HEAD C='
    #include <stdio.h>
    #include <stdlib.h>
    #include "l7_common.h"
    #include "log.h"
    #include "web.h"
    #include "usmdb_util_api.h"
    #include "ewnet.h"

    /* ---------------------------------------------------------------------- */
    /*  diffserv_policy_summ.html                                             */
    /* ---------------------------------------------------------------------- */
    extern L7_char8 *usmWebDiffServPolicyInfoGet(L7_uint32 unit, L7_uint32  policyIndex);
    extern L7_RC_t usmWebDiffServPolicyAttrSelectFromDscpVal(L7_uint32 dscpVal, L7_uint32 *selectedVal);

    /* ---------------------------------------------------------------------- */
    /*  diffserv_cfg.html                                                     */
    /* ---------------------------------------------------------------------- */
    extern L7_char8 *usmWebGetMIBTableDetails();

    /* ---------------------------------------------------------------------- */
    /*  service_cfg.html                                                      */
    /* ---------------------------------------------------------------------- */
   extern L7_RC_t usmWebDiffservNumericRuleLimitsGet(L7_USMDB_MIB_DIFFSERV_CLASS_RULE_TYPE_t ruleType, L7_uchar8 *ruleLimits, L7_uint32 ruleLimitsLen);

 ' >


<EMWEB_IF ID=USMWEB_DIFFSERV_STATS_MODE_IS_PACKETS C='

   EwaNetHandle net;
   usmWeb_AppInfo_t appInfo;

   net = ewsContextNetHandle(ewsContext);
   if (net->app_pointer != NULL)
   {
     memcpy(&appInfo, net->app_pointer, sizeof(appInfo));
     if (appInfo.data[0] == 1)
       return "TRUE";
     else
       return NULL;
   }
   else
     return NULL;

   return NULL;

 '>
</EMWEB_IF>


<EMWEB_IF ID=USMWEB_DIFFSERV_STATS_DIRECTION_IN C='

   EwaNetHandle net;
   usmWeb_AppInfo_t appInfo;

   net = ewsContextNetHandle(ewsContext);
   if (net->app_pointer != NULL)
   {
     memcpy(&appInfo, net->app_pointer, sizeof(appInfo));
     if (appInfo.data[2] == L7_USMDB_MIB_DIFFSERV_IF_DIRECTION_IN)
       return "TRUE";
     else
       return NULL;
   }
   else
     return "TRUE";

   return NULL;

 '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_DIFFSERV_SERVICE_ALLPORTS_SUPPORTED C='

   L7_uint32 compId = L7_FLEX_QOS_DIFFSERV_COMPONENT_ID;
   L7_uint32 unit;

   unit = usmDbThisUnitGet();

   if ( (usmDbFeaturePresentCheck(unit, compId, L7_DIFFSERV_SERVICE_IN_ALLPORTS_FEATURE_ID) == L7_TRUE) ||
        (usmDbFeaturePresentCheck(unit, compId, L7_DIFFSERV_SERVICE_OUT_ALLPORTS_FEATURE_ID) == L7_TRUE) )
     return "TRUE";

   return NULL;

 '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_ETHERTYPE_KEY_IS_CUSTOM C='

  EwaNetHandle      net;
  usmWeb_AppInfo_t  appInfo;
  L7_uint32        unit;


  unit = usmDbThisUnitGet();
  net = ewsContextNetHandle(ewsContext);

  if (net->app_pointer != L7_NULL)
  {
    memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
    if (appInfo.data[4] == L7_QOS_ETYPE_KEYID_CUSTOM)   /* User Value selected as Ethertype Key */
        return "ETHERTYPE KEY IS CUSTOM";
    else
        return NULL;
  }
  return NULL;
    '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_POLICY_ATTR_SINGLEORTWORATE C='

     EwaNetHandle net;
     usmWeb_AppInfo_t appInfo;

     net = ewsContextNetHandle(ewsContext);
     if (net->app_pointer != NULL)
     {
       memcpy(&appInfo, net->app_pointer, sizeof(appInfo));
       if (appInfo.data[3] == L7_USMDB_MIB_DIFFSERV_POLICY_ATTR_TYPE_POLICE_SINGLERATE ||
           appInfo.data[3] == L7_USMDB_MIB_DIFFSERV_POLICY_ATTR_TYPE_POLICE_TWORATE)
         return "TRUE";
       else
         return NULL;
     }
     return NULL;

   '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_COLOR_MODE_AWARE C='

  EwaNetHandle net;
  usmWeb_AppInfo_t appInfo;

  net = ewsContextNetHandle(ewsContext);

  if (net->app_pointer != NULL)
  {
    memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));

    if (appInfo.data[18] == 2)
      return "TRUE";
  }

 return NULL;
    '>
</EMWEB_IF>


<EMWEB_IF ID=USMWEB_IF_CLASS_TYPE_ACL C='
  #ifdef L7_QOS_PACKAGE
  EwaNetHandle      net = ewsContextNetHandle(ewsContext);
  usmWeb_AppInfo_t  appInfo;
  L7_uint32         unit = usmDbThisUnitGet(), classIndex;
  L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_t classType;
  L7_RC_t   rc;

  if (net->app_pointer != L7_NULL)
  {
	memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));

    if (((appInfo.data[4] == 1) && (appInfo.data[7] == L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_ACL))
        || (appInfo.data[5] == 1)
        || (appInfo.data[6] == 1) || ((appInfo.data[8] == 1)))
    {
      classType = L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_ACL;
    }
    else
    {
      rc = usmDbDiffServClassTypeGet(unit, appInfo.data[2], &classType);
      if (rc!=L7_SUCCESS)
      {
         return NULL;
      }
    }

    switch(classType)
    {
      case L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_ACL:
              return "CLASS TYPE ACL";
      default:
              return NULL;
    }
  }
  else
  {
    if(usmDbDiffServClassGetNext(unit, 0, &classIndex) == L7_SUCCESS)
    {
      if((usmDbDiffServClassTypeGet(unit, classIndex, &classType) == L7_SUCCESS)
          && (classType == L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_ACL))
      {
          return "CLASS_TYPE_IS_ACL";
      }
      return NULL;
    }
  }
#endif
  return NULL;
   '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_CLASS_TYPE_IP_ACL C='
  EwaNetHandle      net;
  usmWeb_AppInfo_t  appInfo;
  L7_uint32        unit;

  unit = usmDbThisUnitGet();
  net = ewsContextNetHandle(ewsContext);
  if (net->app_pointer != L7_NULL)
  {
	memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));

    if ((appInfo.data[5] == 1)
        || ((appInfo.data[4] == 1) && (appInfo.data[7] == L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_ACL)))
    {
       return "CLASS TYPE IP ACL";
    }

  }

  return NULL;
   '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_CLASS_TYPE_MAC_ACL C='
  EwaNetHandle      net;
  usmWeb_AppInfo_t  appInfo;
  L7_uint32        unit;

  unit = usmDbThisUnitGet();
  net = ewsContextNetHandle(ewsContext);
  if (net->app_pointer != L7_NULL)
  {
	memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));

    if (appInfo.data[6] == 1)
    {
       return "CLASS TYPE MAC ACL";
    }

  }

  return NULL;
   '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_CLASS_TYPE_IPV6_ACL C='
  EwaNetHandle      net;
  usmWeb_AppInfo_t  appInfo;
  L7_uint32        unit;

  unit = usmDbThisUnitGet();
  net = ewsContextNetHandle(ewsContext);
  if (net->app_pointer != L7_NULL)
  {
	memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));

    if (appInfo.data[8] == 1)
    {
       return "CLASS TYPE IPv6 ACL";
    }

  }

  return NULL;
   '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_CLASS_TYPE_ANY_OR_ALL C='
  #ifdef L7_QOS_PACKAGE
  EwaNetHandle      net = ewsContextNetHandle(ewsContext);
  usmWeb_AppInfo_t  appInfo;
  L7_uint32         unit = usmDbThisUnitGet(), classIndex;
  L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_t classType;

  if (net->app_pointer != L7_NULL)
  {
	memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
    if ((appInfo.data[7] == L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_ANY)
        || (appInfo.data[7] == L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_ALL))
    {
      return "DISPLAY_PROTOCOL_SELECT";
    }
    else
    {
      classIndex = appInfo.data[2];
    }
  }
  else
  {
    if(usmDbDiffServClassGetNext(unit, 0, &classIndex) != L7_SUCCESS)
    {
      return NULL;
    }
  }

  if(usmDbDiffServClassTypeGet(unit, classIndex, &classType)!=L7_SUCCESS)
  {
    return NULL;
  }
  switch(classType)
  {
      case L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_ACL: return NULL;
      default: return "CLASS TYPE ALL OR ANY"; break;
  }
  #endif
  return NULL;
   '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_CLASS_LAYER3_TYPE_IPV4 C='
  #ifdef L7_QOS_PACKAGE
  EwaNetHandle      net = ewsContextNetHandle(ewsContext);
  usmWeb_AppInfo_t  appInfo;
  L7_uint32         unit = usmDbThisUnitGet(), classIndex;
  L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_t classType;
  L7_USMDB_MIB_DIFFSERV_CLASS_L3PROTOCOL_t l3Proto;

  if (net->app_pointer != L7_NULL)
  {
      memcpy(&appInfo, net->app_pointer, sizeof(appInfo));
      classIndex = appInfo.data[2];
  }
  else
  {
    if(usmDbDiffServClassGetNext(unit, 0, &classIndex) != L7_SUCCESS)
    {
      return NULL;
    }
  }

  if(usmDbDiffServClassTypeGet(unit, classIndex, &classType)!=L7_SUCCESS)
  {
    return NULL;
  }
  switch(classType)
  {
      case L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_ACL: return NULL;
      case L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_ANY:
      case L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_ALL:
        if(usmDbDiffServClassL3ProtoGet(unit, classIndex, &l3Proto) == L7_SUCCESS)
        {
          switch(l3Proto)
          {
            case L7_USMDB_MIB_DIFFSERV_CLASS_L3PROTOCOL_IPV4:
              return "Its IPv4";
            case L7_USMDB_MIB_DIFFSERV_CLASS_L3PROTOCOL_IPV6:
            default:
              return NULL;
          }
        }
        case L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_TOTAL:
        default: return "CLASS TYPE ACL";
  }
  #endif
  return NULL;
   '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_CLASS_LAYER3_TYPE_IPV6 C='
  #ifdef L7_QOS_PACKAGE
  EwaNetHandle      net = ewsContextNetHandle(ewsContext);
  usmWeb_AppInfo_t  appInfo;
  L7_uint32         unit = usmDbThisUnitGet(), classIndex;
  L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_t classType;
  L7_USMDB_MIB_DIFFSERV_CLASS_L3PROTOCOL_t l3Proto;

  if (net->app_pointer != L7_NULL)
  {
      memcpy(&appInfo, net->app_pointer, sizeof(appInfo));
      classIndex = appInfo.data[2];
  }
  else
  {
    if(usmDbDiffServClassGetNext(unit, 0, &classIndex) != L7_SUCCESS)
    {
      return NULL;
    }
  }

  if(usmDbDiffServClassTypeGet(unit, classIndex, &classType)!=L7_SUCCESS)
  {
    return NULL;
  }
  switch(classType)
  {
      case L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_ACL: return NULL;
      case L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_ANY:
      case L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_ALL:
        if(usmDbDiffServClassL3ProtoGet(unit, classIndex, &l3Proto) == L7_SUCCESS)
        {
          switch(l3Proto)
          {
            case L7_USMDB_MIB_DIFFSERV_CLASS_L3PROTOCOL_IPV6:
              return "LAYER3 IPv6 CLASS";
            case L7_USMDB_MIB_DIFFSERV_CLASS_L3PROTOCOL_IPV4:
            default:
              return NULL;
          }
        }
      case L7_USMDB_MIB_DIFFSERV_CLASS_TYPE_NONE: return NULL;
      default: return NULL;
  }
#endif
  return NULL;

   '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_CLASS_LAYER3_IPV4_IPV6_FEATURE C='
  #ifdef L7_QOS_PACKAGE
  L7_uint32         unit = usmDbThisUnitGet();
  L7_RC_t           rc = L7_FAILURE;
  L7_uint32         classId = 0;
  EwaNetHandle      net = ewsContextNetHandle(ewsContext);
  usmWeb_AppInfo_t  appInfo;
  L7_USMDB_MIB_DIFFSERV_CLASS_L3PROTOCOL_t l3Proto=0;

  if(net->app_pointer != NULL)
  {
    memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
    classId = appInfo.data[2];
  }

  if(classId == 0 || net->app_pointer == NULL)
  {
    rc = usmDbDiffServClassGetNext(unit, 0, &classId);
    if (rc != L7_SUCCESS) return NULL;
  }

  if(usmDbDiffServClassL3ProtoGet(unit, classId, &l3Proto) == L7_SUCCESS)
  {
    if(l3Proto == L7_USMDB_MIB_DIFFSERV_CLASS_L3PROTOCOL_IPV4)
    {
      if(usmDbFeaturePresentCheck(unit, L7_FLEX_QOS_DIFFSERV_COMPONENT_ID,
                                  L7_DIFFSERV_CLASS_L3PROTO_IPV4_FEATURE_ID) == L7_TRUE)
      {
        return "MATCH SUPPORTED";
      }
    }

    if(l3Proto == L7_USMDB_MIB_DIFFSERV_CLASS_L3PROTOCOL_IPV6)
    {
      if(usmDbFeaturePresentCheck(unit, L7_FLEX_QOS_DIFFSERV_COMPONENT_ID,
                                  L7_DIFFSERV_CLASS_MATCH_IPV6_MAC_FEATURE_ID) == L7_TRUE)
      {
        return "MATCH SUPPORTED";
      }
    }
  }
#endif
  return NULL;

'>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_DIFFSERV_CLASS_MATCH_CRITERIA_PRESENT VALUE="RULECHECK" C='
  #ifdef L7_QOS_PACKAGE
  EwaNetHandle        net = ewsContextNetHandle(ewsContext);
  usmWeb_AppInfo_t    appInfo;
  L7_uint32           unit = usmDbThisUnitGet();
  L7_RC_t             rc = L7_FAILURE;
  L7_uint32           classId = 0;
  L7_USMDB_MIB_DIFFSERV_CLASS_L3PROTOCOL_t l3Proto=0;
  L7_uchar8           buf[USMWEB_BUFFER_SIZE_64];

  osapiSnprintf(buf, sizeof(buf)-1, "%s", (char *) ewsContextGetValue(ewsContext));
  if (net->app_pointer != L7_NULL)
  {
    memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
    classId = appInfo.data[2];
  }

  if(classId == 0 || net->app_pointer == NULL)
  {
    rc = usmDbDiffServClassGetNext(unit, 0, &classId);
    if (rc != L7_SUCCESS) return NULL;
  }

  if(usmDbDiffServClassL3ProtoGet(unit, classId, &l3Proto) == L7_SUCCESS)
  {
    if(l3Proto == L7_USMDB_MIB_DIFFSERV_CLASS_L3PROTOCOL_IPV4)
    {
      if(osapiStrncmp(buf, "DSTL4PORT", strlen(buf))==0)
      {
        if(usmDbFeaturePresentCheck(unit, L7_FLEX_QOS_DIFFSERV_COMPONENT_ID,
                                    L7_DIFFSERV_CLASS_MATCH_DSTL4PORT_FEATURE_ID) == L7_TRUE)
        {
          return "DSTL4PORT";
        }
      }
      else if(osapiStrncmp(buf, "DSCP", strlen(buf))==0)
      {
         if(usmDbFeaturePresentCheck(unit, L7_FLEX_QOS_DIFFSERV_COMPONENT_ID,
                                L7_DIFFSERV_CLASS_MATCH_IPDSCP_FEATURE_ID) == L7_TRUE)
         {
           return "SHOW DSTL4_PORT";
         }
      }
      else if(osapiStrncmp(buf, "PROTOCOL", strlen(buf))==0)
      {
        if(usmDbFeaturePresentCheck(unit, L7_FLEX_QOS_DIFFSERV_COMPONENT_ID,
                                    L7_DIFFSERV_CLASS_MATCH_PROTOCOL_FEATURE_ID) == L7_TRUE)
        {
          return "SHOW_PROTOCOL";
        }
      }
      else if(osapiStrncmp(buf, "SRCL4PORT", strlen(buf))==0)
      {
        if(usmDbFeaturePresentCheck(unit, L7_FLEX_QOS_DIFFSERV_COMPONENT_ID,
                                    L7_DIFFSERV_CLASS_MATCH_SRCL4PORT_FEATURE_ID) == L7_TRUE)
        {
          return "SHOW SRCL4_PORT";
        }
      }
    }

    if(l3Proto == L7_USMDB_MIB_DIFFSERV_CLASS_L3PROTOCOL_IPV6)
    {
      if(osapiStrncmp(buf, "DSTL4PORT", strlen(buf))==0)
      {
        if(usmDbFeaturePresentCheck(unit, L7_FLEX_QOS_DIFFSERV_COMPONENT_ID,
                                    L7_DIFFSERV_CLASS_MATCH_IPV6_DSTL4PORT_FEATURE_ID) == L7_TRUE)
        {
          return "DSTL4PORT";
        }
      }
      else if(osapiStrncmp(buf, "DSCP", strlen(buf))==0)
      {
         if(usmDbFeaturePresentCheck(unit, L7_FLEX_QOS_DIFFSERV_COMPONENT_ID,
                                 L7_DIFFSERV_CLASS_MATCH_IPV6_IPDSCP_FEATURE_ID) == L7_TRUE)
         {
           return "SHOW DSTL4_PORT";
         }
      }
      else if(osapiStrncmp(buf, "PROTOCOL", strlen(buf))==0)
      {
        if(usmDbFeaturePresentCheck(unit, L7_FLEX_QOS_DIFFSERV_COMPONENT_ID,
                                    L7_DIFFSERV_CLASS_MATCH_IPV6_PROTOCOL_FEATURE_ID) == L7_TRUE)
        {
          return "SHOW_PROTOCOL";
        }
      }
      else if(osapiStrncmp(buf, "SRCL4PORT", strlen(buf))==0)
      {
        if(usmDbFeaturePresentCheck(unit, L7_FLEX_QOS_DIFFSERV_COMPONENT_ID,
                                    L7_DIFFSERV_CLASS_MATCH_IPV6_SRCL4PORT_FEATURE_ID) == L7_TRUE)
        {
          return "SHOW SRCL4_PORT";
        }
      }
    }
  }
#endif
  return NULL;

'>
</EMWEB_IF>
</EMWEB_IF>
</HTML>


