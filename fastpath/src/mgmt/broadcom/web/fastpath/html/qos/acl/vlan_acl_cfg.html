<EMWEB_HEAD C='
#include "acl_exports.h"
#include "dot1q_exports.h"

#ifdef L7_QOS_PACKAGE
#include "usmdb_qos_acl_api.h"
#include "usmdb_dot1q_api.h"
#include "usmdb_sim_api.h"
#endif

'>
<EMWEB_IF ID=USMWEB_IF_LVL_HDR_NOT_REQ>
<!--
/*********************************************************************
*
* (C) Copyright Broadcom Corporation 2001-2007
*
**********************************************************************
*
* @filename   vlan_acl_cfg.html
*
* @purpose    html content
*
* @comments
*
* @create     20-Dec-2006
*
* @author     dbhargava
* @end
*
**********************************************************************/
-->
</EMWEB_IF>
emweb:/USMWEB_PAGE_DTD_HEADER_GET;
<HTML>
<HEAD>
   emweb:/USMWEB_PAGE_META_DATA_GET; <!-- Style Sheet link and Meta data     -->
   <TITLE>emweb:/USMWEB_QOS_OEM_STRING_GET?1389;</TITLE>

<script type='text/javascript' language='JavaScript'>
function DisplayErrorMsg()
//******************************************************************************
//* Purpose: Display an input error message.
//* Return:  none
//******************************************************************************
{
    alert(document.forms[0].err_msg.value);
}
function CheckError()
{
   if (document.forms[0].err_flag.value == 1) {
      DisplayErrorMsg();
   }
}
function screen_refresh()
{
  document.forms[0].submit();
}
function screen_refresh_acl_typ(param)
{
  document.forms[0].acl_typ_change.value = param;
  document.forms[0].submit();
}
</script>

</HEAD>

<body CLASS="bodyframeattributes" ONLOAD = 'CheckError()'>
<form method="post" EMWEB_NAME=vlan_acl_cfg>

<!-- ----------------------------------------------------------------------- -->
<!--         Web page header                                                 -->
<!-- ----------------------------------------------------------------------- -->
 emweb:/USMWEB_QOS_PAGE_HEADER_1ST_GET?1389;   <!-- Includes page title          -->
 emweb:/USMWEB_QOS_PAGE_HEADER_2ND_GET?2709;   <!-- Includes help page link      -->

<table CLASS="tablecontent" emweb:/USMWEB_TABLE_CONTENT_ALIGN;>
<TR>
<TD class = "rowidentifierattributes">emweb:/USMWEB_QOS_GET_NLS_STRING?27060;</TD>
<TD><SELECT class="selectfield" name="vlan" size="1" EMWEB_ITERATE EMWEB_TYPE=DECIMAL_UINT ONCHANGE='screen_refresh_acl_typ(2)'>
    <option class="selectfield" value="one" SELECTED>1</option>
</select>
</TD>
</TR>

<TR>
<TD class = "rowidentifierattributes">emweb:/USMWEB_QOS_GET_NLS_STRING?1795;</TD>
<TD><SELECT class="selectfield" name="direction" size="1" EMWEB_TYPE=DECIMAL_UINT ONCHANGE='screen_refresh_acl_typ(3)'>
  <option class="selectfield" value='none'></option>
  <EMWEB_IF ID = USMWEB_FEATURE_PRESENT VALUE="ACL_VLAN_DIRECTION_INBOUND_FEATURE">
  <option class="selectfield" value='inbound'>emweb:/USMWEB_QOS_GET_NLS_STRING?27056;</option>
  </EMWEB_IF>
  <EMWEB_IF ID = USMWEB_FEATURE_PRESENT VALUE="ACL_VLAN_DIRECTION_OUTBOUND_FEATURE">
  <option class="selectfield" value='outbound'>emweb:/USMWEB_QOS_GET_NLS_STRING?27057;</option>
  </EMWEB_IF>
</select>
</TD>
</TR>

<EMWEB_IF ID=USMWEB_IF_READWRITE>
<TR>
<TD class = "rowidentifierattributes" >emweb:/USMWEB_QOS_GET_NLS_STRING?27058;</TD>
<TD><SELECT class="selectfield" name="acl_type" size="1" EMWEB_TYPE=DECIMAL_UINT ONCHANGE='screen_refresh_acl_typ(1)'>
  <option class="selectfield" value='none'></option>
  <option class="selectfield" value='ip_acl'>emweb:/USMWEB_QOS_GET_NLS_STRING?2155;</option>
  <EMWEB_IF ID = USMWEB_FEATURE_PRESENT VALUE="ACL_TYPE_MAC_FEATURE">
  <option class="selectfield" value='mac_acl'>emweb:/USMWEB_QOS_GET_NLS_STRING?27071;</option>
  </EMWEB_IF>
  <EMWEB_IF ID = USMWEB_FEATURE_PRESENT VALUE="IPV6_ACL_TYPE_FEATURE_SUPPORT">
  <option class="selectfield" value='ipv6_acl'>emweb:/USMWEB_QOS_GET_NLS_STRING?27061;</option>
  </EMWEB_IF>
</select>
</TD>
</TR>

<EMWEB_IF ID=USMWEB_IF_ACL_TYPE_IP>
<EMWEB_IF ID=USMWEB_IF_IP_ACL_CONFIGURED>
<TR>
<TD class ="rowidentifierattributes">emweb:/USMWEB_QOS_GET_NLS_STRING?2155;</TD>
<TD><SELECT class="selectfield" name="ip_acl_list" size="1" EMWEB_ITERATE EMWEB_TYPE=DECIMAL_UINT ONCHANGE='screen_refresh_acl_typ(4)'>
    <OPTION class="selectfield" value="One">1</option>
</SELECT>
</TD>
</TR>
</EMWEB_IF>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_ACL_TYPE_IPV6>
<EMWEB_IF ID=USMWEB_IF_IPV6_ACL_EXISTS>
<TR>
<TD class ="rowidentifierattributes">emweb:/USMWEB_QOS_GET_NLS_STRING?27061;</TD>
<TD><SELECT class="selectfield" name="ipv6_acl_list" size="1" EMWEB_ITERATE EMWEB_TYPE=DECIMAL_UINT ONCHANGE='screen_refresh_acl_typ(4)'>
    <option class="selectfield" value="One">1</option> 
</select>
</TD>                         
</TR>
</EMWEB_IF>
</EMWEB_IF>  
  
<EMWEB_IF ID=USMWEB_IF_ACL_TYPE_MAC>
<EMWEB_IF ID=USMWEB_IF_MAC_ACL_CONFIGURED>
<TR>
<TD class ="rowidentifierattributes">emweb:/USMWEB_QOS_GET_NLS_STRING?27071;</TD>
<TD><SELECT class="selectfield" name="mac_acl_list" size="1" EMWEB_ITERATE EMWEB_TYPE=DECIMAL_UINT ONCHANGE='screen_refresh_acl_typ(4)'>
    <option class="selectfield" value="One">1</option>
</select>
</TD>
</TR>
</EMWEB_IF>
</EMWEB_IF>

<TR>
<TD class = "rowidentifierattributes">emweb:/USMWEB_QOS_GET_NLS_STRING?27070;</TD>
<TD CLASS="rangeattributes"><INPUT class="inputfield" NAME = "sequence_nbr" size="11" maxlength="10">
<EMWEB_STRING C='
      return usmWebUnsignedIntegerRangeHelp(L7_ACL_MIN_INTF_SEQ_NUM, L7_ACL_MAX_INTF_SEQ_NUM);
       '>
</TD>
</TR>

<TR>
<td colspan=2 emweb:/USMWEB_BUTTON_ALIGN;><BR>
<input class="buttonattributes" type="submit" name="Submit" value="Submit"> &nbsp;&nbsp;
<EMWEB_IF ID=USMWEB_IF_VLAN_ACL_REMOVE_ALLOWED C='

  EwaNetHandle      net  = ewsContextNetHandle(ewsContext);
  usmWeb_AppInfo_t  appInfo;
  L7_uint32         unit  =  usmDbThisUnitGet();
  L7_uint32         aclNum, vlanId, direction;
  L7_RC_t           rc;
  
  if(net->app_pointer != L7_NULL) 
  {
    memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
    vlanId = appInfo.data[0];
    direction=appInfo.data[1];
  
    if (appInfo.data[20] == 0)
    {
      if (appInfo.data[2] == L7_ACL_TYPE_MAC)
      {
        rc = usmDbQosAclMacIndexGetFirst(unit, &aclNum);
      }
      else if (appInfo.data[2] == L7_ACL_TYPE_IPV6)
      {
        rc = usmDbQosAclNamedIndexGetFirst(unit, L7_ACL_TYPE_IPV6, &aclNum);
      }
      else
      {
        rc = usmDbQosAclNumGetFirst(unit, &aclNum);
      }
    }
    else
    {
      aclNum = appInfo.data[20];
    }
    
    if (appInfo.data[2] == L7_ACL_TYPE_MAC)
    {
      rc = usmDbQosMacAclVlanDirCheckValid(unit, aclNum, vlanId, direction);
    }
    else 
    {
      rc = usmDbQosAclVlanDirCheckValid(unit, aclNum, vlanId, direction);
    }
   
    if(rc == L7_SUCCESS)
    {
      return "ACL CONFIGURED" ;
    }
  }

  return NULL;

'>

<input class="buttonattributes" type="submit" name="Remove" value="Remove">
</EMWEB_IF>
</TD>
</TR>

</EMWEB_IF>

<TR>
<TD COLSPAN=2>
<INPUT TYPE="hidden" NAME="acl_typ_change" SIZE="2" MAXLENGTH="1" EMWEB_TYPE=DECIMAL_UINT>
<INPUT TYPE="hidden" NAME="err_flag" SIZE="16" MAXLENGTH="15" EMWEB_TYPE=DECIMAL_UINT>
<INPUT TYPE="hidden" NAME="err_msg" SIZE="128" MAXLENGTH="127" >
</TD>
</TR>

<TR>
<TD class ="rowidentifierattributes">List of Assigned ACLs</TD>
</TR>

<TR><TD COLSPAN=5>
<TABLE class="datatableattributes" emweb:/USMWEB_DATA_TABLE_ALIGN;>

<THEAD>
<TR>
  <TH class = "datatableheading" >emweb:/USMWEB_QOS_GET_NLS_STRING?27060;</TH>
  <TH class = "datatableheading" >emweb:/USMWEB_QOS_GET_NLS_STRING?1795;</TH>
  <TH class = "datatableheading" >emweb:/USMWEB_QOS_GET_NLS_STRING?27058;</TH>
  <TH class = "datatableheading" >ACL Identifier</TH>
  <TH class = "datatableheading" >emweb:/USMWEB_QOS_GET_NLS_STRING?27070;</TH>
</TR>
</THEAD>

<EMWEB_REPEAT name=vlanAclConfig EMWEB_MAX=1024 C='

  static L7_uint32 numAcl = 0;
  EwaNetHandle      net = ewsContextNetHandle(ewsContext);
  usmWeb_AppInfo_t  appInfo;
  L7_uint32 vlanId = L7_DOT1Q_DEFAULT_VLAN;
  L7_ACL_DIRECTION_t direction;

  if (net->app_pointer != L7_NULL)
  {
    memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
    vlanId = appInfo.data[0];
    direction = appInfo.data[1];
  }
  else
  {
    usmDbVlanIDGet(1, vlanId);
    direction = L7_INBOUND_ACL;
  }

  numAcl = usmWebNumVlanAclGet(vlanId, direction);
  return &numAcl;
' >

<TR>
<TD class="tabledata"><input type="TEXT" class = "rowvalue" name="vlan_id_ro" READONLY size="9" maxlength="8"></TD>
<TD class="tabledata"><input type="TEXT" class = "rowvalue" name="direction_ro" READONLY size="9" maxlength="8"></TD>
<TD class="tabledata"><input type="TEXT" class = "rowvalue" name="acl_typ_ro" READONLY size="9" maxlength="8"></TD>
<TD class="tabledata"><input type="TEXT" class = "rowvalue" name="acl_id_ro" READONLY size="61" maxlength="31"></TD>
<TD class="tabledata"><input type="TEXT" class = "rowvalue" name="sequence_nbr_ro" READONLY size="16" maxlength="15"></TD>
</TR>

</EMWEB_REPEAT>

</TABLE>
</TD></TR>

</TABLE>
<!-- ----------------------------------- -->
<!--         Web page footer             -->
<!-- ----------------------------------- -->
emweb:/USMWEB_PAGE_FOOTER_GET;

</form>
</BODY>
</HTML>



