DEVDIR=/opt/freescale/usr/local/gcc-4.0.2-glibc-2.3.6-nptl-2/powerpc-e300c3-linux/bin/powerpc-e300c3-linux-

if [ -z "$VERSAO_KERNEL" ];then
VERSAO_KERNEL=2.6.12.3-PQ2
fi

if [ -z "$KERNEL_DIR" ];then
KERNEL_DIR=$(pwd)
fi
export KERNEL_DIR

if [ -z "$INSTALL_MOD_PATH" ];then
INSTALL_MOD_PATH=$(pwd)/tmp
fi
export INSTALL_MOD_PATH

if [ "$1" == "clean" ];then
ARCH=ppc CROSS_COMPILE=$DEVDIR make clean
exit
fi

if [ "$1" == "distclean" ];then 
ARCH=ppc CROSS_COMPILE=$DEVDIR make distclean PQ2_PTIN_defconfig
exit
fi

if [ "$1" == "menuconfig" ];then
ARCH=ppc CROSS_COMPILE=$DEVDIR make menuconfig
exit
fi

if [ "$1" == "config" ];then
ARCH=ppc CROSS_COMPILE=$DEVDIR make distclean .config
exit
fi

ARCH=ppc CROSS_COMPILE=$DEVDIR make -j 4 vmlinux modules modules_install 

${DEVDIR}objcopy -S -O binary vmlinux vmlinux2

gzip -vf9 vmlinux2

./uboot-tools/mkimage -n $VERSAO_KERNEL -A ppc -O linux -T kernel -C gzip -a 00000000 -e 00000000 -d vmlinux2.gz kernelImage.z

rm vmlinux2.gz

