#!/bin/bash

version=3.11
patch=0
svnUpdate=1
compile=1

svn_username=ci-olt-switchsw
svn_password=c1-olt-switchsw

output_file=output_`date +%Y-%m-%d_%H:%M`.txt

if [ $# -ge 1 ]; then
  # Show help 
  if [ $1 == "h" -o $1 == "help" ]; then
    echo "Syntax: $0 [version] [patch] [update_svn(0/1)] [compile(0/1)]"
    exit 0;
  fi
  version=$1
fi
if [ $# -ge 2 ]; then
  patch=$2
fi
if [ $# -ge 3 ]; then
  svnUpdate=$3
  if  [ $updateSvn -ne 1 -a $updateSvn -ne 0 ]; then
    echo "Invalid Input Parameter: updateSvn=$updateSvn"
    exit -1
  fi
fi
if [ $# -ge 4 ]; then
  compile=$4
  if  [ $compile -ne 1 -a $compile -ne 0 ]; then
    echo "Invalid Input Parameter: compile=$compile"
    exit -1
  fi
fi

# Update SVN
if [ $svnUpdate -eq 1 ]; then
  echo "Updating svn..."
  cd ..
  svn update --username=$svn_username --password=$svn_password
  cd -
fi

echo "Preparing build version $version.$patch in background..."
#read -p "Do you wish to proceed? (type 'yes' to continue) " answer
#if [ $answer != 'yes' ]; then
#  echo "Aborting procedure. Good bye!"
#  exit 0;
#fi

echo "Build procedure have started..."
echo "#******************************************************#" >> $output_file
echo "# Build started at `date`        #" >> $output_file
echo "#******************************************************#" >> $output_file
sh buildFpAllInOne $version $patch 0 $compile >> $output_file &
echo "You can monitor the results at 'output.txt'. See you."

