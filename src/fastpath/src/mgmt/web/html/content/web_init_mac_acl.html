
<HTML>
<EMWEB_IF ID="USMWEB_IF_QOS_PACKAGE">
<EMWEB_HEAD C='
    #include <stdio.h>
    #include <stdlib.h>
    #include "l7_common.h"
    #include "log.h"
    #include "web.h"
    #include "ewnet.h"
    #include "usmdb_qos_acl_api.h"


    /* ---------------------------------------------------------------------- */              
    /*  mac_acl_summ.html                                                     */
    /* ---------------------------------------------------------------------- */              
    extern L7_uint32 usmWebTotalMacAclGet(L7_uint32 unit);
    extern L7_char8 *usmWebGetMacACLDetails(void);
    extern L7_char8 *usmWebMacACLInfoGet(L7_uint32 unit, L7_uint32 aclId);
    
 ' >
                          
<EMWEB_IF ID=USMWEB_IF_MAC_ACL_CREATE C='
  #ifdef L7_QOS_PACKAGE
  EwaNetHandle      net;
  usmWeb_AppInfo_t  appInfo;
  L7_uint32 aclId;
  L7_uint32        unit;

  unit = usmDbThisUnitGet();
  net = ewsContextNetHandle(ewsContext);
  if (net->app_pointer != L7_NULL)
  {
	memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
    if (appInfo.data[0] == (L7_MAX_ACL_ID + 3))  /* acl create */
        return "CREATE";
    else
        return NULL;
  }
  else
  {
    if (usmDbQosAclMacIndexGetFirst(unit, &aclId)==L7_SUCCESS)
    {
        return NULL;
    }
    else
    {
        return "CREATE";
    }
  }
     
	return "POSSIBLY CREATE";
	#endif
   '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_MAC_ACL_RULE_CREATE C='
  #ifdef L7_QOS_PACKAGE
  EwaNetHandle      net;
  usmWeb_AppInfo_t  appInfo;
  L7_uint32 aclId, ruleId;
  L7_uint32        unit;
  L7_RC_t   rc;

  unit = usmDbThisUnitGet();
  net = ewsContextNetHandle(ewsContext);
  if (net->app_pointer != L7_NULL)
  {
	memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
    if (appInfo.data[6] == 1)
    {
       rc = usmDbQosAclMacRuleGetFirst(unit, appInfo.data[0], &ruleId);
       if (rc==L7_ERROR)
       {
         return "CREATE";
       }
       else
       {
         return NULL;
       }
    }
    else
    {
      if (appInfo.data[1] == (L7_ACL_MAX_RULE_NUM + 1))  /* acl rule create */
         return "CREATE";
      else
         return NULL;
    }
  }
  else
  {
     rc = usmDbQosAclMacIndexGetFirst(unit, &aclId);
     if (rc==L7_SUCCESS)
     {
       rc = usmDbQosAclMacRuleGetFirst(unit, aclId, &ruleId);
       if (rc==L7_SUCCESS)
       {
         return NULL;
       }
       else
       {
         return "CREATE";
       }
     }
  }
     
	return "POSSIBLY CREATE";
#endif	
   '>
</EMWEB_IF>


<EMWEB_IF ID=USMWEB_IF_ACTION_PERMIT C='
  #ifdef L7_QOS_PACKAGE
  EwaNetHandle      net;
  usmWeb_AppInfo_t  appInfo;
  L7_uint32 aclId, ruleId;
  L7_uint32        unit;
  L7_RC_t   rc;
  L7_ACL_ACTION_t action;
  
  unit = usmDbThisUnitGet();
  net = ewsContextNetHandle(ewsContext);
  if (net->app_pointer != L7_NULL)
  {
	memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
    aclId = appInfo.data[0];
    ruleId = appInfo.data[1];
    if (appInfo.data[5] == 1)
    {
      action = appInfo.data[2];
    }
    else if(appInfo.data[6] ==1)
    {
        if(usmDbQosAclMacRuleGetFirst(unit, aclId, &ruleId) == L7_SUCCESS)
        {
            rc = usmDbQosAclMacRuleActionGet(unit, aclId, ruleId, &action); 
            if (rc!=L7_SUCCESS)
            {
                action =  L7_ACL_DENY;
            }     
        }
        else
        action = L7_ACL_DENY;

    }

    else
    {
      rc = usmDbQosAclMacRuleActionGet(unit, aclId, ruleId, &action); 
      if (rc!=L7_SUCCESS)
      {
        action =  L7_ACL_DENY;
      }
    }
    switch(action)
    {
      case L7_ACL_PERMIT:  
              return "PERMIT";
      case L7_ACL_DENY: 
              return NULL;
      default: 
              return NULL;
    }
  }
  rc = usmDbQosAclMacIndexGetFirst(unit, &aclId);
  rc = usmDbQosAclMacRuleGetFirst(unit, aclId, &ruleId);
  if (rc==L7_ERROR)
  {
     return NULL;
  }
  else
  {
     rc = usmDbQosAclMacRuleActionGet(unit, aclId, ruleId, &action); 
     if (rc!=L7_SUCCESS)
     {
        return NULL;
     }
     else
     {
        switch(action)
        {
         case L7_ACL_PERMIT:  
                return "PERMIT";
         case L7_ACL_DENY: 
                return NULL;
         default: 
                return NULL;
       }
      }
  }
#endif        
  return NULL;
   '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_ACL_MAC_RULE_LOGGING_ALLOWED_FOR_ACTION C='
  #ifdef L7_QOS_PACKAGE
  EwaNetHandle      net;
  usmWeb_AppInfo_t  appInfo;
  L7_uint32         aclId, ruleId;
  L7_uint32         unit;
  L7_RC_t           rc;
  L7_ACL_ACTION_t   action;
  L7_uint32         featureId;
  L7_BOOL           haveAction;
  
  haveAction = L7_FALSE;

  unit = usmDbThisUnitGet();
  net = ewsContextNetHandle(ewsContext);
  if (net->app_pointer != L7_NULL)
  {
    memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));

    aclId = appInfo.data[0];
    ruleId = appInfo.data[1];

    rc = L7_SUCCESS;

    if (appInfo.data[5] == 1)
    {
      action = appInfo.data[2];
      haveAction = L7_TRUE;
    }
    else if (appInfo.data[6] == 1)
    {
      rc = usmDbQosAclMacRuleGetFirst(unit, aclId, &ruleId);
    }
  }
  else
  {
    rc = usmDbQosAclMacIndexGetFirst(unit, &aclId);
    if (rc == L7_SUCCESS)
    {
      rc = usmDbQosAclMacRuleGetFirst(unit, aclId, &ruleId);
    }
  }
        
  if ((rc == L7_SUCCESS) && (haveAction != L7_TRUE))
  {
    rc = usmDbQosAclMacRuleActionGet(unit, aclId, ruleId, &action); 
  }

  if (rc != L7_SUCCESS)
  {
    return NULL;
  }

  switch (action)
  {
    case L7_ACL_PERMIT:  
      featureId = L7_ACL_LOG_PERMIT_FEATURE_ID;
      break;
    case L7_ACL_DENY: 
      featureId = L7_ACL_LOG_DENY_FEATURE_ID;
      break;
    default: 
      return NULL;
  }
        
  if (usmDbFeaturePresentCheck(unit, L7_FLEX_QOS_ACL_COMPONENT_ID, featureId) == L7_TRUE)
  {
    return "ACL MAC LOGGING ALLOWED";
  }
#endif        
  return NULL;
  '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_ACL_MAC_RULE_LOGGING_FEATURE_PRESENT C='
  #ifdef L7_QOS_PACKAGE
  L7_uint32        unit;
  L7_uint32        componentId;
  
  unit = usmDbThisUnitGet();
  componentId = L7_FLEX_QOS_ACL_COMPONENT_ID;

  if ((usmDbFeaturePresentCheck(unit, componentId, L7_ACL_LOG_DENY_FEATURE_ID) == L7_TRUE) ||
      (usmDbFeaturePresentCheck(unit, componentId, L7_ACL_LOG_PERMIT_FEATURE_ID) == L7_TRUE))
  {
    return "ACL MAC LOGGING PRESENT";
  }
#endif        
  return NULL;
   '>
</EMWEB_IF>
                                         
<EMWEB_IF ID=USMWEB_ACL_MAC_MIRROR_INTF_IS_SET C='
  #ifdef L7_QOS_PACKAGE
  EwaNetHandle      net;
  usmWeb_AppInfo_t  appInfo;
  L7_uint32         aclId, ruleId;
  L7_uint32         unit;
  L7_RC_t           rc;
  L7_uint32         intIfNum;
  
  unit = usmDbThisUnitGet();
  net = ewsContextNetHandle(ewsContext);
  if (net->app_pointer != L7_NULL)
  {
    memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));

    aclId = appInfo.data[0];
    ruleId = appInfo.data[1];

    rc = L7_SUCCESS;
    if (appInfo.data[6] == 1)
    {
      rc = usmDbQosAclMacRuleGetFirst(unit, aclId, &ruleId);
    }
  }
  else
  {
    rc = usmDbQosAclMacIndexGetFirst(unit, &aclId);
    if (rc == L7_SUCCESS)
    {
      rc = usmDbQosAclMacRuleGetFirst(unit, aclId, &ruleId);
    }
  }
        
  if (rc != L7_SUCCESS)
  {
    return NULL;
  }
  rc = usmDbQosAclMacRuleMirrorIntfGet(unit, aclId, ruleId, &intIfNum); 
  if (rc == L7_SUCCESS)
  {
    return "ACL MAC MIRROR IS SET";
  }
#endif        
  return NULL;
  '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_ACL_MAC_REDIRECT_INTF_IS_SET C='
  #ifdef L7_QOS_PACKAGE
  EwaNetHandle      net;
  usmWeb_AppInfo_t  appInfo;
  L7_uint32         aclId, ruleId;
  L7_uint32         unit;
  L7_RC_t           rc;
  L7_uint32         intIfNum;
  
  unit = usmDbThisUnitGet();
  net = ewsContextNetHandle(ewsContext);
  if (net->app_pointer != L7_NULL)
  {
    memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));

    aclId = appInfo.data[0];
    ruleId = appInfo.data[1];

    rc = L7_SUCCESS;
    if (appInfo.data[6] == 1)
    {
      rc = usmDbQosAclMacRuleGetFirst(unit, aclId, &ruleId);
    }
  }
  else
  {
    rc = usmDbQosAclMacIndexGetFirst(unit, &aclId);
    if (rc == L7_SUCCESS)
    {
      rc = usmDbQosAclMacRuleGetFirst(unit, aclId, &ruleId);
    }
  }
        
  if (rc != L7_SUCCESS)
  {
    return NULL;
  }
  rc = usmDbQosAclMacRuleRedirectIntfGet(unit, aclId, ruleId, &intIfNum); 
  if (rc == L7_SUCCESS)
  {
    return "ACL MAC REDIRECT IS SET";
  }
#endif        
  return NULL;
  '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_MAC_ACL_EXISTS C='
  #ifdef L7_QOS_PACKAGE
  L7_uint32 aclId;
  L7_uint32 unit;

  unit = usmDbThisUnitGet();
  if (usmDbQosAclMacIndexGetFirst(unit, &aclId)==L7_SUCCESS)
  {
        return "EXISTS";
  }
  else
  {
        return NULL;
  }
  return NULL;
  #endif
   '>
</EMWEB_IF>


<EMWEB_IF ID=USMWEB_IF_MAC_ACL_WITH_RULE_EXISTS C='
  #ifdef L7_QOS_PACKAGE
  L7_uint32 aclId, sel_rule;
  L7_uint32 unit;
  L7_BOOL rule_exists = L7_TRUE;
  L7_RC_t   rc;
  
  unit = usmDbThisUnitGet();
  rc = usmDbQosAclMacIndexGetFirst(unit, &aclId);
  if (rc == L7_SUCCESS)
  {
     rc = usmDbQosAclMacRuleGetFirst(unit, aclId, &sel_rule);
     while (rc != L7_SUCCESS)
     {
       rc = usmDbQosAclMacIndexGetNext(unit, aclId, &aclId);
       if (rc == L7_SUCCESS)
       {
         rc = usmDbQosAclMacRuleGetFirst(unit, aclId, &sel_rule);
       }
       else
       {
         rule_exists = L7_FALSE;
         break;
       }
     }
     
     if (rule_exists == L7_FALSE)
     {
         return NULL;
     }
      
     return "EXISTS";
  }
  else
  {
     return NULL;
  }
  return NULL;
  #endif
   '>
</EMWEB_IF>
</EMWEB_IF>
</HTML>





