<?xml version="1.0" encoding="UTF-8"?>

<!--
    ******************************************************
    DBAL Hard-Logic Logical Tables:
    This xml contains the hard-logic logical DB for the DBAL.
    The data is loaded to the device during init process
    ******************************************************

    DB Rules:
    *********
-->

<AppDbCatalog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../hard_logic_schema.xsd">

    <AppDB Name="INGRESS_COMPENSATION_PER_VOQ">
        <OneLineDescription>This table sets delta value per target queue</OneLineDescription>
        <AccessMethod>HARD_LOGIC</AccessMethod>
        <Maturity Level="HIGH"/>
        <AppDbInterface Type="DIRECT">
            <Key>
                <Field Name="COMPENSATION_PROFILE" Type="UINT" Size="5" Description="compensation profile"/>
                <Field Name="CORE_ID"/>
            </Key>
            <Result>
                <Field Name="HEADER_DELTA" Size="8" Type="UINT"/>
            </Result>
            <TableLabels>SCHEDULER</TableLabels>
        </AppDbInterface>
        <AppToPhyDbMapping>
            <CoreMode Mode="DPC"/>
            <FieldMapping>
                <Field Name="HEADER_DELTA">
                    <Access>
                        <Memory Name="CGM_VOQ_HEADER_COMPENSATIONm">
                            <HwField Name="VOQ_HEADER_DELTAf"/>
                        </Memory>
                    </Access>
                </Field>
            </FieldMapping>
        </AppToPhyDbMapping>
    </AppDB>
    
    <AppDB Name="INGRESS_COMPENSATION_VOQ_TO_CREDIT_CLASS_PROFILE_MAP">
        <OneLineDescription>This table contains the mapping from VOQ to credit class profile. the credit class profile is used to set compensation.</OneLineDescription>
        <AccessMethod>HARD_LOGIC</AccessMethod>
        <Maturity Level="HIGH"/>
        <AppDbInterface Type="DIRECT">
            <Key>
                <Field Name="VOQ"/>
            </Key>
            <Result>
                <Field Name="COMPENSATION_PROFILE" Type="UINT" Size="5" Description="compensation profile"/>
            </Result>
            <TableLabels>SCHEDULER</TableLabels>
        </AppDbInterface>
        <AppToPhyDbMapping>
            <CoreMode Mode="SBC"/>
            <FieldMapping>
                <Field Name="COMPENSATION_PROFILE">
                    <Access>
                        <Memory Name="CGM_VOQ_PROFILESm">
                            <EntryOffset Formula="VOQ/4" />
                            <DataOffset Formula="VOQ%4*13+6" />
                        </Memory>
                    </Access>
                </Field>
            </FieldMapping>
        </AppToPhyDbMapping>
    </AppDB>

    <AppDB Name="INGRESS_COMPENSATION_PER_HEADER_APPEND_PTR">
        <OneLineDescription>This table sets delta value per header append pointer</OneLineDescription>
        <AccessMethod>HARD_LOGIC</AccessMethod>
        <Maturity Level="HIGH"/>
        <AppDbInterface Type="DIRECT">
            <Key>
                <Field Name="HEADER_APPEND_PTR" Type="UINT" Size="8" Description="header append pointer"/>
                <Field Name="CORE_ID"/>
            </Key>
            <Result>
                <Field Name="HEADER_DELTA" Size="8" Type="UINT"/>
            </Result>
            <TableLabels>SCHEDULER</TableLabels>
        </AppDbInterface>
        <AppToPhyDbMapping>
            <CoreMode Mode="DPC"/>
            <FieldMapping>
                <Field Name="HEADER_DELTA">
                    <Access>
                        <Memory Name="CGM_HAPMm">
                            <HwField Name="HEADER_APPEND_DELTAf"/>
                        </Memory>
                    </Access>
                </Field>
            </FieldMapping>
        </AppToPhyDbMapping>
    </AppDB>

    <AppDB Name="INGRESS_COMPENSATION_PER_IN_PORT">
        <OneLineDescription>This table sets In-PP-Port Header-Compensation-Profile delta value</OneLineDescription>
        <AccessMethod>HARD_LOGIC</AccessMethod>
        <Maturity Level="HIGH"/>
        <AppDbInterface Type="DIRECT">
            <Key>
                <Field Name="PP_PORT"/>
                <Field Name="CORE_ID"/>
            </Key>
            <Result>
                <Field Name="HEADER_DELTA" Size="8" Type="UINT"/>
            </Result>
            <TableLabels>SCHEDULER CRPS</TableLabels>
        </AppDbInterface>
        <AppToPhyDbMapping>
            <CoreMode Mode="DPC"/>
            <FieldMapping>
                <Field Name="HEADER_DELTA">
                    <Access>
                        <Memory Name="CGM_IPP_HEADER_COMPENSATIONm">
                            <HwField Name="IPP_HEADER_DELTAf"/>
                        </Memory>
                    </Access>
                </Field>
            </FieldMapping>
        </AppToPhyDbMapping>
    </AppDB>

    <AppDB Name="INGRESS_COMPENSATION_SCHEDULER_ENABLERS">
        <OneLineDescription>This table enables different Schduler compensation components </OneLineDescription>
        <AccessMethod>HARD_LOGIC</AccessMethod>
        <Maturity Level="HIGH"/>
        <AppDbInterface Type="DIRECT">
            <Key>
                <Field Name="CR_PROFILE_ID" Type="UINT" Size="5" Description="credit request profile"/>
            </Key>
            <Result>
                <Field Name="TRUNCATE_ENABLE" Type="BOOL"/>
                <Field Name="VOQ_ENABLE" Type="BOOL"/>
                <Field Name="IRPP_ENABLE" Type="BOOL"/>
                <Field Name="IN_PORT_ENABLE" Type="BOOL"/>
                <Field Name="HDR_APPEND_ENABLE" Type="BOOL"/>
            </Result>
            <TableLabels>SCHEDULER</TableLabels>
        </AppDbInterface>
        <AppToPhyDbMapping>
            <CoreMode Mode="SBC"/>
            <FieldMapping>
<!--
According to CGM design doc:
 bit 0 - Header-Truncate delta 
 bit 1 - IRPP header delta 
 bit 2 - VOQ header delta 
 bit 3 - If reset, mask In-PP-Port header delta 
 bit 4 - If reset, mask Header-Append delta"
-->
                <Field Name="TRUNCATE_ENABLE">
                    <Access>
                        <Memory Name="CGM_SCH_HCMm">
                             <HwField Name="MASKf"/>
                             <DataOffset Formula="0"/>
                         </Memory>
                    </Access>
                </Field>
                <Field Name="VOQ_ENABLE">
                    <Access>
                        <Memory Name="CGM_SCH_HCMm">
                             <HwField Name="MASKf"/>
                             <DataOffset Formula="2"/>
                         </Memory>
                    </Access>
                </Field>
                <Field Name="IRPP_ENABLE">
                    <Access>
                        <Memory Name="CGM_SCH_HCMm">
                             <HwField Name="MASKf"/>
                             <DataOffset Formula="1"/>
                         </Memory>
                    </Access>
                </Field>
                <Field Name="IN_PORT_ENABLE">
                    <Access>
                        <Memory Name="CGM_SCH_HCMm">
                             <HwField Name="MASKf"/>
                             <DataOffset Formula="3"/>
                         </Memory>
                    </Access>
                </Field>
                <Field Name="HDR_APPEND_ENABLE">
                    <Access>
                        <Memory Name="CGM_SCH_HCMm">
                             <HwField Name="MASKf"/>
                             <DataOffset Formula="4"/>
                         </Memory>
                    </Access>
                </Field>
            </FieldMapping>
        </AppToPhyDbMapping>
    </AppDB>

    <AppDB Name="INGRESS_COMPENSATION_FOR_LAST_PACKET">
        <OneLineDescription>This regsiter holds total compensation value for last packet </OneLineDescription>
        <AccessMethod>HARD_LOGIC</AccessMethod>
        <Maturity Level="HIGH"/>
        <AppDbInterface Type="DIRECT">
            <Key>
                <Field Name="CORE_ID"/>
            </Key>
            <Result>
                <Field Name="TOTAL_COMPENSATION" Permission="READONLY" Size="8" Type="UINT"/>
            </Result>
            <TableLabels>SCHEDULER</TableLabels>
        </AppDbInterface>
        <AppToPhyDbMapping>
            <CoreMode Mode="DPC"/>
            <FieldMapping>
                <Field Name="TOTAL_COMPENSATION">
                    <Access>
                        <Register Name="SQM_LAST_ENQ_CMDr">
                            <HwField Name="LAST_ENQ_CMD_OMAC_DELTAf"/>
                        </Register>
                    </Access>
                </Field>
            </FieldMapping>
        </AppToPhyDbMapping>
    </AppDB>


    <AppDB Name="INGRESS_COMPENSATION_DELTA_SIGNS">
        <OneLineDescription>Configure negate for automatic compensation components </OneLineDescription>
        <AccessMethod>HARD_LOGIC</AccessMethod>
        <Maturity Level="HIGH"/>
        <AppDbInterface Type="DIRECT">
            <Key>
            </Key>
            <Result>
                <Field Name="ITPP_DELTA_NEG" Type="BOOL" Description="Configure negate for automatic compensation components "/>
                <Field Name="IRPP_DELTA_NEG" Type="BOOL" Description="Configure negate for automatic compensation components "/>
            </Result>
            <TableLabels>ITM</TableLabels>
        </AppDbInterface>
        <AppToPhyDbMapping>
            <CoreMode Mode="SBC"/>
            <FieldMapping>
                <Field Name="ITPP_DELTA_NEG" Device="J2A0">
                    <Access>
                        <Register Name="CGM_AUTO_DOC_NAME_35r">
                             <HwField Name="AUTO_DOC_NAME_39f"/>
                        </Register>
                    </Access>
                </Field>
                <Field Name="ITPP_DELTA_NEG" Device="J2B0">
                    <Access>
                        <Register Name="CGM_REG_03E7r">
                             <HwField Name="FIELD_3_3f"/>
                        </Register>
                    </Access>
                </Field>
                <Field Name="IRPP_DELTA_NEG" Device="J2A0">
                    <Access>
                        <Register Name="CGM_AUTO_DOC_NAME_35r">
                             <HwField Name="AUTO_DOC_NAME_40f"/>
                        </Register>
                    </Access>
                </Field>
                <Field Name="IRPP_DELTA_NEG" Device="J2B0">
                    <Access>
                        <Register Name="CGM_REG_03E7r">
                             <HwField Name="FIELD_4_4f"/>
                        </Register>
                    </Access>
                </Field>
            </FieldMapping>
        </AppToPhyDbMapping>
    </AppDB>

</AppDbCatalog>
