/**
 * $Id: ctest_dnx_field_kbp_sem.c,v 1.20 2018/12/5 11:45:00 gt889764 Exp $
 * $Copyright: (c) 2021 Broadcom.
 * Broadcom Proprietary and Confidential. All rights reserved.$
 *
 * \file ctest_dnx_field_kbp_sem.c
 *
 * KBP semantic testing.
 *
 * Diag verification output:
 *
 * 1. ctest field kbp_sEM type=bcm opcode_type=static
 *    - field group list stage=external
 *       ====================================================================
 *       | FIELD_GROUP                                                      |
 *       ====================================================================
 *       | FG | Name            | Type          | Stage    | Key  | Payload |
 *       | ID |                 |               |          | Size | Size    |
 *       ====================================================================
 *       | 9  | external        | EXTERNAL_TCAM | External | 112  | 32      |
 *       --------------------------------------------------------------------
 *       | 10 | external_shared | EXTERNAL_TCAM | External | 112  | 32      |
 *       ====================================================================
 *
 *    - field group info group=9
 *       =============================================================
 *       | FIELD GROUP Full Info                                     |
 *       =============================================================
 *       | ID | Name     | Type          | Stage    | Key  | Payload |
 *       |    |          |               |          | Size | Size    |
 *       =============================================================
 *       | 9  | external | EXTERNAL_TCAM | External | 112  | 32      |
 *       =============================================================
 *       =========================
 *       | Contexts for FG 9     |
 *       =========================
 *       | ID      | Name        |
 *       =========================
 *       | 15 (AT) | Ip4UcastRpf |
 *       =========================
 *       ======================================================================================================
 *       | Key & Payload Info                                                                                 |
 *       ======================================================================================================
 *       | Qualifier          | Qual | Qual | Qual   |   | Action       | Base Action       | Action | Action |
 *       |                    | Size | Size | Ranged |   |              |                   | Size   | Lsb    |
 *       |                    |      | on   |        |   |              |                   |        |        |
 *       |                    |      | Key  |        |   |              |                   |        |        |
 *       ======================================================================================================
 *       | MAC_SRC            | 48   | 48   | No     |   | ext_void_act | VOID (UDA ID: 24) | 32     | 0      |
 *       ------------------------------------------------------------------------------------------------------
 *       | L4_SRC_PORT        | 16   | 16   | Yes    |   |              |                   |        |        |
 *       ------------------------------------------------------------------------------------------------------
 *       | IN_TTL             | 8    | 8    | No     |   |              |                   |        |        |
 *       ------------------------------------------------------------------------------------------------------
 *       | ETH_1ST_TPID_EXIST | 1    | 8    | No     |   |              |                   |        |        |
 *       ------------------------------------------------------------------------------------------------------
 *       | IPV4_SIP           | 32   | 32   | No     |   |              |                   |        |        |
 *       ======================================================================================================
 *       ========================
 *       | FG Entry Info        |
 *       ========================
 *       | DB_ | Nof            |
 *       | ID  | entries        |
 *       ========================
 *       | 8   | 1              |
 *       ========================
 *
 *    - field group info group=10
 *       ====================================================================
 *       | FIELD GROUP Full Info                                            |
 *       ====================================================================
 *       | ID | Name            | Type          | Stage    | Key  | Payload |
 *       |    |                 |               |          | Size | Size    |
 *       ====================================================================
 *       | 10 | external_shared | EXTERNAL_TCAM | External | 112  | 32      |
 *       ====================================================================
 *       =========================
 *       | Contexts for FG 10    |
 *       =========================
 *       | ID      | Name        |
 *       =========================
 *       | 15 (AT) | Ip4UcastRpf |
 *       =========================
 *       ======================================================================================================
 *       | Key & Payload Info                                                                                 |
 *       ======================================================================================================
 *       | Qualifier          | Qual | Qual | Qual   |   | Action       | Base Action       | Action | Action |
 *       |                    | Size | Size | Ranged |   |              |                   | Size   | Lsb    |
 *       |                    |      | on   |        |   |              |                   |        |        |
 *       |                    |      | Key  |        |   |              |                   |        |        |
 *       ======================================================================================================
 *       | MAC_SRC            | 48   | 48   | No     |   | ext_void_act | VOID (UDA ID: 24) | 32     | 0      |
 *       ------------------------------------------------------------------------------------------------------
 *       | L4_SRC_PORT        | 16   | 16   | Yes    |   |              |                   |        |        |
 *       ------------------------------------------------------------------------------------------------------
 *       | IN_TTL             | 8    | 8    | No     |   |              |                   |        |        |
 *       ------------------------------------------------------------------------------------------------------
 *       | ETH_1ST_TPID_EXIST | 1    | 8    | No     |   |              |                   |        |        |
 *       ------------------------------------------------------------------------------------------------------
 *       | IPV4_SIP           | 32   | 32   | No     |   |              |                   |        |        |
 *       ======================================================================================================
 *       ========================
 *       | FG Entry Info        |
 *       ========================
 *       | DB_ | Nof            |
 *       | ID  | entries        |
 *       ========================
 *       | 9   | 1              |
 *       ========================
 *
 *    - field context list stage=external
 *       ==========================================================================================================
 *       | CONTEXT                                                                                                |
 *       ==========================================================================================================
 *       | CTX ID  | Stage    | Name              | Presel IDs               | Presel(Value) | Mode               |
 *       ==========================================================================================================
 *       | 1 (AT)  | External | L2                | No hit - FWD ctx chosen! | -             | Predefined Apptype |
 *       ----------------------------------------------------------------------------------------------------------
 *       | 7 (AT)  | External | Mpls              | No hit - FWD ctx chosen! | -             | Predefined Apptype |
 *       ----------------------------------------------------------------------------------------------------------
 *       | 12 (AT) | External | TrafficManagement | No hit - FWD ctx chosen! | -             | Predefined Apptype |
 *       ----------------------------------------------------------------------------------------------------------
 *       | 15 (AT) | External | Ip4UcastRpf       | No hit - FWD ctx chosen! | -             | Predefined Apptype |
 *       ----------------------------------------------------------------------------------------------------------
 *       | 16 (AT) | External | Ip6UcastRpf       | No hit - FWD ctx chosen! | -             | Predefined Apptype |
 *       ----------------------------------------------------------------------------------------------------------
 *       | 17 (AT) | External | Ip4McastRpf       | No hit - FWD ctx chosen! | -             | Predefined Apptype |
 *       ----------------------------------------------------------------------------------------------------------
 *       | 19 (AT) | External | Ip6McastRpf       | No hit - FWD ctx chosen! | -             | Predefined Apptype |
 *       ==========================================================================================================
 *
 *    - field context info context=15 stage=external
 *       ==========================================================================================================
 *       | CONTEXT                                                                                                |
 *       ==========================================================================================================
 *       | CTX ID  | Stage    | Name        | Presel IDs               | Presel(Value) | Mode               | Key |
 *       |         |          |             |                          |               |                    | Gen |
 *       |         |          |             |                          |               |                    | Var |
 *       ==========================================================================================================
 *       | 15 (AT) | External | Ip4UcastRpf | No hit - FWD ctx chosen! | -             | Predefined Apptype | N/A |
 *       ==========================================================================================================
 *       ==============================
 *       | KBP Info                   |
 *       ==============================
 *       | Opcode | FWD     | ACL     |
 *       | Id     | Context | Context |
 *       ==============================
 *       | 3      | 10      | 10      |
 *       ==============================
 *       ===============================
 *       | Attached FGs and Lookup Ids |
 *       ===============================
 *       | FG ID     | fg | fg         |
 *       |           | 9  | 10         |
 *       ===============================
 *       | LOOKUP_ID | 2  | 3          |
 *       ===============================
 *       =================================================================
 *       | FFC Groups                                                    |
 *       =================================================================
 *       | FFC Group ID (Types)           | Used FFC Id's         | NOF  |
 *       |                                |                       | Free |
 *       |                                |                       | FFCs |
 *       =================================================================
 *       | 1 (MetaData/LayerReord/Header) | 10, 11, 12, 13, 30, 5 | 32   |
 *       =================================================================
 *       ====================================================================================
 *       | Master Key Info                                                                  |
 *       ====================================================================================
 *       | Qualifier          | Key | Lsb | Size | Size | Segment Name         | Used by    |
 *       |                    |     |     |      | on   |                      | FGs        |
 *       |                    |     |     |      | Key  |                      |            |
 *       ====================================================================================
 *       | MAC_SRC            | C   | 80  | 48   | 48   | MAC_SRC:0:0:0        | 9, 10      |
 *       ------------------------------------------------------------------------------------
 *       | L4_SRC_PORT        | C   | 128 | 16   | 16   | L4_SRC_PORT:0:0:0    | 9, 10      |
 *       ------------------------------------------------------------------------------------
 *       | IN_TTL             | C   | 144 | 8    | 8    | IN_TTL:2:65535:65535 | 9, 10      |
 *       ------------------------------------------------------------------------------------
 *       | ETH_1ST_TPID_EXIST | C   | 152 | 1    | 8    | ETH_1ST_TPID_EXIST:5 | 9, 10      |
 *       ------------------------------------------------------------------------------------
 *       | IPV4_SIP           | A   | 112 | 32   | 32   | IPV4_SIP             | FWD, 9, 10 |
 *       ====================================================================================
 *
 *    - field attach info context=15 group=9
 *       =====================================================================================================================
 *       | Key & Payload Info                                                                                                |
 *       =====================================================================================================================
 *       | Qual               | Qual | Input Type           | Input | Input  |   | Action       | Action | Action | Polarity |
 *       |                    | Size |                      | Arg   | Offset |   |              | Size   | Lsb    |          |
 *       =====================================================================================================================
 *       | MAC_SRC            | 48   | LayerFwd             | 0     | 0      |   | ext_void_act | 32     | 0      | N/A      |
 *       ---------------------------------------------------------------------------------------------------------------------
 *       | L4_SRC_PORT        | 16   | LayerFwd             | 0     | 0      |   |              |        |        |          |
 *       ---------------------------------------------------------------------------------------------------------------------
 *       | IN_TTL             | 8    | MetaData             | -     | -      |   |              |        |        |          |
 *       ---------------------------------------------------------------------------------------------------------------------
 *       | ETH_1ST_TPID_EXIST | 1    | LayerRecordsAbsolute | 0     | 0      |   |              |        |        |          |
 *       ---------------------------------------------------------------------------------------------------------------------
 *       | IPV4_SIP           | 32   | LayerFwd             | 0     | 0      |   |              |        |        |          |
 *       =====================================================================================================================
 *       ========================
 *       | Payload Info         |
 *       ========================
 *       | Payload | Payload    |
 *       | ID      | offset     |
 *       |         | (lsb of    |
 *       |         | payload    |
 *       |         | from       |
 *       |         | lsb of     |
 *       |         | buffer)    |
 *       ========================
 *       | 2       | 120        |
 *       ========================
 *       ===================================================
 *       | FFC Info                                        |
 *       ===================================================
 *       | FWD     | ACL     | FFC ID | Qual Type          |
 *       | Context | Context |        |                    |
 *       ===================================================
 *       | 10      | 10      | FFC 10 | MAC_SRC            |
 *       |         |         | FFC 11 | MAC_SRC            |
 *       |         |         | FFC 12 | L4_SRC_PORT        |
 *       |         |         | FFC 13 | IN_TTL             |
 *       |         |         | FFC 30 | ETH_1ST_TPID_EXIST |
 *       |         |         | FFC 5  | IPV4_SIP           |
 *       ===================================================
 *       ====================================================================================
 *       | Master Key Info                                                                  |
 *       ====================================================================================
 *       | Qualifier          | Key | Lsb | Size | Size | Segment Name         | Used by    |
 *       |                    |     |     |      | on   |                      | FGs        |
 *       |                    |     |     |      | Key  |                      |            |
 *       ====================================================================================
 *       | MAC_SRC            | C   | 80  | 48   | 48   | MAC_SRC:0:0:0        | 9, 10      |
 *       ------------------------------------------------------------------------------------
 *       | L4_SRC_PORT        | C   | 128 | 16   | 16   | L4_SRC_PORT:0:0:0    | 9, 10      |
 *       ------------------------------------------------------------------------------------
 *       | IN_TTL             | C   | 144 | 8    | 8    | IN_TTL:2:65535:65535 | 9, 10      |
 *       ------------------------------------------------------------------------------------
 *       | ETH_1ST_TPID_EXIST | C   | 152 | 1    | 8    | ETH_1ST_TPID_EXIST:5 | 9, 10      |
 *       ------------------------------------------------------------------------------------
 *       | IPV4_SIP           | A   | 112 | 32   | 32   | IPV4_SIP             | FWD, 9, 10 |
 *       ====================================================================================
 *
 *    - field attach info context=15 group=10
 *       =====================================================================================================================
 *       | Key & Payload Info                                                                                                |
 *       =====================================================================================================================
 *       | Qual               | Qual | Input Type           | Input | Input  |   | Action       | Action | Action | Polarity |
 *       |                    | Size |                      | Arg   | Offset |   |              | Size   | Lsb    |          |
 *       =====================================================================================================================
 *       | MAC_SRC            | 48   | LayerFwd             | 0     | 0      |   | ext_void_act | 32     | 0      | N/A      |
 *       ---------------------------------------------------------------------------------------------------------------------
 *       | L4_SRC_PORT        | 16   | LayerFwd             | 0     | 0      |   |              |        |        |          |
 *       ---------------------------------------------------------------------------------------------------------------------
 *       | IN_TTL             | 8    | MetaData             | -     | -      |   |              |        |        |          |
 *       ---------------------------------------------------------------------------------------------------------------------
 *       | ETH_1ST_TPID_EXIST | 1    | LayerRecordsAbsolute | 0     | 0      |   |              |        |        |          |
 *       ---------------------------------------------------------------------------------------------------------------------
 *       | IPV4_SIP           | 32   | LayerFwd             | 0     | 0      |   |              |        |        |          |
 *       =====================================================================================================================
 *       ========================
 *       | Payload Info         |
 *       ========================
 *       | Payload | Payload    |
 *       | ID      | offset     |
 *       |         | (lsb of    |
 *       |         | payload    |
 *       |         | from       |
 *       |         | lsb of     |
 *       |         | buffer)    |
 *       ========================
 *       | 3       | 88         |
 *       ========================
 *       ===================================================
 *       | FFC Info                                        |
 *       ===================================================
 *       | FWD     | ACL     | FFC ID | Qual Type          |
 *       | Context | Context |        |                    |
 *       ===================================================
 *       | 10      | 10      | FFC 10 | MAC_SRC            |
 *       |         |         | FFC 11 | MAC_SRC            |
 *       |         |         | FFC 12 | L4_SRC_PORT        |
 *       |         |         | FFC 13 | IN_TTL             |
 *       |         |         | FFC 30 | ETH_1ST_TPID_EXIST |
 *       |         |         | FFC 5  | IPV4_SIP           |
 *       ===================================================
 *       ====================================================================================
 *       | Master Key Info                                                                  |
 *       ====================================================================================
 *       | Qualifier          | Key | Lsb | Size | Size | Segment Name         | Used by    |
 *       |                    |     |     |      | on   |                      | FGs        |
 *       |                    |     |     |      | Key  |                      |            |
 *       ====================================================================================
 *       | MAC_SRC            | C   | 80  | 48   | 48   | MAC_SRC:0:0:0        | 9, 10      |
 *       ------------------------------------------------------------------------------------
 *       | L4_SRC_PORT        | C   | 128 | 16   | 16   | L4_SRC_PORT:0:0:0    | 9, 10      |
 *       ------------------------------------------------------------------------------------
 *       | IN_TTL             | C   | 144 | 8    | 8    | IN_TTL:2:65535:65535 | 9, 10      |
 *       ------------------------------------------------------------------------------------
 *       | ETH_1ST_TPID_EXIST | C   | 152 | 1    | 8    | ETH_1ST_TPID_EXIST:5 | 9, 10      |
 *       ------------------------------------------------------------------------------------
 *       | IPV4_SIP           | A   | 112 | 32   | 32   | IPV4_SIP             | FWD, 9, 10 |
 *       ====================================================================================
 *
 *    - field entry list group=9
 *       =====================================
 *       | FG ID 9 (EXTERNAL_TCAM) | DB ID 8 |
 *       =====================================
 *       | Used Entry                        |
 *       | IDs:                              |
 *       =====================================
 *       | 0xA4000001                        |
 *       =====================================
 *
 *    - field entry list group=10
 *       ======================================
 *       | FG ID 10 (EXTERNAL_TCAM) | DB ID 9 |
 *       ======================================
 *       | Used Entry                         |
 *       | IDs:                               |
 *       ======================================
 *       | 0xA8000001                         |
 *       ======================================
 *
 *    - field entry info group=9 entry=0xA4000001
 *       ========================================
 *       | Entry Info                           |
 *       ========================================
 *       | FG | FG Type       | Entry ID   | DB |
 *       | ID |               |            | ID |
 *       ========================================
 *       | 9  | EXTERNAL_TCAM | 0xA4000001 | 8  |
 *       ========================================
 *       =======================================================================================================================
 *       | Key & Payload Info                                                                                                  |
 *       =======================================================================================================================
 *       | Qual               | Qual | Qual Val           | Qual Mask          |   | Action       | Action | Action | Action   |
 *       |                    | Size |                    |                    |   |              | Size   | Lsb    | Val      |
 *       =======================================================================================================================
 *       | MAC_SRC            | 48   | 0x0000000000000001 | 0x0000000000000001 |   | ext_void_act | 32     | 0      | 0x000ABC |
 *       -----------------------------------------------------------------------------------------------------------------------
 *       | L4_SRC_PORT        | 16   | Min: 0x00000002    | 0x00000000         |   |              |        |        |          |
 *       |                    |      | Max: 0x00000005    |                    |   |              |        |        |          |
 *       -----------------------------------------------------------------------------------------------------------------------
 *       | IN_TTL             | 8    | 0x00000003         | 0x00000003         |   |              |        |        |          |
 *       -----------------------------------------------------------------------------------------------------------------------
 *       | ETH_1ST_TPID_EXIST | 1    | 0x00000001         | 0x00000001         |   |              |        |        |          |
 *       -----------------------------------------------------------------------------------------------------------------------
 *       | IPV4_SIP           | 32   | 0x00000004         | 0x00000004         |   |              |        |        |          |
 *       =======================================================================================================================
 *       =======================================================================================================================================
 *       | Entry Qual Raw Data                                                                                                                 |
 *       =======================================================================================================================================
 *       | Raw Value                                                        | Raw Mask                                                         |
 *       =======================================================================================================================================
 *       | 0x00000000000000000000000000000000000000000000000000000000000000 | 0x00000000000000000000000000000000000000000000000000000000000000 |
 *       | 0000000000000000000000000000000000000009030002000000000001       | 0000000000000000000000000000000000000009030000000000000001       |
 *       =======================================================================================================================================
 *
 *    - field entry info group=10 entry=0xA8000001
 *       ========================================
 *       | Entry Info                           |
 *       ========================================
 *       | FG | FG Type       | Entry ID   | DB |
 *       | ID |               |            | ID |
 *       ========================================
 *       | 10 | EXTERNAL_TCAM | 0xA8000001 | 9  |
 *       ========================================
 *       =======================================================================================================================
 *       | Key & Payload Info                                                                                                  |
 *       =======================================================================================================================
 *       | Qual               | Qual | Qual Val           | Qual Mask          |   | Action       | Action | Action | Action   |
 *       |                    | Size |                    |                    |   |              | Size   | Lsb    | Val      |
 *       =======================================================================================================================
 *       | MAC_SRC            | 48   | 0x0000000000000001 | 0x0000000000000001 |   | ext_void_act | 32     | 0      | 0x000ABC |
 *       -----------------------------------------------------------------------------------------------------------------------
 *       | L4_SRC_PORT        | 16   | Min: 0x00000002    | 0x00000000         |   |              |        |        |          |
 *       |                    |      | Max: 0x00000005    |                    |   |              |        |        |          |
 *       -----------------------------------------------------------------------------------------------------------------------
 *       | IN_TTL             | 8    | 0x00000003         | 0x00000003         |   |              |        |        |          |
 *       -----------------------------------------------------------------------------------------------------------------------
 *       | ETH_1ST_TPID_EXIST | 1    | 0x00000001         | 0x00000001         |   |              |        |        |          |
 *       -----------------------------------------------------------------------------------------------------------------------
 *       | IPV4_SIP           | 32   | 0x00000004         | 0x00000004         |   |              |        |        |          |
 *       =======================================================================================================================
 *       =======================================================================================================================================
 *       | Entry Qual Raw Data                                                                                                                 |
 *       =======================================================================================================================================
 *       | Raw Value                                                        | Raw Mask                                                         |
 *       =======================================================================================================================================
 *       | 0x00000000000000000000000000000000000000000000000000000000000000 | 0x00000000000000000000000000000000000000000000000000000000000000 |
 *       | 0000000000000000000000000000000000000009030002000000000001       | 0000000000000000000000000000000000000009030000000000000001       |
 *       =======================================================================================================================================
 *
 * 2. ctest field kbp_sEM type=bcm opcode_type=dynamic
 *    - field group list stage=external - same as above
 *    - field group info group=9 - same as above only Context table is different
 *       ==============================
 *       | Contexts for FG 9          |
 *       ==============================
 *       | ID       | Name            |
 *       ==============================
 *       | 128 (AT) | kbp_sem_user_AT |
 *       ==============================
 *
 *    - field group info group=10 - same as above only Context table is different
 *       ==============================
 *       | Contexts for FG 10         |
 *       ==============================
 *       | ID       | Name            |
 *       ==============================
 *       | 128 (AT) | kbp_sem_user_AT |
 *       ==============================
 *
 *    - field context list stage=external
 *       =========================================================================================================================
 *       | CONTEXT                                                                                                               |
 *       =========================================================================================================================
 *       | CTX ID   | Stage    | Name              | Presel IDs               | Presel(Value) | Mode                             |
 *       =========================================================================================================================
 *       | 1 (AT)   | External | L2                | No hit - FWD ctx chosen! | -             | Predefined Apptype               |
 *       -------------------------------------------------------------------------------------------------------------------------
 *       | 7 (AT)   | External | Mpls              | No hit - FWD ctx chosen! | -             | Predefined Apptype               |
 *       -------------------------------------------------------------------------------------------------------------------------
 *       | 12 (AT)  | External | TrafficManagement | No hit - FWD ctx chosen! | -             | Predefined Apptype               |
 *       -------------------------------------------------------------------------------------------------------------------------
 *       | 15 (AT)  | External | Ip4UcastRpf       | No hit - FWD ctx chosen! | -             | Predefined Apptype               |
 *       -------------------------------------------------------------------------------------------------------------------------
 *       | 16 (AT)  | External | Ip6UcastRpf       | No hit - FWD ctx chosen! | -             | Predefined Apptype               |
 *       -------------------------------------------------------------------------------------------------------------------------
 *       | 17 (AT)  | External | Ip4McastRpf       | No hit - FWD ctx chosen! | -             | Predefined Apptype               |
 *       -------------------------------------------------------------------------------------------------------------------------
 *       | 19 (AT)  | External | Ip6McastRpf       | No hit - FWD ctx chosen! | -             | Predefined Apptype               |
 *       -------------------------------------------------------------------------------------------------------------------------
 *       | 128 (AT) | External | kbp_sem_user_AT   | No hit - FWD ctx chosen! | -             | Cascading TrafficManagement (12) |
 *       =========================================================================================================================
 *
 *    - field context info context=128 stage=external
 *       =============================================================================================================================
 *       | CONTEXT                                                                                                                   |
 *       =============================================================================================================================
 *       | CTX ID   | Stage    | Name            | Presel IDs               | Presel(Value) | Mode                             | Key |
 *       |          |          |                 |                          |               |                                  | Gen |
 *       |          |          |                 |                          |               |                                  | Var |
 *       =============================================================================================================================
 *       | 128 (AT) | External | kbp_sem_user_AT | No hit - FWD ctx chosen! | -             | Cascading TrafficManagement (12) | N/A |
 *       =============================================================================================================================
 *       ==============================
 *       | KBP Info                   |
 *       ==============================
 *       | Opcode | FWD     | ACL     |
 *       | Id     | Context | Context |
 *       ==============================
 *       | 32     | 6       | 32      |
 *       ==============================
 *       ===============================
 *       | Attached FGs and Lookup Ids |
 *       ===============================
 *       | FG ID     | fg | fg         |
 *       |           | 9  | 10         |
 *       ===============================
 *       | LOOKUP_ID | 2  | 3          |
 *       ===============================
 *       ============================================================
 *       | FFC Groups                                               |
 *       ============================================================
 *       | FFC Group ID (Types)           | Used FFC Id's    | NOF  |
 *       |                                |                  | Free |
 *       |                                |                  | FFCs |
 *       ============================================================
 *       | 1 (MetaData/LayerReord/Header) | 0, 1, 2, 3, 4, 5 | 32   |
 *       ============================================================
 *       ===============================================================================
 *       | Master Key Info                                                             |
 *       ===============================================================================
 *       | Qualifier          | Key | Lsb | Size | Size | Segment Name         | Used  |
 *       |                    |     |     |      | on   |                      | by    |
 *       |                    |     |     |      | Key  |                      | FGs   |
 *       ===============================================================================
 *       | MAC_SRC            | B   | 48  | 48   | 48   | MAC_SRC:0:0:0        | 9, 10 |
 *       -------------------------------------------------------------------------------
 *       | L4_SRC_PORT        | B   | 96  | 16   | 16   | L4_SRC_PORT:0:0:0    | 9, 10 |
 *       -------------------------------------------------------------------------------
 *       | IN_TTL             | B   | 112 | 8    | 8    | IN_TTL:2:65535:65535 | 9, 10 |
 *       -------------------------------------------------------------------------------
 *       | ETH_1ST_TPID_EXIST | B   | 120 | 1    | 8    | ETH_1ST_TPID_EXIST:5 | 9, 10 |
 *       -------------------------------------------------------------------------------
 *       | IPV4_SIP           | B   | 128 | 32   | 32   | IPV4_SIP:0:0:0       | 9, 10 |
 *       ===============================================================================
 *
 *    - field attach info context=128 group=9 - same as above, only without FWD sharing
 *    - field attach info context=128 group=10 - same as above, only without FWD sharing
 *    - field entry list group=9 - same as above
 *    - field entry list group=10 - same as above
 *    - field entry info group=9 entry=0xA4000001 - same as above
 *    - field entry info group=10 entry=0xA8000001 - same as above
 *
 */
/*
 * $Copyright:.$
 */
#ifdef BSL_LOG_MODULE
#error "BSL_LOG_MODULE redefined"
#endif
#define BSL_LOG_MODULE BSL_LS_BCMDNX_FLDTESTSDNX

 /**
  * Include files.
  * {
  */
#include <soc/dnxc/swstate/sw_state_defs.h>
/** shared */
#include <shared/shrextend/shrextend_debug.h>
/** appl */
#include <appl/diag/sand/diag_sand_framework.h>
#include <appl/diag/sand/diag_sand_prt.h>
#include <bcm_int/dnx/field/field.h>
#include <bcm_int/dnx/field/field_group.h>
#include <bcm_int/dnx/field/field_context.h>
#include <bcm_int/dnx/field/field_map.h>
#include <bcm_int/dnx/field/field_init.h>
#include "ctest_dnx_field_kbp_sem.h"
#include "ctest_dnx_field_utils.h"
#include <appl/diag/dnx/diag_dnx_field.h>

#include <soc/memory.h>
#include <soc/feature.h>
#include <soc/types.h>
#include <soc/register.h>
#include <soc/dnxc/drv_dnxc_utils.h>

/*
 * }
 */

/* *INDENT-OFF* */

/**
 * \brief
 *   Keyword for the number of times the test will run
 */
#define DNX_DIAG_FIELD_KBP_SEM_OPTION_COUNT        "count"
/**
 * Keyword for test type:
 *   Type can be either BCM or DNX
 */
#define DNX_DIAG_FIELD_KBP_SEM_OPTION_TEST_TYPE         "type"
/**
 * Keyword for opcode type:
 *   Type can be either static or dynamic
 */
#define DNX_DIAG_FIELD_KBP_SEM_OPTION_OPCODE_TYPE         "opcode_type"

/**
 * \brief
 *   Options list for 'KBP SEM' shell command
 * \remark
 */
sh_sand_option_t Sh_dnx_field_kbp_sem_options[] = {
    /* Name */                                 /* Type */              /* Description */                                /* Default */
    {DNX_DIAG_FIELD_KBP_SEM_OPTION_TEST_TYPE,       SAL_FIELD_TYPE_ENUM,    "Type (level) of test (dnx or bcm)",        "DNX",     (void *)Field_level_enum_table},
    {DNX_DIAG_FIELD_KBP_SEM_OPTION_OPCODE_TYPE,     SAL_FIELD_TYPE_ENUM,    "Type of the Opcode (static or dynamic)",        "STATIC",     (void *)Field_kbp_opcode_type_enum_table},
    {DNX_DIAG_FIELD_KBP_SEM_OPTION_COUNT,      SAL_FIELD_TYPE_UINT32,  "Number of times test will run",            "1"},
    {NULL}      /* End of options list - must be last. */
};
/**
 * \brief
 *   List of tests for 'KBP SEM' shell command (to be run on regression, precommit, etc.)
 * \remark
 *   Currently, it will be executed only for regression and precommit.
 */
sh_sand_invoke_t Sh_dnx_field_kbp_sem_tests[] = {
    {"bcm_static_1", "type=bcm opcode_type=static count=1", CTEST_POSTCOMMIT},
    {"bcm_dynamic_1", "type=bcm opcode_type=dynamic count=1", CTEST_POSTCOMMIT},
    {"dnx_static_1", "type=dnx opcode_type=static count=1", CTEST_POSTCOMMIT},
    {"dnx_dynamic_1", "type=dnx opcode_type=dynamic count=1", CTEST_POSTCOMMIT},
    {NULL}
};

/**
 *  KBP SEM shell command leaf details
 */
sh_sand_man_t Sh_dnx_field_kbp_sem_man = {
    .brief =
        "Field KBP semantic tests",
    .full =
        "This Ctest presents KBP semantic tests.\n"
        "Creating KBP group, attaching it to an opcode (can be static or dynamic) and "
        "adding an entry to it. Compare get and set values of all configurations.\n",
};

bcm_field_action_t Ctest_dnx_field_kbp_sem_void_action_bcm;
dnx_field_action_t Ctest_dnx_field_kbp_sem_void_action_dnx;

/* *INDENT-ON* */

/**
 * \brief
 *  This functions creates a field group, attaching it to an opcode
 *  and adding an entry to it. BCM layer.
 *
 * \param [in] unit - Device ID
 * \param [in] opcode_type - Opcode type, can be static or dynamic
 * \param [out] fg_id_p - Id of the created FG
 * \param [out] fg_id_shared_p - Id of the created shared FG
 * \param [out] entry_id_p - Id of the created Entry
 * \param [out] entry_id_shared_p - Id of the created shared Entry
 * \param [out] context_id_p - Id of the created Context
 * \param [out] fg_info_p - FG info
 * \param [out] attach_info_p - Attach info
 * \param [out] entry_info_p - Entry info
 * \param [out] context_info_p - Context info
 *
 * \return
 *  \retval _SHR_E_NONE - success
 */
static shr_error_e
ctest_dnx_field_kbp_sem_bcm_config(
    int unit,
    int opcode_type,
    bcm_field_group_t * fg_id_p,
    bcm_field_group_t * fg_id_shared_p,
    bcm_field_entry_t * entry_id_p,
    bcm_field_entry_t * entry_id_shared_p,
    bcm_field_context_t * context_id_p,
    bcm_field_group_info_t * fg_info_p,
    bcm_field_group_attach_info_t * attach_info_p,
    bcm_field_entry_info_t * entry_info_p,
    bcm_field_context_info_t * context_info_p)
{
    bcm_field_action_info_t action_info;

    SHR_FUNC_INIT_VARS(unit);

    if (opcode_type == 0)
    {
        *context_id_p = bcmFieldAppTypeIp4UcastRpf;

        bcm_field_context_info_t_init(context_info_p);
    }
    else if (opcode_type == 1)
    {
        bcm_field_presel_entry_data_t presel_entry_data;
        bcm_field_presel_entry_id_t presel_entry_id;

        bcm_field_context_info_t_init(context_info_p);
        sal_strncpy_s((char *) context_info_p->name, "kbp_sem_user_AT", sizeof(context_info_p->name));
        context_info_p->cascaded_from = bcmFieldAppTypeTrafficManagement;
        SHR_IF_ERR_EXIT(bcm_field_context_create(unit, 0, bcmFieldStageExternal, context_info_p, context_id_p));

        bcm_field_presel_entry_id_info_init(&presel_entry_id);
        bcm_field_presel_entry_data_info_init(&presel_entry_data);
        presel_entry_id.presel_id = 50;
        presel_entry_id.stage = bcmFieldStageExternal;
        presel_entry_data.entry_valid = TRUE;
        presel_entry_data.context_id = *context_id_p;
        presel_entry_data.nof_qualifiers = 1;
        presel_entry_data.qual_data[0].qual_type = bcmFieldQualifyForwardingType;
        presel_entry_data.qual_data[0].qual_arg = 1;
        presel_entry_data.qual_data[0].qual_value = bcmFieldLayerTypeIp4;
        presel_entry_data.qual_data[0].qual_mask = 0x1F;
        SHR_IF_ERR_EXIT(bcm_field_presel_set(unit, 0, &presel_entry_id, &presel_entry_data));
    }
    else
    {
        LOG_INFO_EX(BSL_LOG_MODULE,
                    "%s(), line %d, Given value for %d (for 'opcode_type') is not supported. Illegal parameter. %s\r\n",
                    __func__, __LINE__, opcode_type, EMPTY);
        SHR_IF_ERR_EXIT(_SHR_E_PARAM);
    }

    /**  Create a void user defined action. */
    bcm_field_action_info_t_init(&action_info);
    action_info.stage = bcmFieldStageExternal;
    action_info.action_type = bcmFieldActionVoid;
    action_info.size = 32;
    /** size + prefix_size summary should be 32. */
    action_info.prefix_size = 0;
    sal_strncpy_s((char *) action_info.name, "ext_void_act", sizeof(action_info.name));
    SHR_IF_ERR_EXIT(bcm_field_action_create(unit, 0, &action_info, &Ctest_dnx_field_kbp_sem_void_action_bcm));

    /** Create field group. */
    bcm_field_group_info_t_init(fg_info_p);
    sal_strncpy_s((char *) fg_info_p->name, "external", sizeof(fg_info_p->name));
    fg_info_p->fg_type = bcmFieldGroupTypeExternalTcam;
    fg_info_p->stage = bcmFieldStageExternal;

    /** Set quals */
    fg_info_p->nof_quals = 5;
    fg_info_p->qual_types[0] = bcmFieldQualifySrcMac;
    fg_info_p->qual_types[1] = bcmFieldQualifyL4SrcPort;
    fg_info_p->qual_is_ranged[1] = TRUE;
    fg_info_p->qual_types[2] = bcmFieldQualifyGeneratedTtl;
    fg_info_p->qual_types[3] = bcmFieldQualifyEthernetFirstTpidExist;
    fg_info_p->qual_types[4] = bcmFieldQualifySrcIp;
    /** Set actions */
    fg_info_p->nof_actions = 1;
    fg_info_p->action_types[0] = Ctest_dnx_field_kbp_sem_void_action_bcm;
    fg_info_p->action_with_valid_bit[0] = FALSE;
    SHR_IF_ERR_EXIT(bcm_field_group_add(unit, 0, fg_info_p, fg_id_p));
    LOG_INFO_EX(BSL_LOG_MODULE, "Field Group ID %d was created. \n %s%s%s", *fg_id_p, EMPTY, EMPTY, EMPTY);

    sal_strncpy_s((char *) fg_info_p->name, "external_shared", sizeof(fg_info_p->name));
    SHR_IF_ERR_EXIT(bcm_field_group_add(unit, 0, fg_info_p, fg_id_shared_p));
    LOG_INFO_EX(BSL_LOG_MODULE, "Shared Field Group ID %d was created. \n %s%s%s", *fg_id_shared_p, EMPTY, EMPTY,
                EMPTY);

    bcm_field_group_attach_info_t_init(attach_info_p);
    attach_info_p->key_info.nof_quals = fg_info_p->nof_quals;
    attach_info_p->payload_info.nof_actions = fg_info_p->nof_actions;
    attach_info_p->key_info.qual_types[0] = fg_info_p->qual_types[0];
    attach_info_p->key_info.qual_info[0].input_type = bcmFieldInputTypeLayerFwd;
    attach_info_p->key_info.qual_info[0].input_arg = 0;
    attach_info_p->key_info.qual_info[0].offset = 0;
    attach_info_p->key_info.qual_types[1] = fg_info_p->qual_types[1];
    attach_info_p->key_info.qual_info[1].input_type = bcmFieldInputTypeLayerFwd;
    attach_info_p->key_info.qual_info[1].input_arg = 0;
    attach_info_p->key_info.qual_info[1].offset = 0;
    attach_info_p->key_info.qual_types[2] = fg_info_p->qual_types[2];
    attach_info_p->key_info.qual_info[2].input_type = bcmFieldInputTypeMetaData;
    attach_info_p->key_info.qual_types[3] = fg_info_p->qual_types[3];
    attach_info_p->key_info.qual_info[3].input_type = bcmFieldInputTypeLayerRecordsAbsolute;
    attach_info_p->key_info.qual_info[3].input_arg = 0;
    attach_info_p->key_info.qual_info[3].offset = 0;
    attach_info_p->key_info.qual_types[4] = fg_info_p->qual_types[4];
    attach_info_p->key_info.qual_info[4].input_type = bcmFieldInputTypeLayerFwd;
    attach_info_p->key_info.qual_info[4].input_arg = 0;
    attach_info_p->key_info.qual_info[4].offset = 0;
    attach_info_p->payload_info.action_types[0] = fg_info_p->action_types[0];

    /** Payload id is the lookup id in the external. */
    attach_info_p->payload_info.payload_id = 3;
    /**
     * Payload offset is the location of the result inside the external payload buffer.
     * In order to extract the result this value should be used
     * as the qualifier offset in the PMF12.
     */
    attach_info_p->payload_info.payload_offset = 88;

    SHR_IF_ERR_EXIT(bcm_field_group_context_attach(unit, 0, *fg_id_shared_p, *context_id_p, attach_info_p));

    LOG_INFO_EX(BSL_LOG_MODULE, "Field Group ID %d was attached to Context ID %d. \n %s%s", *fg_id_shared_p,
                *context_id_p, EMPTY, EMPTY);

    /** Payload id is the lookup id in the external. */
    attach_info_p->payload_info.payload_id = 2;
    /**
     * Payload offset is the location of the result inside the external payload buffer.
     * In order to extract the result this value should be used
     * as the qualifier offset in the PMF12.
     */
    attach_info_p->payload_info.payload_offset = 120;
    SHR_IF_ERR_EXIT(bcm_field_group_context_attach(unit, 0, *fg_id_p, *context_id_p, attach_info_p));

    LOG_INFO_EX(BSL_LOG_MODULE, "Field Group ID %d was attached to Context ID %d. \n %s%s", *fg_id_p,
                *context_id_p, EMPTY, EMPTY);

    SHR_IF_ERR_EXIT(bcm_switch_control_set(unit, bcmSwitchExternalTcamSync, 0));

    bcm_field_entry_info_t_init(entry_info_p);

    entry_info_p->nof_entry_quals = fg_info_p->nof_quals;
    entry_info_p->entry_qual[0].type = fg_info_p->qual_types[0];
    entry_info_p->entry_qual[0].value[0] = 0x1;
    entry_info_p->entry_qual[0].mask[0] = 0x1;
    entry_info_p->entry_qual[1].type = fg_info_p->qual_types[1];
    entry_info_p->entry_qual[1].value[0] = 0x2;
    entry_info_p->entry_qual[1].max_value[0] = 0x5;
    entry_info_p->entry_qual[2].type = fg_info_p->qual_types[2];
    entry_info_p->entry_qual[2].value[0] = 0x3;
    entry_info_p->entry_qual[2].mask[0] = 0x3;
    entry_info_p->entry_qual[3].type = fg_info_p->qual_types[3];
    entry_info_p->entry_qual[3].value[0] = 0x1;
    entry_info_p->entry_qual[3].mask[0] = 0x1;
    entry_info_p->entry_qual[4].type = fg_info_p->qual_types[4];
    entry_info_p->entry_qual[4].value[0] = 0x4;
    entry_info_p->entry_qual[4].mask[0] = 0x4;

    entry_info_p->nof_entry_actions = fg_info_p->nof_actions;
    entry_info_p->entry_action[0].type = fg_info_p->action_types[0];
    entry_info_p->entry_action[0].value[0] = 0xabc;
    SHR_IF_ERR_EXIT(bcm_field_entry_add(unit, 0, *fg_id_p, entry_info_p, entry_id_p));

    LOG_INFO_EX(BSL_LOG_MODULE, "Entry ID 0x%X (%d) was added to Field Group ID %d. \n %s", *entry_id_p,
                *entry_id_p, *fg_id_p, EMPTY);

    SHR_IF_ERR_EXIT(bcm_field_entry_add(unit, 0, *fg_id_shared_p, entry_info_p, entry_id_shared_p));

    LOG_INFO_EX(BSL_LOG_MODULE, "Entry ID 0x%X (%d) was added to Shared Field Group ID %d. \n %s", *entry_id_shared_p,
                *entry_id_shared_p, *fg_id_shared_p, EMPTY);

    {
        bcm_field_context_info_t context_info;
        bcm_field_context_t ipmf1_context_id;
        bcm_field_presel_entry_id_t presel_entry_id;
        bcm_field_presel_entry_data_t presel_entry_data;
        /*
         * Create iPMF1 context/
         */
        bcm_field_context_info_t_init(&context_info);
        SHR_IF_ERR_EXIT(bcm_field_context_create(unit, 0, bcmFieldStageIngressPMF1, &context_info, &ipmf1_context_id));

        /*
         * Create presel based on hit indication. Fail for devices earlier than Q2A. 
         */
        bcm_field_presel_entry_id_info_init(&presel_entry_id);
        bcm_field_presel_entry_data_info_init(&presel_entry_data);
        presel_entry_id.presel_id = 90;
        presel_entry_id.stage = bcmFieldStageIngressPMF1;
        presel_entry_data.entry_valid = TRUE;
        presel_entry_data.context_id = ipmf1_context_id;
        presel_entry_data.nof_qualifiers = 8;
        presel_entry_data.qual_data[0].qual_type = bcmFieldQualifyExternalHit0;
        presel_entry_data.qual_data[0].qual_value = 1;
        presel_entry_data.qual_data[0].qual_mask = 0x1;
        presel_entry_data.qual_data[1].qual_type = bcmFieldQualifyExternalHit1;
        presel_entry_data.qual_data[1].qual_value = 1;
        presel_entry_data.qual_data[1].qual_mask = 0x1;
        presel_entry_data.qual_data[2].qual_type = bcmFieldQualifyExternalHit2;
        presel_entry_data.qual_data[2].qual_value = 1;
        presel_entry_data.qual_data[2].qual_mask = 0x1;
        presel_entry_data.qual_data[3].qual_type = bcmFieldQualifyExternalHit3;
        presel_entry_data.qual_data[3].qual_value = 1;
        presel_entry_data.qual_data[3].qual_mask = 0x1;
        presel_entry_data.qual_data[4].qual_type = bcmFieldQualifyExternalHit4;
        presel_entry_data.qual_data[4].qual_value = 1;
        presel_entry_data.qual_data[4].qual_mask = 0x1;
        presel_entry_data.qual_data[5].qual_type = bcmFieldQualifyExternalHit5;
        presel_entry_data.qual_data[5].qual_value = 1;
        presel_entry_data.qual_data[5].qual_mask = 0x1;
        presel_entry_data.qual_data[6].qual_type = bcmFieldQualifyExternalHit6;
        presel_entry_data.qual_data[6].qual_value = 1;
        presel_entry_data.qual_data[6].qual_mask = 0x1;
        presel_entry_data.qual_data[7].qual_type = bcmFieldQualifyExternalHit7;
        presel_entry_data.qual_data[7].qual_value = 1;
        presel_entry_data.qual_data[7].qual_mask = 0x1;
        if (dnx_data_field.features.kbp_hitbits_correct_in_ipmf1_cs_get(unit))
        {
            SHR_IF_ERR_EXIT(bcm_field_presel_set(unit, 0, &presel_entry_id, &presel_entry_data));
        }
        else
        {
            shr_error_e rv;
            rv = bcm_field_presel_set(unit, 0, &presel_entry_id, &presel_entry_data);
            if (rv != _SHR_E_NOT_FOUND)
            {
                SHR_ERR_EXIT(_SHR_E_INTERNAL, "KBP hitbits context selection qualifiers are not expected to be "
                             "supported on the device.\r\n");
            }
        }
    }

exit:
    SHR_FUNC_EXIT;
}

/**
 * \brief
 *  This functions creates a field group, attaching it to an opcode
 *  and adding an entry to it. DNX layer.
 *
 * \param [in] unit - Device ID
 * \param [in] opcode_type - Opcode type, can be static or dynamic
 * \param [out] fg_id_p - Id of the created FG
 * \param [out] entry_id_p - Id of the created Entry
 * \param [out] context_id_p - Id of the created Context
 * \param [out] fg_info_p - FG info
 * \param [out] attach_info_p - Attach info
 * \param [out] entry_info_p - Entry info
 * \param [out] apptype_info_p - Apptype info
 *
 * \return
 *  \retval _SHR_E_NONE - success
 */
static shr_error_e
ctest_dnx_field_kbp_sem_dnx_config(
    int unit,
    int opcode_type,
    dnx_field_group_t * fg_id_p,
    uint32 *entry_id_p,
    dnx_field_context_t * context_id_p,
    dnx_field_group_info_t * fg_info_p,
    dnx_field_group_attach_info_t * attach_info_p,
    dnx_field_entry_t * entry_info_p,
    dnx_field_context_apptype_info_t * apptype_info_p)
{
    dnx_field_context_t context_id_internal;
    dnx_field_action_in_info_t action_info;
    uint32 opcode_id;

    SHR_FUNC_INIT_VARS(unit);

    if (opcode_type == 0)
    {
        /*
         * Cast. 
         */
        *context_id_p = bcmFieldAppTypeTrafficManagement;

        SHR_IF_ERR_EXIT(dnx_field_context_apptype_info_t_init(unit, apptype_info_p));
    }
    else if (opcode_type == 1)
    {
        bcm_field_AppType_t apptype;
        bcm_field_presel_entry_data_t presel_entry_data;
        bcm_field_presel_entry_id_t presel_entry_id;

        SHR_IF_ERR_EXIT(dnx_field_context_apptype_info_t_init(unit, apptype_info_p));
        sal_strncpy_s(apptype_info_p->name, "kbp_sem_user_AT", sizeof(apptype_info_p->name));
        apptype_info_p->base_static_apptype = bcmFieldAppTypeTrafficManagement;
        SHR_IF_ERR_EXIT(dnx_field_context_apptype_create(unit, 0, apptype_info_p, &apptype));

        /** Type cast the Apptype to be aligned to context_id. */
        *context_id_p = apptype;

        bcm_field_presel_entry_id_info_init(&presel_entry_id);
        bcm_field_presel_entry_data_info_init(&presel_entry_data);
        presel_entry_id.presel_id = 50;
        presel_entry_id.stage = bcmFieldStageExternal;
        presel_entry_data.entry_valid = TRUE;
        presel_entry_data.context_id = *context_id_p;
        presel_entry_data.nof_qualifiers = 1;
        presel_entry_data.qual_data[0].qual_type = bcmFieldQualifyForwardingType;
        presel_entry_data.qual_data[0].qual_arg = 1;
        presel_entry_data.qual_data[0].qual_value = bcmFieldLayerTypeIp4;
        presel_entry_data.qual_data[0].qual_mask = 0x1F;
        SHR_IF_ERR_EXIT(bcm_field_presel_set(unit, 0, &presel_entry_id, &presel_entry_data));
    }
    else
    {
        LOG_INFO_EX(BSL_LOG_MODULE,
                    "%s(), line %d, Given value for %d (for 'opcode_type') is not supported. Illegal parameter. %s\r\n",
                    __func__, __LINE__, opcode_type, EMPTY);
        SHR_IF_ERR_EXIT(_SHR_E_PARAM);
    }

    /**  Create a void user defined action. */
    SHR_IF_ERR_EXIT(dnx_field_action_in_info_t_init(unit, &action_info));
    action_info.stage = DNX_FIELD_STAGE_EXTERNAL;
    action_info.bcm_action = bcmFieldActionVoid;
    action_info.size = 32;
    /** size + prefix_size summary should be 32. */
    action_info.prefix_size = 0;
    sal_strncpy_s((char *) action_info.name, "ext_void_act", sizeof(action_info.name));
    SHR_IF_ERR_EXIT(dnx_field_action_create
                    (unit, 0, &action_info, &Ctest_dnx_field_kbp_sem_void_action_bcm,
                     &Ctest_dnx_field_kbp_sem_void_action_dnx));

    /** Create field group. */
    SHR_IF_ERR_EXIT(dnx_field_group_info_t_init(unit, fg_info_p));
    sal_strncpy_s((char *) fg_info_p->name, "external", sizeof(fg_info_p->name));
    fg_info_p->fg_type = DNX_FIELD_GROUP_TYPE_EXTERNAL_TCAM;
    fg_info_p->field_stage = DNX_FIELD_STAGE_EXTERNAL;

    /** Set quals */
    fg_info_p->dnx_quals[0] =
        DNX_QUAL(DNX_FIELD_QUAL_CLASS_HEADER, DNX_FIELD_STAGE_EXTERNAL, DNX_FIELD_HEADER_QUAL_MAC_SRC);
    fg_info_p->dnx_quals[1] =
        DNX_QUAL(DNX_FIELD_QUAL_CLASS_HEADER, DNX_FIELD_STAGE_EXTERNAL, DNX_FIELD_HEADER_QUAL_MAC_DST);
    /** Set actions */
    fg_info_p->dnx_actions[0] = Ctest_dnx_field_kbp_sem_void_action_dnx;
    fg_info_p->use_valid_bit[0] = FALSE;
    SHR_IF_ERR_EXIT(dnx_field_group_add(unit, 0, fg_info_p, fg_id_p));

    LOG_INFO_EX(BSL_LOG_MODULE, "Field Group ID %d was created. \n %s%s%s", *fg_id_p, EMPTY, EMPTY, EMPTY);

    SHR_IF_ERR_EXIT(dnx_field_group_attach_info_t_init(unit, attach_info_p));
    /** Payload id is the lookup id in the external. */
    attach_info_p->payload_id = 0;
    /**
     * Payload offset is the location of the result inside the external payload buffer.
     * In order to extract the result this value should be used
     * as the qualifier offset in the PMF12.
     */
    attach_info_p->payload_offset = 120;

    attach_info_p->dnx_quals[0] = fg_info_p->dnx_quals[0];
    attach_info_p->qual_info[0].input_type = DNX_FIELD_INPUT_TYPE_LAYER_ABSOLUTE;
    attach_info_p->qual_info[0].input_arg = 0;
    attach_info_p->qual_info[0].offset = 0;
    attach_info_p->dnx_quals[1] = fg_info_p->dnx_quals[1];
    attach_info_p->qual_info[1].input_type = DNX_FIELD_INPUT_TYPE_LAYER_ABSOLUTE;
    attach_info_p->qual_info[1].input_arg = 0;
    attach_info_p->qual_info[1].offset = 0;

    attach_info_p->dnx_actions[0] = fg_info_p->dnx_actions[0];

    /** Convert apptype to opcode and pass it on as context. */
    SHR_IF_ERR_EXIT(dnx_field_map_apptype_to_opcode_bcm_to_dnx(unit, *context_id_p, &opcode_id));
    context_id_internal = opcode_id;

    SHR_IF_ERR_EXIT(dnx_field_group_context_attach(unit, 0, *fg_id_p, context_id_internal, attach_info_p));

    LOG_INFO_EX(BSL_LOG_MODULE, "Field Group ID %d was attached to Context ID %d. \n %s%s", *fg_id_p,
                *context_id_p, EMPTY, EMPTY);

    SHR_IF_ERR_EXIT(bcm_switch_control_set(unit, bcmSwitchExternalTcamSync, 0));

    SHR_IF_ERR_EXIT(dnx_field_entry_t_init(unit, entry_info_p));
    entry_info_p->priority = 1;

    entry_info_p->key_info.qual_info[0].dnx_qual = fg_info_p->dnx_quals[0];
    entry_info_p->key_info.qual_info[0].qual_value[0] = 0x1;
    entry_info_p->key_info.qual_info[0].qual_mask[0] = 0x1;
    entry_info_p->key_info.qual_info[1].dnx_qual = fg_info_p->dnx_quals[1];
    entry_info_p->key_info.qual_info[1].qual_value[0] = 0x2;
    entry_info_p->key_info.qual_info[1].qual_mask[0] = 0x2;

    entry_info_p->payload_info.action_info[0].dnx_action = fg_info_p->dnx_actions[0];
    entry_info_p->payload_info.action_info[0].action_value[0] = 0xabc;
    SHR_IF_ERR_EXIT(dnx_field_entry_kbp_add(unit, 0, *fg_id_p, entry_info_p, entry_id_p));

    LOG_INFO_EX(BSL_LOG_MODULE, "Entry ID 0x%X (%d) was added to Field Group ID %d. \n %s", *entry_id_p,
                *entry_id_p, *fg_id_p, EMPTY);

exit:
    SHR_FUNC_EXIT;
}

/**
 * \brief
 *  This function compares get and set info for the KBP configuration.
 *  BCM layer.
 *
 * \param [in] unit - Device ID
 * \param [in] opcode_type - Opcode type, can be static or dynamic
 * \param [in] fg_id - Id of the created FG
 * \param [in] entry_id - Id of the created Entry
 * \param [in] context_id - Id of the created Context
 * \param [in] fg_info_p - FG info
 * \param [in] attach_info_p - Attach info
 * \param [in] entry_info_p - Entry info
 * \param [in] context_info_p - Context info
 *
 * \return
 *  \retval _SHR_E_NONE - success
 */
static shr_error_e
ctest_dnx_field_kbp_sem_bcm_compare(
    int unit,
    int opcode_type,
    bcm_field_group_t fg_id,
    bcm_field_entry_t entry_id,
    bcm_field_context_t context_id,
    bcm_field_group_info_t * fg_info_p,
    bcm_field_group_attach_info_t * attach_info_p,
    bcm_field_entry_info_t * entry_info_p,
    bcm_field_context_info_t * context_info_p)
{
    bcm_field_group_info_t fg_info_get;
    bcm_field_group_attach_info_t attach_info_get;
    bcm_field_entry_info_t entry_info_get;
    bcm_field_context_info_t context_info_get;
    int qual_iter, action_iter;

    SHR_FUNC_INIT_VARS(unit);

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 1: Get the info for the FG. \n %s%s%s%s", EMPTY, EMPTY, EMPTY, EMPTY);
    bcm_field_group_info_t_init(&fg_info_get);
    SHR_IF_ERR_EXIT(bcm_field_group_info_get(unit, fg_id, &fg_info_get));

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 2: Compare the FG set and get values. \n %s%s%s%s", EMPTY, EMPTY, EMPTY, EMPTY);
    if (fg_info_get.nof_quals != fg_info_p->nof_quals)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "bcm_field_group_info_get: Unexpected data returned. nof_quals expected %d received %d.\n",
                     fg_info_p->nof_quals, fg_info_get.nof_quals);
    }

    for (qual_iter = 0; qual_iter < fg_info_get.nof_quals; qual_iter++)
    {
        if (fg_info_get.qual_types[qual_iter] != fg_info_p->qual_types[qual_iter])
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_group_info_get: Unexpected data returned. qual_types expected %d received %d.\n",
                         fg_info_p->qual_types[qual_iter], fg_info_get.qual_types[qual_iter]);
        }
    }

    if (fg_info_get.nof_actions != fg_info_p->nof_actions)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "bcm_field_group_info_get: Unexpected data returned. nof_actions expected %d received %d.\n",
                     fg_info_p->nof_actions, fg_info_get.nof_actions);
    }

    for (action_iter = 0; action_iter < fg_info_get.nof_actions; action_iter++)
    {
        if (fg_info_get.action_types[action_iter] != fg_info_p->action_types[action_iter])
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_group_info_get: Unexpected data returned. action types expected %d received %d.\n",
                         fg_info_p->action_types[action_iter], fg_info_get.action_types[action_iter]);
        }
    }

    if (fg_info_get.stage != fg_info_p->stage)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "bcm_field_group_info_get: Unexpected data returned. stage expected %d received %d.\n",
                     fg_info_p->stage, fg_info_get.stage);
    }

    if (fg_info_get.fg_type != fg_info_p->fg_type)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "bcm_field_group_info_get: Unexpected data returned. fg_type expected %d received %d.\n",
                     fg_info_p->fg_type, fg_info_get.fg_type);
    }

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 3: Get the attach info. \n %s%s%s%s", EMPTY, EMPTY, EMPTY, EMPTY);
    bcm_field_group_attach_info_t_init(&attach_info_get);
    SHR_IF_ERR_EXIT(bcm_field_group_context_info_get(unit, fg_id, context_id, &attach_info_get));

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 4: Compare the attach set and get values. \n %s%s%s%s", EMPTY, EMPTY, EMPTY,
                EMPTY);
    if (attach_info_get.key_info.nof_quals != attach_info_p->key_info.nof_quals)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "bcm_field_group_context_info_get: Unexpected data returned. nof_quals expected %d received %d.\n",
                     attach_info_p->key_info.nof_quals, attach_info_get.key_info.nof_quals);
    }

    for (qual_iter = 0; qual_iter < attach_info_get.key_info.nof_quals; qual_iter++)
    {
        if (attach_info_get.key_info.qual_types[qual_iter] != attach_info_p->key_info.qual_types[qual_iter])
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_group_context_info_get: Unexpected data returned. qual_types expected %d received %d.\n",
                         attach_info_p->key_info.qual_types[qual_iter], attach_info_get.key_info.qual_types[qual_iter]);
        }
        if (attach_info_get.key_info.qual_info[qual_iter].input_type !=
            attach_info_p->key_info.qual_info[qual_iter].input_type)
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_group_context_info_get: Unexpected data returned. input_type expected %d received %d.\n",
                         attach_info_p->key_info.qual_info[qual_iter].input_type,
                         attach_info_get.key_info.qual_info[qual_iter].input_type);
        }
        if (attach_info_get.key_info.qual_info[qual_iter].input_arg !=
            attach_info_p->key_info.qual_info[qual_iter].input_arg)
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_group_context_info_get: Unexpected data returned. input_arg expected %d received %d.\n",
                         attach_info_p->key_info.qual_info[qual_iter].input_arg,
                         attach_info_get.key_info.qual_info[qual_iter].input_arg);
        }
        if (attach_info_get.key_info.qual_info[qual_iter].offset != attach_info_p->key_info.qual_info[qual_iter].offset)
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_group_context_info_get: Unexpected data returned. offset expected %d received %d.\n",
                         attach_info_p->key_info.qual_info[qual_iter].offset,
                         attach_info_get.key_info.qual_info[qual_iter].offset);
        }
    }

    if (attach_info_get.payload_info.nof_actions != attach_info_p->payload_info.nof_actions)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "bcm_field_group_context_info_get: Unexpected data returned. nof_actions expected %d received %d.\n",
                     attach_info_p->payload_info.nof_actions, attach_info_get.payload_info.nof_actions);
    }

    for (action_iter = 0; action_iter < attach_info_get.payload_info.nof_actions; action_iter++)
    {
        if (attach_info_get.payload_info.action_types[action_iter] !=
            attach_info_p->payload_info.action_types[action_iter])
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_group_context_info_get: Unexpected data returned. action types expected %d received %d.\n",
                         attach_info_p->payload_info.action_types[action_iter],
                         attach_info_get.payload_info.action_types[action_iter]);
        }
        if (attach_info_get.payload_info.action_info[action_iter].priority !=
            attach_info_p->payload_info.action_info[action_iter].priority)
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_group_context_info_get: Unexpected data returned. action priority expected %d received %d.\n",
                         attach_info_p->payload_info.action_info[action_iter].priority,
                         attach_info_get.payload_info.action_info[action_iter].priority);
        }
    }

    if (attach_info_get.payload_info.payload_id != attach_info_p->payload_info.payload_id)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "bcm_field_group_context_info_get: Unexpected data returned. payload_id expected %d received %d.\n",
                     attach_info_p->payload_info.payload_id, attach_info_get.payload_info.payload_id);
    }

    if (attach_info_get.payload_info.payload_offset != attach_info_p->payload_info.payload_offset)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "bcm_field_group_context_info_get: Unexpected data returned. payload_offset expected %d received %d.\n",
                     attach_info_p->payload_info.payload_offset, attach_info_get.payload_info.payload_offset);
    }

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 5: Get the entry info. \n %s%s%s%s", EMPTY, EMPTY, EMPTY, EMPTY);
    bcm_field_entry_info_t_init(&entry_info_get);
    SHR_IF_ERR_EXIT(bcm_field_entry_info_get(unit, fg_id, entry_id, &entry_info_get));

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 6: Compare the entry set and get values. \n %s%s%s%s", EMPTY, EMPTY, EMPTY,
                EMPTY);
    if (entry_info_get.nof_entry_quals != entry_info_p->nof_entry_quals)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "bcm_field_entry_info_get: Unexpected data returned. nof_entry_quals expected %d received %d.\n",
                     entry_info_p->nof_entry_quals, entry_info_get.nof_entry_quals);
    }

    for (qual_iter = 0; qual_iter < entry_info_get.nof_entry_quals; qual_iter++)
    {
        if (entry_info_get.entry_qual[qual_iter].type != entry_info_p->entry_qual[qual_iter].type)
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_entry_info_get: Unexpected data returned. qual_types expected %d received %d.\n",
                         entry_info_p->entry_qual[qual_iter].type, entry_info_get.entry_qual[qual_iter].type);
        }
        if (entry_info_get.entry_qual[qual_iter].value[0] != entry_info_p->entry_qual[qual_iter].value[0])
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_entry_info_get: Unexpected data returned. qual_value expected %d received %d.\n",
                         entry_info_p->entry_qual[qual_iter].value[0], entry_info_get.entry_qual[qual_iter].value[0]);
        }
        if (entry_info_get.entry_qual[qual_iter].mask[0] != entry_info_p->entry_qual[qual_iter].mask[0])
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_entry_info_get: Unexpected data returned. qual_mask expected %d received %d.\n",
                         entry_info_p->entry_qual[qual_iter].mask[0], entry_info_get.entry_qual[qual_iter].mask[0]);
        }
    }

    if (entry_info_get.nof_entry_actions != entry_info_p->nof_entry_actions)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "bcm_field_entry_info_get: Unexpected data returned. nof_entry_actions expected %d received %d.\n",
                     entry_info_p->nof_entry_actions, entry_info_get.nof_entry_actions);
    }

    for (action_iter = 0; action_iter < entry_info_get.nof_entry_actions; action_iter++)
    {
        if (entry_info_get.entry_action[action_iter].type != entry_info_p->entry_action[action_iter].type)
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_entry_info_get: Unexpected data returned. action_types expected %d received %d.\n",
                         entry_info_p->entry_action[action_iter].type, entry_info_get.entry_action[action_iter].type);
        }
        if (entry_info_get.entry_action[action_iter].value[0] != entry_info_p->entry_action[action_iter].value[0])
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_entry_info_get: Unexpected data returned. action_value expected %d received %d.\n",
                         entry_info_p->entry_action[action_iter].value[0],
                         entry_info_get.entry_action[action_iter].value[0]);
        }
    }

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 7: Get the context info. \n %s%s%s%s", EMPTY, EMPTY, EMPTY, EMPTY);
    bcm_field_context_info_t_init(&context_info_get);
    SHR_IF_ERR_EXIT(bcm_field_context_info_get(unit, bcmFieldStageExternal, context_id, &context_info_get));

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 8: Compare the context set and get values. \n %s%s%s%s", EMPTY, EMPTY, EMPTY,
                EMPTY);
    if (context_info_get.cascaded_from != context_info_p->cascaded_from)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "bcm_field_context_info_get: Unexpected data returned. cascaded_from expected %d received %d.\n",
                     context_info_p->cascaded_from, context_info_get.cascaded_from);
    }

    /** Check the context (apptype) name only in case of dynamic type. */
    if (opcode_type == 1)
    {
        if (strncmp((char *) context_info_p->name, (char *) context_info_get.name, sizeof(context_info_p->name)) != 0)
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_context_info_get: Unexpected data returned. context name expected %s received %s.\n",
                         context_info_p->name, context_info_get.name);
        }
    }

exit:
    SHR_FUNC_EXIT;
}

/**
 * \brief
 *  This function compares get and set info for the KBP configuration.
 *  DNX layer.
 *
 * \param [in] unit - Device ID
 * \param [in] opcode_type - Opcode type, can be static or dynamic
 * \param [in] fg_id - Id of the created FG
 * \param [in] entry_id - Id of the created Entry
 * \param [in] context_id - Id of the created Context
 * \param [in] fg_info_p - FG info
 * \param [in] attach_info_p - Attach info
 * \param [in] entry_info_p - Entry info
 * \param [in] apptype_info_p - Apptype info
 *
 * \return
 *  \retval _SHR_E_NONE - success
 */
static shr_error_e
ctest_dnx_field_kbp_sem_dnx_compare(
    int unit,
    int opcode_type,
    dnx_field_group_t fg_id,
    uint32 entry_id,
    dnx_field_context_t context_id,
    dnx_field_group_info_t * fg_info_p,
    dnx_field_group_attach_info_t * attach_info_p,
    dnx_field_entry_t * entry_info_p,
    dnx_field_context_apptype_info_t * apptype_info_p)
{
    dnx_field_group_full_info_t fg_info_get;
    dnx_field_group_context_full_info_t attach_info_get;
    dnx_field_entry_t entry_info_get;
    dnx_field_context_apptype_info_t apptype_info_get;
    dnx_field_context_t context_id_internal;
    uint32 opcode_id;
    int qual_iter, action_iter;

    SHR_FUNC_INIT_VARS(unit);

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 1: Get the info for the FG. \n %s%s%s%s", EMPTY, EMPTY, EMPTY, EMPTY);
    SHR_IF_ERR_EXIT(dnx_field_group_info_t_init(unit, &fg_info_get.group_basic_info));
    SHR_IF_ERR_EXIT(dnx_field_group_get(unit, fg_id, &fg_info_get));

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 2: Compare the FG set and get values. \n %s%s%s%s", EMPTY, EMPTY, EMPTY, EMPTY);

    for (qual_iter = 0; fg_info_get.group_basic_info.dnx_quals[qual_iter] == DNX_FIELD_QUAL_TYPE_INVALID; qual_iter++)
    {
        if (fg_info_get.group_basic_info.dnx_quals[qual_iter] != fg_info_p->dnx_quals[qual_iter])
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "dnx_field_group_get: Unexpected data returned. qual_types expected %d received %d.\n",
                         fg_info_p->dnx_quals[qual_iter], fg_info_get.group_basic_info.dnx_quals[qual_iter]);
        }
    }

    for (action_iter = 0; fg_info_get.group_basic_info.dnx_actions[action_iter] == DNX_FIELD_ACTION_INVALID;
         action_iter++)
    {
        if (fg_info_get.group_basic_info.dnx_actions[action_iter] != fg_info_p->dnx_actions[action_iter])
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "dnx_field_group_get: Unexpected data returned. action types expected %d received %d.\n",
                         fg_info_p->dnx_actions[action_iter], fg_info_get.group_basic_info.dnx_actions[action_iter]);
        }
    }

    if (fg_info_get.group_basic_info.field_stage != fg_info_p->field_stage)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "dnx_field_group_get: Unexpected data returned. stage expected %d received %d.\n",
                     fg_info_p->field_stage, fg_info_get.group_basic_info.field_stage);
    }

    if (fg_info_get.group_basic_info.fg_type != fg_info_p->fg_type)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "dnx_field_group_get: Unexpected data returned. fg_type expected %d received %d.\n",
                     fg_info_p->fg_type, fg_info_get.group_basic_info.fg_type);
    }

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 3: Get the attach info. \n %s%s%s%s", EMPTY, EMPTY, EMPTY, EMPTY);
    SHR_IF_ERR_EXIT(dnx_field_group_attach_info_t_init(unit, &attach_info_get.attach_basic_info));
    /** Convert apptype to opcode and pass it on as context. */
    SHR_IF_ERR_EXIT(dnx_field_map_apptype_to_opcode_bcm_to_dnx(unit, context_id, &opcode_id));
    context_id_internal = opcode_id;
    SHR_IF_ERR_EXIT(dnx_field_group_context_get(unit, fg_id, context_id_internal, &attach_info_get));

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 4: Compare the attach set and get values. \n %s%s%s%s", EMPTY, EMPTY, EMPTY,
                EMPTY);

    for (qual_iter = 0; attach_info_get.attach_basic_info.dnx_quals[qual_iter] == DNX_FIELD_QUAL_TYPE_INVALID;
         qual_iter++)
    {
        if (attach_info_get.attach_basic_info.dnx_quals[qual_iter] != attach_info_p->dnx_quals[qual_iter])
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "dnx_field_group_context_get: Unexpected data returned. qual_types expected %d received %d.\n",
                         attach_info_p->dnx_quals[qual_iter], attach_info_get.attach_basic_info.dnx_quals[qual_iter]);
        }
        if (attach_info_get.attach_basic_info.qual_info[qual_iter].input_type !=
            attach_info_p->qual_info[qual_iter].input_type)
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "dnx_field_group_context_get: Unexpected data returned. input_type expected %d received %d.\n",
                         attach_info_p->qual_info[qual_iter].input_type,
                         attach_info_get.attach_basic_info.qual_info[qual_iter].input_type);
        }
        if (attach_info_get.attach_basic_info.qual_info[qual_iter].input_arg !=
            attach_info_p->qual_info[qual_iter].input_arg)
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "dnx_field_group_context_get: Unexpected data returned. input_arg expected %d received %d.\n",
                         attach_info_p->qual_info[qual_iter].input_arg,
                         attach_info_get.attach_basic_info.qual_info[qual_iter].input_arg);
        }
        if (attach_info_get.attach_basic_info.qual_info[qual_iter].offset != attach_info_p->qual_info[qual_iter].offset)
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "dnx_field_group_context_get: Unexpected data returned. offset expected %d received %d.\n",
                         attach_info_p->qual_info[qual_iter].offset,
                         attach_info_get.attach_basic_info.qual_info[qual_iter].offset);
        }
    }

    for (action_iter = 0; attach_info_get.attach_basic_info.dnx_actions[action_iter] == DNX_FIELD_ACTION_INVALID;
         action_iter++)
    {
        if (attach_info_get.attach_basic_info.dnx_actions[action_iter] != attach_info_p->dnx_actions[action_iter])
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "dnx_field_group_context_get: Unexpected data returned. action types expected %d received %d.\n",
                         attach_info_p->dnx_actions[action_iter],
                         attach_info_get.attach_basic_info.dnx_actions[action_iter]);
        }
    }

    if (attach_info_get.attach_basic_info.payload_id != attach_info_p->payload_id)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "dnx_field_group_context_get: Unexpected data returned. payload_id expected %d received %d.\n",
                     attach_info_p->payload_id, attach_info_get.attach_basic_info.payload_id);
    }

    if (attach_info_get.attach_basic_info.payload_offset != attach_info_p->payload_offset)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "dnx_field_group_context_get: Unexpected data returned. payload_offset expected %d received %d.\n",
                     attach_info_p->payload_offset, attach_info_get.attach_basic_info.payload_offset);
    }

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 5: Get the entry info. \n %s%s%s%s", EMPTY, EMPTY, EMPTY, EMPTY);
    SHR_IF_ERR_EXIT(dnx_field_entry_t_init(unit, &entry_info_get));
    SHR_IF_ERR_EXIT(dnx_field_entry_kbp_get(unit, fg_id, entry_id, NULL, &entry_info_get));

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 6: Compare the entry set and get values. \n %s%s%s%s", EMPTY, EMPTY, EMPTY,
                EMPTY);

    for (qual_iter = 0; entry_info_get.key_info.qual_info[qual_iter].dnx_qual == DNX_FIELD_QUAL_TYPE_INVALID;
         qual_iter++)
    {
        if (entry_info_get.key_info.qual_info[qual_iter].dnx_qual !=
            entry_info_p->key_info.qual_info[qual_iter].dnx_qual)
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "dnx_field_entry_kbp_get: Unexpected data returned. qual_types expected %d received %d.\n",
                         entry_info_p->key_info.qual_info[qual_iter].dnx_qual,
                         entry_info_get.key_info.qual_info[qual_iter].dnx_qual);
        }
        if (entry_info_get.key_info.qual_info[qual_iter].qual_value[0] !=
            entry_info_p->key_info.qual_info[qual_iter].qual_value[0])
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "dnx_field_entry_kbp_get: Unexpected data returned. qual_value expected %d received %d.\n",
                         entry_info_p->key_info.qual_info[qual_iter].qual_value[0],
                         entry_info_get.key_info.qual_info[qual_iter].qual_value[0]);
        }
        if (entry_info_get.key_info.qual_info[qual_iter].qual_mask[0] !=
            entry_info_p->key_info.qual_info[qual_iter].qual_mask[0])
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "dnx_field_entry_kbp_get: Unexpected data returned. qual_mask expected %d received %d.\n",
                         entry_info_p->key_info.qual_info[qual_iter].qual_mask[0],
                         entry_info_get.key_info.qual_info[qual_iter].qual_mask[0]);
        }
    }

    for (action_iter = 0; entry_info_get.payload_info.action_info[action_iter].dnx_action == DNX_FIELD_ACTION_INVALID;
         action_iter++)
    {
        if (entry_info_get.payload_info.action_info[action_iter].dnx_action !=
            entry_info_p->payload_info.action_info[action_iter].dnx_action)
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "dnx_field_entry_kbp_get: Unexpected data returned. action_types expected %d received %d.\n",
                         entry_info_p->payload_info.action_info[action_iter].dnx_action,
                         entry_info_get.payload_info.action_info[action_iter].dnx_action);
        }
        if (entry_info_get.payload_info.action_info[action_iter].action_value[0] !=
            entry_info_p->payload_info.action_info[action_iter].action_value[0])
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "dnx_field_entry_kbp_get: Unexpected data returned. action_value expected %d received %d.\n",
                         entry_info_p->payload_info.action_info[action_iter].action_value[0],
                         entry_info_get.payload_info.action_info[action_iter].action_value[0]);
        }
    }

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 7: Get the Apptype info. \n %s%s%s%s", EMPTY, EMPTY, EMPTY, EMPTY);
    SHR_IF_ERR_EXIT(dnx_field_context_apptype_info_t_init(unit, &apptype_info_get));
    SHR_IF_ERR_EXIT(dnx_field_context_apptype_info_get(unit, context_id, &apptype_info_get));

    LOG_INFO_EX(BSL_LOG_MODULE, "Step 8: Compare the Apptype set and get values. \n %s%s%s%s", EMPTY, EMPTY, EMPTY,
                EMPTY);
    if (apptype_info_get.base_static_apptype != apptype_info_p->base_static_apptype)
    {
        SHR_ERR_EXIT(_SHR_E_FAIL,
                     "bcm_field_context_info_get: Unexpected data returned. base_static_apptype expected %d received %d.\n",
                     apptype_info_p->base_static_apptype, apptype_info_get.base_static_apptype);
    }

    /** Check the context (apptype) name only in case of dynamic type. */
    if (opcode_type == 1)
    {
        if (strncmp(apptype_info_p->name, apptype_info_get.name, sizeof(apptype_info_p->name)) != 0)
        {
            SHR_ERR_EXIT(_SHR_E_FAIL,
                         "bcm_field_context_info_get: Unexpected data returned. apptype name expected %s received %s.\n",
                         apptype_info_p->name, apptype_info_get.name);
        }
    }

exit:
    SHR_FUNC_EXIT;
}

/**
 * \brief
 *  This function runs semantic tests for KBP (fg, attach and entry).
 *
 * \param [in] unit - Device ID
 * \param [in] args - Extra arguments
 * \param [in] sand_control - Control information related to each of the 'options' entered by the caller (and contained in
 *   'args')
 * \return
 *  \retval _SHR_E_NONE - success
 */
static shr_error_e
ctest_dnx_field_kbp_sem_run(
    int unit,
    args_t * args,
    sh_sand_control_t * sand_control)
{
    int test_type;
    int opcode_type;
    SHR_FUNC_INIT_VARS(unit);

    SH_SAND_GET_ENUM(DNX_DIAG_FIELD_KBP_SEM_OPTION_TEST_TYPE, test_type);
    SH_SAND_GET_ENUM(DNX_DIAG_FIELD_KBP_SEM_OPTION_OPCODE_TYPE, opcode_type);

    if (test_type == 0)
    {
        bcm_field_group_t fg_id;
        bcm_field_group_t fg_id_shared;
        bcm_field_entry_t entry_id;
        bcm_field_entry_t entry_id_shared;
        bcm_field_context_t context_id = 0;
        bcm_field_group_info_t fg_info;
        bcm_field_group_attach_info_t attach_info;
        bcm_field_entry_info_t entry_info;
        bcm_field_context_info_t context_info;

        SHR_IF_ERR_EXIT(ctest_dnx_field_kbp_sem_bcm_config
                        (unit, opcode_type, &fg_id, &fg_id_shared, &entry_id, &entry_id_shared, &context_id,
                         &fg_info, &attach_info, &entry_info, &context_info));

        SHR_IF_ERR_EXIT(ctest_dnx_field_kbp_sem_bcm_compare
                        (unit, opcode_type, fg_id, entry_id, context_id, &fg_info, &attach_info, &entry_info,
                         &context_info));
    }
    else if (test_type == 1)
    {
        dnx_field_group_t fg_id;
        uint32 entry_id;
        dnx_field_context_t context_id = 0;
        dnx_field_group_info_t fg_info;
        dnx_field_group_attach_info_t attach_info;
        dnx_field_entry_t entry_info;
        dnx_field_context_apptype_info_t apptype_info;

        SHR_IF_ERR_EXIT(ctest_dnx_field_kbp_sem_dnx_config
                        (unit, opcode_type, &fg_id, &entry_id, &context_id, &fg_info, &attach_info, &entry_info,
                         &apptype_info));

        SHR_IF_ERR_EXIT(ctest_dnx_field_kbp_sem_dnx_compare
                        (unit, opcode_type, fg_id, entry_id, context_id, &fg_info, &attach_info, &entry_info,
                         &apptype_info));
    }
    else
    {
        LOG_INFO_EX(BSL_LOG_MODULE,
                    "%s(), line %d, Option %d (for 'type') is not implemented. Illegal parameter. %s\r\n",
                    __func__, __LINE__, test_type, EMPTY);
        SHR_IF_ERR_EXIT(_SHR_E_PARAM);
    }

exit:
    SHR_FUNC_EXIT;
}

/**
 * \brief - runs the KBP SEM ctest
 *
 * \param [in] unit - the unit number in system
 * \param [in] args - pointer to args_t, not passed down
 * \param [in,out] sand_control - pointer to sh_sand_control_t, not
 *  passed down
 *
 *  Usage: run in BCM shell "ctest field kbp_sem"
 */
shr_error_e
sh_dnx_field_kbp_sem_cmd(
    int unit,
    args_t * args,
    sh_sand_control_t * sand_control)
{
    int count_iter, count;
    SHR_FUNC_INIT_VARS(unit);

    SH_SAND_GET_UINT32(DNX_DIAG_FIELD_KBP_SEM_OPTION_COUNT, count);

    for (count_iter = 0; count_iter < count; count_iter++)
    {
        SHR_IF_ERR_EXIT(ctest_dnx_field_kbp_sem_run(unit, args, sand_control));
    }

exit:
    SHR_FUNC_EXIT;
}
