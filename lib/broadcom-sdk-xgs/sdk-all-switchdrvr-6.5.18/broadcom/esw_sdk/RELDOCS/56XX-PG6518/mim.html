<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDK API Guide: MAC-in-MAC Management</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css"/>
<link href="tabs_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SDK API Guide
   &#160;<span id="projectnumber">Version 6.5.18</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">MAC-in-MAC Management </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The BCM56634 and BCM56524 families of devices provide MAC-in-MAC functionality. The BCM MAC-in-MAC APIs allow application developers to manage the Broadcom MAC-in-MAC features.</p>
<h1><a class="anchor" id="mim_overview"></a>
MAC-in-MAC Overview</h1>
<p>MAC-in-MAC is a Layer 2 encapsulation technology, similar in many ways to VPLS. The objective is to provide virtual bridging services to groups of customers. MAC-in-MAC is proposed as an alternative to VPLS with the advantages of reduced control plane overhead and the use of native L2 multicast and broadcast mechanisms.</p>
<p>MAC-in-MAC is used in core networks, known as Provider Backbone Bridged Networks (PBBN) that are used to provide connectivity among multiple Provider Bridged Networks (PBN). The MAC-in-MAC encapsulation contains a 24-bit field known as the I-SID, which denotes the service instance. A service instance may correspond to a PBN.</p>
<p>In this abstraction, two main constructs are provided: VPNs and "virtual ports" or MAC-in-MAC ports. The application first needs to create a VPN, which represents a service instance. It then must create interfaces or MAC-in-MAC ports and associate them with the VPN. This is done on systems at the edge of the PBBN. There are two kinds of interfaces: network facing (these contain information about the outer L2 encapsulation) and access facing (these contain information about matching S-tag and C-tag attributes).</p>
<h1><a class="anchor" id="mim_data_types"></a>
MAC-in-MAC Data Types</h1>
<ul>
<li>bcm_mim_vpn_t is the ID that uniquely identifies a layer 2 or layer 3 VPN instance. bcm_mim_vpn_t is defined as bcm_vlan_t so it can be used in APIs with bcm_vlan_t parameters (for example, bcm_l2_addr_add can be used to add MAC-in-MAC L2 entries using a MAC-in-MAC bcm_mim_vpn_t value).</li>
<li>The bcm_mim_vpn_config_t structure describes the MAC-in-MAC VPN attributes. It allows the application to configure different broadcast, multicast and unknown unicast groups.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__mim__vpn__config__s.html">bcm_mim_vpn_config_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mim__vpn__config__s.html#a81a27ce50e78368b0d0de1e8767fd32d">flags</a>;                   <span class="comment">/* BCM_MIM_VPN_xxx. */</span></div><div class="line">    <a class="code" href="group__types.html#ga68ce0f3918ff6c997e4192f2932ef457">bcm_mim_vpn_t</a> <a class="code" href="structbcm__mim__vpn__config__s.html#a6f99cdf9a3386ea4dfc834ceaa3a40be">vpn</a>;              <span class="comment">/* VPN ID */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__mim__vpn__config__s.html#aa13de1c066ce6d743aa952ee449efe0f">lookup_id</a>;                  <span class="comment">/* The I-SID value */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mim__vpn__config__s.html#a671d9302c8b4c4318e5d9cdf56929c26">match_service_tpid</a>;      <span class="comment">/* Incoming SD tag TPID */</span></div><div class="line">    <a class="code" href="group__types.html#ga0f3f07b8f11cb4e625b0f42d6cc7f94c">bcm_multicast_t</a> <a class="code" href="structbcm__mim__vpn__config__s.html#a114da9007e9014c9b8cb11206e0e0163">broadcast_group</a>;</div><div class="line">    <a class="code" href="group__types.html#ga0f3f07b8f11cb4e625b0f42d6cc7f94c">bcm_multicast_t</a> <a class="code" href="structbcm__mim__vpn__config__s.html#a23da875b7522ca342116c784be3cdcc1">unknown_unicast_group</a>;</div><div class="line">    <a class="code" href="group__types.html#ga0f3f07b8f11cb4e625b0f42d6cc7f94c">bcm_multicast_t</a> <a class="code" href="structbcm__mim__vpn__config__s.html#aea986011b6e84795ff6689a580e315ae">unknown_multicast_group</a>;</div><div class="line">    <a class="code" href="group__types.html#ga252d53447d82acf3fb573f1918e7f251">bcm_policer_t</a> <a class="code" href="structbcm__mim__vpn__config__s.html#a143d6b42473f4c7f524f7980b2f02ee3">policer_id</a>;       <span class="comment">/* Policer ID to be used */</span></div><div class="line">    <a class="code" href="group__types.html#ga30e6e81bfad0b18e55d3a1c8148fd75d">bcm_if_t</a> <a class="code" href="structbcm__mim__vpn__config__s.html#a334db763357779a9625519aa123f61c4">service_encap_id</a>;      <span class="comment">/* Service encap Identifier */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__mim__vpn__config__s.html#a54d09c2ea30d38c9258f758ed92989af">inlif_counting_profile</a>;     <span class="comment">/* In LIF counting profile */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__mim__vpn__config__s.html#af6ad039dbf5967db3b9664ea9267d81a">outlif_counting_profile</a>;    <span class="comment">/* Out LIF counting profile */</span></div><div class="line">    <a class="code" href="structbcm__vlan__protocol__packet__ctrl__s.html">bcm_vlan_protocol_packet_ctrl_t</a> <a class="code" href="structbcm__mim__vpn__config__s.html#a21488e97491ed200184d5b34530706b1">protocol_pkt</a>; <span class="comment">/* Protocol packet control */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mim__vpn__config__s.html#a1fff9352b8c83e37662b5abfa0bda831">egress_service_tpid</a>;     <span class="comment">/* egress SD tag TPID */</span></div><div class="line">    <a class="code" href="group__types.html#ga4ccf23ca53e7e7e9a7be38b950aa7943">bcm_mac_t</a> <a class="code" href="structbcm__mim__vpn__config__s.html#ae135ef93ae7bde190bb56663fae8f705">match_service_smac</a>    <span class="comment">/* Source B-MAC address */</span></div><div class="line">} <a class="code" href="group__mim.html#ga722a70221a851b8f4743c9a8872b0a6e">bcm_mim_vpn_config_t</a>;</div></div><!-- fragment --><ul>
<li>The bcm_mim_port_t structure describes an MAC-in-MAC port (or "virtual-port") used for VPNs:</li>
</ul>
<a class="anchor" id=""></a>
<table class="doxtable">
<caption>MiM port Match Criteria</caption>
<tr>
<td>BCM_MIM_PORT_MATCH_PORT </td><td>Match on the physical port.  </td></tr>
<tr>
<td>BCM_MIM_PORT_MATCH_PORT_VLAN </td><td>Match on the physical port and the outer VLAN.  </td></tr>
<tr>
<td>BCM_MIM_PORT_MATCH_PORT_VLAN_STACKED </td><td>Match on the physical port, outer and inner VLANs.  </td></tr>
<tr>
<td>BCM_MIM_PORT_MATCH_TUNNEL_VLAN_SRCMAC </td><td>Match on the VLAN and source MAC of the outer MAC-in-MAC encapsulation.  </td></tr>
<tr>
<td>BCM_MIM_PORT_MATCH_LABEL </td><td>Match on the MPLS label.  </td></tr>
<tr>
<td>BCM_MIM_PORT_MATCH_SHARE </td><td>Multiple matches share one MiM port.  </td></tr>
</table>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__mim__port__s.html">bcm_mim_port_s</a> {</div><div class="line">    <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> <a class="code" href="structbcm__mim__port__s.html#a975484b5d98dc363bfdd76abbfc0fcce">mim_port_id</a>;        <span class="comment">/* Interface ID (VP). */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mim__port__s.html#a81a27ce50e78368b0d0de1e8767fd32d">flags</a>;                   <span class="comment">/* Configuration flags */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__mim__port__s.html#afb43724358a2930f11effd8bbb6cdf71">if_class</a>;                   <span class="comment">/* Interface class ID. */</span></div><div class="line">    <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> <a class="code" href="structbcm__mim__port__s.html#a56da6f3a91f2f6d38953ef7c66fa78b2">port</a>;               <span class="comment">/* Physical port / trunk. */</span></div><div class="line">    <a class="code" href="group__mim.html#gadb1374d06fc4c05879db1f091800a9d9">bcm_mim_port_match_t</a> <a class="code" href="structbcm__mim__port__s.html#a854c263e017b226199965b07c5b4f980">criteria</a>;  <span class="comment">/* Match criteria. */</span></div><div class="line">    <a class="code" href="group__types.html#ga206cad73150c7e799b9a1cd4ebe13465">bcm_vlan_t</a> <a class="code" href="structbcm__mim__port__s.html#ad22679e36d7259c4d88d606c80d6d4c5">match_vlan</a>;          <span class="comment">/* S-Tag. */</span></div><div class="line">    <a class="code" href="group__types.html#ga206cad73150c7e799b9a1cd4ebe13465">bcm_vlan_t</a> <a class="code" href="structbcm__mim__port__s.html#ad4878e6cfd724f3e83cb9fab60ae73d9">match_inner_vlan</a>;    <span class="comment">/* C-Tag. */</span></div><div class="line">    <a class="code" href="group__types.html#ga7f4890ec7a6446a0a6c0cb66ed180627">bcm_mpls_label_t</a> <a class="code" href="structbcm__mim__port__s.html#a9eccc4850274e24cd8ff416123a95be4">match_label</a>;   <span class="comment">/* MPLS label. */</span></div><div class="line">    <a class="code" href="group__types.html#ga206cad73150c7e799b9a1cd4ebe13465">bcm_vlan_t</a> <a class="code" href="structbcm__mim__port__s.html#abb96b2ea8f9dd0bf71fe01782544f6c1">match_tunnel_vlan</a>;   <span class="comment">/* B-domain VID. */</span></div><div class="line">    <a class="code" href="group__types.html#ga4ccf23ca53e7e7e9a7be38b950aa7943">bcm_mac_t</a> <a class="code" href="structbcm__mim__port__s.html#af5517bd3a007a89ef8f27cea986b699c">match_tunnel_srcmac</a>;  <span class="comment">/* Source MAC address. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mim__port__s.html#a671d9302c8b4c4318e5d9cdf56929c26">match_service_tpid</a>;      <span class="comment">/* Incoming SD tag TPID */</span></div><div class="line">    <a class="code" href="group__types.html#ga206cad73150c7e799b9a1cd4ebe13465">bcm_vlan_t</a> <a class="code" href="structbcm__mim__port__s.html#af536251e3927776c7c6e604f7c8ac3b0">egress_tunnel_vlan</a>;  <span class="comment">/* B-domain VID. */</span></div><div class="line">    <a class="code" href="group__types.html#ga4ccf23ca53e7e7e9a7be38b950aa7943">bcm_mac_t</a> <a class="code" href="structbcm__mim__port__s.html#a1b9fedea525861def6162c06b288bed0">egress_tunnel_srcmac</a>; <span class="comment">/* Source MAC address. */</span></div><div class="line">    <a class="code" href="group__types.html#ga4ccf23ca53e7e7e9a7be38b950aa7943">bcm_mac_t</a> <a class="code" href="structbcm__mim__port__s.html#ae32b71397b3368929386e6808895e145">egress_tunnel_dstmac</a>; <span class="comment">/* Dest MAC address. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mim__port__s.html#a5ec48a4175bdaf526ee3f92090a1a449">egress_tunnel_service</a>;   <span class="comment">/* Egress I-SID translation. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mim__port__s.html#a1fff9352b8c83e37662b5abfa0bda831">egress_service_tpid</a>;     <span class="comment">/* SD tag. */</span></div><div class="line">    <a class="code" href="group__types.html#ga206cad73150c7e799b9a1cd4ebe13465">bcm_vlan_t</a> <a class="code" href="structbcm__mim__port__s.html#a1932bbe3be97a39a126950ed7442974a">egress_service_vlan</a>; <span class="comment">/* SD tag. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mim__port__s.html#a84d5f77ec3ffae5b1be542b5437440a2">egress_service_pri</a>;       <span class="comment">/* SD tag pri */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mim__port__s.html#a173edadeaed8681dad89fbcc88d06f72">egress_service_cfi</a>;       <span class="comment">/* SD tag cfi */</span></div><div class="line">    <a class="code" href="group__types.html#ga30e6e81bfad0b18e55d3a1c8148fd75d">bcm_if_t</a> <a class="code" href="structbcm__mim__port__s.html#a399a9c2e57c84182ae4d633fb9340f11">encap_id</a>;              <span class="comment">/* Encap identifier. */</span></div><div class="line">    <a class="code" href="group__types.html#gaf273a2d08ebc6fc3e5d0319aeb414ceb">bcm_failover_t</a> <a class="code" href="structbcm__mim__port__s.html#a5814080f31ea8ec26e594e85df149197">failover_id</a>;     <span class="comment">/* Failover Object identifier. */</span></div><div class="line">    <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> <a class="code" href="structbcm__mim__port__s.html#afd52f4d1711d14c1049d959d83122d17">failover_gport_id</a>;  <span class="comment">/* Failover MiM Port identifier. */</span></div><div class="line">    <a class="code" href="group__types.html#ga0f3f07b8f11cb4e625b0f42d6cc7f94c">bcm_multicast_t</a> <a class="code" href="structbcm__mim__port__s.html#a4568255a6fca642871c55ef3d1a1c029">failover_mc_group</a>;  <span class="comment">/* MC group used for bi-cast. */</span></div><div class="line">    <a class="code" href="group__types.html#gaf273a2d08ebc6fc3e5d0319aeb414ceb">bcm_failover_t</a> <a class="code" href="structbcm__mim__port__s.html#a7d5e95597de4672dda1ccf15830b2102">ingress_failover_id</a>; <span class="comment">/* 1+1 protection. */</span></div><div class="line">    <a class="code" href="group__types.html#ga30e6e81bfad0b18e55d3a1c8148fd75d">bcm_if_t</a> <a class="code" href="structbcm__mim__port__s.html#a334db763357779a9625519aa123f61c4">service_encap_id</a>;          <span class="comment">/* Service encap Identifier */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mim__port__s.html#a630d812a47a869eb40694bb145c96cb0">int_pri</a>;                      <span class="comment">/* Fixed priority */</span></div><div class="line">    <a class="code" href="group__types.html#ga356b17d1510b1781318bb0f840405e28">bcm_switch_network_group_t</a> <a class="code" href="structbcm__mim__port__s.html#af6d0ee687a1817417e66796f5af67a99">network_group_id</a>; <span class="comment">/* Switch split horizon network group ID this MiM port belongs to */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__mim__port__s.html#a54d09c2ea30d38c9258f758ed92989af">inlif_counting_profile</a>;         <span class="comment">/* In LIF counting profile */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__mim__port__s.html#af6ad039dbf5967db3b9664ea9267d81a">outlif_counting_profile</a>;        <span class="comment">/* Out LIF counting profile */</span></div><div class="line">} <a class="code" href="group__mim.html#gaa135b8d31c230c863917696eec988157">bcm_mim_port_t</a>;</div></div><!-- fragment --><p>A MAC-in-MAC port is a "virtual-port" that can be added to an L2 VPN. A MAC-in-MAC port can be:</p><ul>
<li>A Backbone port (used to identify MAC-in-MAC encapsulation attributes)</li>
<li>An Access port (identified by any combination of physical port, outer VLAN, inner VLAN)</li>
<li>A Peer port (used to identify MAC-in-MAC encapsulation attributes along and is associated with a specific VPN) MAC-in-MAC backbone ports are not associated with a VPN - they represent L2 encapsulation attributes and can be shared across VPNs. The access and peer ports are associated with specific VPNs. Each MAC-in-MAC port has a unique GPORT identifier, mim_port_id, that is allocated by the SDK when a new MAC-in-MAC port is added. An MAC-in-MAC port consists of ingress and egress parameters. The ingress parameters are the "match" attributes, which are used to associate incoming packets with an MAC-in-MAC port based on incoming physical port and/or packet header information. The "egress" attributes identify the actions on outgoing packets. The flags define which information is used as match and egress criteria.</li>
</ul>
<h1><a class="anchor" id="mim_generic_apis"></a>
Generic MAC-in-MAC APIs</h1>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<div class="footer-brcm-wrapper">
<table class="footer-brcm">
	<tbody><tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align="left"></td>
		<td class="footer-brcm"><small><b>Proprietary and Confidential &copy; 2019 Broadcom</b></small>
			<div class="footer-brcm">Broadcom Incorporated reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design.
Information furnished by Broadcom Incorporated is believed to be accurate and reliable. However, Broadcom Incorporated does not assume any liability arising
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license
under its patent rights nor the rights of others.
			</div>
		</td>
	</tr>
</tbody></table>
</div>
</body>
</html>
