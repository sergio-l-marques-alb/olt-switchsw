<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDK API Guide: Explicit Congestion Notification (ECN)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css"/>
<link href="tabs_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SDK API Guide
   &#160;<span id="projectnumber">Version 6.5.18</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Explicit Congestion Notification (ECN) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Explicit Congestion Notification (ECN) uses two bits of DiffServ in the IP header. Base on the ECN value, IP packets are classified to ECT (ECN Capable Transport), CE (Congestion Experienced) and non-ECT. ECN allows endpoints to singal the network congestion without dropping packets. Some XGS devices have the ability to support the ECN inheritance during tunnel initiation and termination. It also leverages ECN marking capabilities to detect the level congestion in the network.</p>
<p>The BCM ECN API provides a mechanism to configure the related tables of devices which support this feature, including the capability to map the internal congestion status(int_cn) and to mark a new ECN value base on the original ECN value in the packet's IP header and the internal congestion status.</p>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__ecn.html#gafc494300efbc5fb36674b3e8c9219121" title="To configure the value of responsive indication of the IP protocol value.">bcm_ecn_responsive_protocol_get(int unit, uint8 ip_proto, int* responsive)</a>  </td><td>To configure the value of responsive indication of the IP protocol value.   </td></tr>
<tr>
<td><a class="el" href="group__ecn.html#ga637358a400a28dec9142e633ffb2cc78" title="To configure the value of responsive indication of the IP protocol value.">bcm_ecn_responsive_protocol_set(int unit, uint8 ip_proto, int responsive)</a>  </td><td>To configure the value of responsive indication of the IP protocol value.   </td></tr>
</table>
<div class="fragment"><div class="line"><span class="comment">/* ECN traffic map info. */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__ecn__traffic__map__info__s.html">bcm_ecn_traffic_map_info_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__ecn__traffic__map__info__s.html#a81a27ce50e78368b0d0de1e8767fd32d">flags</a>;                       <span class="comment">/* BCM_ECN_TRAFFIC_MAP_XXX flag</span></div><div class="line"><span class="comment">                                           definitions. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__ecn__traffic__map__info__s.html#a63d9cb10dff84b39c046e0ca5ed752aa">ecn</a>;                          <span class="comment">/* ECN value of packet&#39;s IP header. */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__ecn__traffic__map__info__s.html#a09582110f15dd839a8e5ddb7a8ba9693">int_cn</a>;                         <span class="comment">/* Mapped internal congestion</span></div><div class="line"><span class="comment">                                           notification(int_cn) value. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__ecn__traffic__map__info__s.html#a9ccd464570c0e68a81fec11cce6a68d2">tunnel_ecn</a>;                   <span class="comment">/* ECN information of packet&#39;s tunnel</span></div><div class="line"><span class="comment">                                           header. */</span></div><div class="line">    <a class="code" href="group__ecn.html#ga3108870ecb50069f73ac4d60c8bc607f">bcm_ecn_traffic_map_tunnel_type_t</a> <a class="code" href="structbcm__ecn__traffic__map__info__s.html#a9c5e17022c58916e803d592661d131c9">tunnel_type</a>; <span class="comment">/* Tunnel type. */</span></div><div class="line">} <a class="code" href="group__ecn.html#ga101b0cfddf46097c59d7e4e0369acdd6">bcm_ecn_traffic_map_info_t</a>;</div></div><!-- fragment --><table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__ecn.html#ga321d0dc1a350e4a028c76ea9a09b709e" title="Initialize an ECN traffic map information structure.">bcm_ecn_traffic_map_info_t_init(bcm_ecn_traffic_map_info_t* ecn_map)</a>  </td><td>Initialize an ECN traffic map information structure.   </td></tr>
<tr>
<td><a class="el" href="group__ecn.html#gadc7f5ff92fb77a21362ca0032f3304a3" title="To set/get the mapped internal congestion notification (int_cn).">bcm_ecn_traffic_map_get(int unit, bcm_ecn_traffic_map_info_t* map)</a>  </td><td>To set/get the mapped internal congestion notification (int_cn).   </td></tr>
<tr>
<td><a class="el" href="group__ecn.html#ga9a4844e78c7294ff06e600a936f7a847" title="To set/get the mapped internal congestion notification (int_cn).">bcm_ecn_traffic_map_set(int unit, bcm_ecn_traffic_map_info_t* map)</a>  </td><td>To set/get the mapped internal congestion notification (int_cn).   </td></tr>
</table>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * ECN traffic action configuration.</span></div><div class="line"><span class="comment">  </span></div><div class="line"><span class="comment"> * Contains information required for assigning the actions of ECN</span></div><div class="line"><span class="comment"> * traffic.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__ecn__traffic__action__config__s.html">bcm_ecn_traffic_action_config_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__ecn__traffic__action__config__s.html#aa22a3572ff82ee1cd6acb599b65c268d">action_type</a>;         <span class="comment">/* See BCM_ECN_TRAFFIC_ACTION_TYPE_XXX flag</span></div><div class="line"><span class="comment">                                   definitions. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__ecn__traffic__action__config__s.html#ac6b079ff70020f3b84577d5be886f2ee">action_flags</a>;        <span class="comment">/* See BCM_ECN_TRAFFIC_ACTION_XXX flag</span></div><div class="line"><span class="comment">                                   definitions. */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__ecn__traffic__action__config__s.html#a09582110f15dd839a8e5ddb7a8ba9693">int_cn</a>;                 <span class="comment">/* Internal congestion notification. */</span></div><div class="line">    <a class="code" href="group__types.html#ga24111d898bb4ee4a12793dfa40c3a79d">bcm_color_t</a> <a class="code" href="structbcm__ecn__traffic__action__config__s.html#aa6237919183657a4dff521eb0076d310">color</a>;          <span class="comment">/* Packet color. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__ecn__traffic__action__config__s.html#a63d9cb10dff84b39c046e0ca5ed752aa">ecn</a>;                  <span class="comment">/* ECN value of packet;s IP header. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__ecn__traffic__action__config__s.html#a8ec0b6a77eb7f78146a05382e021d3a3">new_ecn</a>;              <span class="comment">/* New ECN value for remarking. */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__ecn__traffic__action__config__s.html#a949287fb1f23b177c8c24af7f7def059">congested_int_cn</a>;       <span class="comment">/* New int_cn to be updated when the congestion</span></div><div class="line"><span class="comment">                                   is experienced. */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__ecn__traffic__action__config__s.html#ad8ebffce76fe7ce2c0ea933275862fc9">non_congested_int_cn</a>;   <span class="comment">/* New int_cn to be updated when the congestion</span></div><div class="line"><span class="comment">                                   is not experienced. */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__ecn__traffic__action__config__s.html#a2030070f141c5fea9c65d0606b01e3f3">responsive</a>;             <span class="comment">/* New responsive value to be used in the egress</span></div><div class="line"><span class="comment">                                   pipeline. */</span></div><div class="line">} <a class="code" href="group__ecn.html#gaf7e01a3401fb4824ec47b762b6f761cb">bcm_ecn_traffic_action_config_t</a>;</div></div><!-- fragment --><table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__ecn.html#gadaf8223fdc63f529388ad9b3d6348e8f" title="Initialize an ECN traffic action configure structure.">bcm_ecn_traffic_action_config_t_init(bcm_ecn_traffic_action_config_t* ecn_action)</a>  </td><td>Initialize an ECN traffic action configure structure.   </td></tr>
<tr>
<td><a class="el" href="group__ecn.html#ga8ff90bcec132b8777f5be90d91996ed2" title="Assign/Retrieve the actions to the specified ECN traffic.">bcm_ecn_traffic_action_config_get(int unit, bcm_ecn_traffic_action_config_t* ecn_config)</a>  </td><td>Assign/Retrieve the actions to the specified ECN traffic.   </td></tr>
<tr>
<td><a class="el" href="group__ecn.html#ga959e7682e2065ae93ee9fca05a340a03" title="Assign/Retrieve the actions to the specified ECN traffic.">bcm_ecn_traffic_action_config_set(int unit, bcm_ecn_traffic_action_config_t* ecn_config)</a>  </td><td>Assign/Retrieve the actions to the specified ECN traffic.   </td></tr>
<tr>
<td><a class="el" href="group__ecn.html#gad7d75d74f7957728406320840f3f1934" title="To create an ECN mapping profile.">bcm_ecn_map_create(int unit, uint32 flags, int* ecn_map_id)</a>  </td><td>To create an ECN mapping profile.   </td></tr>
<tr>
<td><a class="el" href="group__ecn.html#gaf5c9b8fc7cbfdc0142a74a0713701d3f" title="To destroy an ECN mapping profile.">bcm_ecn_map_destroy(int unit, int ecn_map_id)</a>  </td><td>To destroy an ECN mapping profile.   </td></tr>
</table>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__ecn__map__s.html">bcm_ecn_map_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__ecn__map__s.html#ac6b079ff70020f3b84577d5be886f2ee">action_flags</a>;        <span class="comment">/* action flags for ECN map. */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__ecn__map__s.html#a09582110f15dd839a8e5ddb7a8ba9693">int_cn</a>;                 <span class="comment">/* Internal congestion. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__ecn__map__s.html#a203de3fce5b12967e74770e69a140371">inner_ecn</a>;            <span class="comment">/* IP ECN value in payload. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__ecn__map__s.html#a63d9cb10dff84b39c046e0ca5ed752aa">ecn</a>;                  <span class="comment">/* IP ECN value. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__ecn__map__s.html#a28a48b62e5550cb9f3be77913be56f45">exp</a>;                  <span class="comment">/* Mpls EXP value. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__ecn__map__s.html#a8ec0b6a77eb7f78146a05382e021d3a3">new_ecn</a>;              <span class="comment">/* New ECN value. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__ecn__map__s.html#ad20a22850f98d9a76d7eb1dc4de2e611">new_exp</a>;              <span class="comment">/* New EXP value. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__ecn__map__s.html#a2b467f80d7e5d5dba6cfc50be83ee167">nonip_action_flags</a>;  <span class="comment">/* action flags for Non-ip ECN map. */</span></div><div class="line">} <a class="code" href="group__ecn.html#ga3fdc22232f12c211872e8de7fa74080d">bcm_ecn_map_t</a>;</div></div><!-- fragment --><p>bcm_ecn_map_t contains information used when setting or retrieving MPLS ecn information.</p>
<p>The action_flags field in Ecn map structure may take on values which are the logical OR of one or more of the flags from table <a class="el" href="group__ecn.html#BCM_ECN_TRAFFIC_ACTION_FLAG_f">BCM_ECN_TRAFFIC_ACTION_FLAG_f</a></p>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__ecn.html#ga8804fc103fa50964a2a58e8cb095e82b" title="To set an ECN mapping entry in an ECN mapping profile.">bcm_ecn_map_set(int unit, uint32 options, int ecn_map_id, bcm_ecn_map_t* ecn_map)</a>  </td><td>To set an ECN mapping entry in an ECN mapping profile.   </td></tr>
<tr>
<td><a class="el" href="group__ecn.html#ga4c1ba3d1d1e88cce121ebfc3817811df" title="To get an ECN mapping entry from an ECN mapping profile.">bcm_ecn_map_get(int unit, int ecn_map_id, bcm_ecn_map_t* ecn_map)</a>  </td><td>To get an ECN mapping entry from an ECN mapping profile.   </td></tr>
<tr>
<td><a class="el" href="group__ecn.html#gae2f0fba99e3879e6a3cbc2aed8582ac1" title="To init an ECN mapping structure.">bcm_ecn_map_t_init(bcm_ecn_map_t* ecn_map)</a>  </td><td>To init an ECN mapping structure.   </td></tr>
</table>
<div class="fragment"><div class="line"><span class="comment">/* MPLS ecn port Map Structure. */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__ecn__port__map__s.html">bcm_ecn_port_map_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__ecn__port__map__s.html#a81a27ce50e78368b0d0de1e8767fd32d">flags</a>;   <span class="comment">/* flags for ECN port map. */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__ecn__port__map__s.html#aebb0941f927587f6b1abaf1377889606">ecn_map_id</a>; <span class="comment">/* Ecn map id. */</span></div><div class="line">} <a class="code" href="group__ecn.html#ga27d679bf27362cda926f1a33d5cb8c30">bcm_ecn_port_map_t</a>;</div></div><!-- fragment --><table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__ecn.html#gaca6e85cf107ef60ead100d49c9433cb3" title="To set/get the egress ecn_map_id on the specific port.">bcm_ecn_port_map_set(int unit, bcm_gport_t port, bcm_ecn_port_map_t* ecn_map)</a>  </td><td>To set/get the egress ecn_map_id on the specific port.   </td></tr>
<tr>
<td><a class="el" href="group__ecn.html#ga2ecf252ad1d6cb400a08fbe0120568c7" title="To set/get the egress ecn_map_id on the specific port.">bcm_ecn_port_map_get(int unit, bcm_gport_t port, bcm_ecn_port_map_t* ecn_map)</a>  </td><td>To set/get the egress ecn_map_id on the specific port.   </td></tr>
<tr>
<td><a class="el" href="group__ecn.html#ga7cd168e0e1509505172ebaf6a925fb5b" title="To initialize an ecn port map structure.">bcm_ecn_port_map_t_init(bcm_ecn_port_map_t* ecn_map)</a>  </td><td>To initialize an ecn port map structure.   </td></tr>
</table>
<p>The ECN DSCP map modes define how to map inner IP header's ECN from outer IP header's on decapsulation. Mode bcmEcnDscpMapModeRfc3168 indicates that inner IP header's ECN will be copied from outer IP's only when outer header's ECN is CE and inner header's ECN isn't not-ECT. This is the full-functionality option for decapsulation defined in RFC3168.</p>
<p><a class="anchor" id="BCM_ECN_DSCP_MAP_MODES_table"></a></p><a class="anchor" id=""></a>
<table class="doxtable">
<caption>ECN DSCP Map Modes</caption>
<tr>
<th>Name </th><th>Purpose  </th></tr>
<tr>
<td>bcmEcnDscpMapModeDraft </td><td>Draft mode  </td></tr>
<tr>
<td>bcmEcnDscpMapModeRfc3168 </td><td>RFC 3168 mode  </td></tr>
</table>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__ecn.html#gaba7103ae09cf538e91dd861567e2721a" title="To initialize an ecn mapping mode structure.">bcm_ecn_map_mode_t_init(bcm_ecn_map_mode_t* ecn_map_mode)</a>  </td><td>To initialize an ecn mapping mode structure.   </td></tr>
<tr>
<td><a class="el" href="group__ecn.html#gaf1098d9c7609fd7844ab7bf76e0e68bc" title="Configure the ECN mapping mode.">bcm_ecn_map_mode_set(int unit, bcm_ecn_map_mode_t* ecn_map_mode)</a>  </td><td>Configure the ECN mapping mode.   </td></tr>
<tr>
<td><a class="el" href="group__ecn.html#ga0388f4adaf72999fc728808b6e7a2958" title="Retrieve the ECN mapping mode.">bcm_ecn_map_mode_get(int unit, bcm_ecn_map_mode_t* ecn_map_mode)</a>  </td><td>Retrieve the ECN mapping mode.   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<div class="footer-brcm-wrapper">
<table class="footer-brcm">
	<tbody><tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align="left"></td>
		<td class="footer-brcm"><small><b>Proprietary and Confidential &copy; 2019 Broadcom</b></small>
			<div class="footer-brcm">Broadcom Incorporated reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design.
Information furnished by Broadcom Incorporated is believed to be accurate and reliable. However, Broadcom Incorporated does not assume any liability arising
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license
under its patent rights nor the rights of others.
			</div>
		</td>
	</tr>
</tbody></table>
</div>
</body>
</html>
