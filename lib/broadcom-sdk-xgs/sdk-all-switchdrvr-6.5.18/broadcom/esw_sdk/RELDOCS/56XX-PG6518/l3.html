<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDK API Guide: Layer 3 Management</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css"/>
<link href="tabs_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SDK API Guide
   &#160;<span id="projectnumber">Version 6.5.18</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Layer 3 Management </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The BCM Layer 3 APIs allow application developers to manage the Broadcom L3 switch features, including the L3 fast switching host table, L3 routing table, L3 interface table, and L3 tunneling tables (terminator and initiator) for the members of the BCM56xx product series that support Layer 3 IP switching. When Layer 3 switching is enabled, the switch acts like a router, switching packets across VLAN boundaries, in addition to behaving as an L2 switch for traffic switched within the same VLAN. L3 packets are routed either based on subnet match, or fast-switched based on a full IP address match. These capabilities are managed in the route table and host table, respectively.</p>
<p>On StrataSwitch devices, the host table is a binary search array maintained in sorted order. On XGS devices, the host table is a hash table with fixed bucket sizes. This API provides an abstraction to treat either table in a similar manner.</p>
<p>On StrataSwitch devices, the route table is a linearly searched array maintained in priority order. On StrataXGS I/StrataXGS II devices, the route table is a longest prefix match trie. On StrataXGS III devices, the route table is implemented either as a CAM or as a special spanning algorithm.</p>
<p>Fundamental to L3 operation is the concept of the L3 interface. The L3 interface is a virtual interface corresponding to a particular routed VLAN and has an associated IP address and MAC address. In the BCM API, an L3 interface is identified by a numeric value.</p>
<p>IP fast switching is based on full IP address match in the L3 table. When the destination IP address in the packet matches the IP address in an L3 host entry, the packet is modified according to the L3 host entry and switched out of the outgoing interface if the STP state allows.</p>
<p>L3 routing is based on subnet match. All packets with destination IP addresses belonging to the same subnet are routed to the same outgoing interface. When there is only one outgoing path, it is called a single path route.</p>
<p>Equal Cost Multi-Path (ECMP) routing is a technique for routing packets along multiple paths of equal cost. If multiple equal-cost routes exist to the same destination, ECMP can be used to provide load balancing among all the ECMP paths. The forwarding engine identifies paths by next hop, and when forwarding packets, chooses which next hop to use.</p>
<p>A flag BCM_L3_MULTIPATH is defined to tell the relevant APIs including <a class="el" href="group__l3.html#bcm_l3_route_add">bcm_l3_route_add</a> and <a class="el" href="group__l3.html#bcm_l3_route_delete">bcm_l3_route_delete</a> whether the route is an ECMP route. To create an ECMP route 2 methods may be used: (1) Invoke Route_add API multiple times for the same network, once for each path addition/deletion. (2) Invoke Egress_Multipath or Egress_Ecmp Object API along with L3 Egress objects created for each path. However, for BCM56820, BCM56624, BCM56634 and BCM56840 device family, only the Egress object method is allowed.</p>
<p>The bcm_l3_egress_multipath_xxx APIs will be phased out over time in favor of the bmc_l3_egress_ecmp_xxx APIs, since the latter APIs allow for the configuration of per ECMP group attributes, such as dynamic load balancing and resilient hashing. The usage of these two sets of APIs should not be mixed.</p>
<p>To configure ECMP dynamic group multipath (BCM_L3_ECMP_DYNAMIC_MODE_DGM), bcm_l3_ecmp_xxx APIs should be used.</p>
<p>A flag BCM_L3_DEFIP_LOCAL is defined. When a route is for last hop directly connected network, that is, where hosts are connected, this flag should be used when <a class="el" href="group__l3.html#bcm_l3_route_add">bcm_l3_route_add</a> is called.</p>
<p>All of the APIs that existed prior to SDK 5.2.0 are supported on all chip devices including StrataXGS III. These APIs support only IPv4 and use the bcm_ip_t address type. These legacy APIs will be phased out over time in favor of the new combined IPv4/IPv6 APIs, and include:</p>
<ul>
<li>bcm_l3_interface_xxx</li>
<li>bcm_l3_addr_xxx</li>
<li>bcm_l3_defip_xxx</li>
</ul>
<p>A new set of APIs has been phased in to provide unified IPv4/IPv6 and tunneling support. For maximum portability, these new APIs should be used in favor of the old APIs whenever possible:</p>
<ul>
<li>bcm_l3_intf_xxx - supersedes bcm_l3_interface_xxx</li>
<li>bcm_l3_host_xxx - supersedes bcm_l3_ip_xxx</li>
<li>bcm_l3_route_xxx - supersedes bcm_l3_defip_xxx</li>
</ul>
<p>NOTE: Route table scalability</p>
<p>BCM5664x and BCM5685x devices have flexible (configurable) route tables instead of a dedicated route table for ipv6/65-128 routes. The route table on these devices can be configured depending on scalability and functionality requirements. SOC config property 'ipv6_lpm_128b_enable' is used to control this behavior. With this SOC property enabled (i.e. set to '1'), upto 2K ipv6/65-128 routes and, upto 8K ipv4 or ipv6/0-64 routes can be configured. With this SOC property disabled (i.e. set to '0'), the route table is used exclusively for ipv4 or ipv6/0-64 routes and can scale upto 16K routes. This SOC property is enabled by default.</p>
<p>NOTE: Routing Into and Out of Tunnels</p>
<p>BCM56860 and devices similar to BCM56860, support Routing Into and Out of Tunnels feature. It is imperative to enable bcmSwitchL3IngressMode and bcmSwitchL3IngressInterfaceMapSet to create overlay entries. SDK will return error during l3 intf creation if these modes are not enabled. L3 objects (l3_intf, l3_egress, ecmp) are split into overlay and underlay domains. The split of domains is configuratble and can be set by various configurable properties. While creating entries with *WITH_ID flag, it is important that id value falls in respective overlay/underlay entry domain.</p>
<p>NOTE: IP Multicast Default Route.</p>
<p>BCM56860 and family can add routes for IP Multicast groups. IP Multicast is based on the concept of a group specified by a Class-D IP Multicast address. An arbitrary group of IP hosts interested in receiving a particular data stream must join the group using IGMP. In other words, a Class-D IP Multicast address specifies an arbitrary group of IP hosts that have joined the group and want to receive traffic sent to this group. Flag BCM_L3_IPMC can be used to tell the relevant APIs including <a class="el" href="group__l3.html#bcm_l3_route_add">bcm_l3_route_add</a> and <a class="el" href="group__l3.html#bcm_l3_route_delete">bcm_l3_route_delete</a> whether the route is an IP Multicast route. Caller must use IPMC group ID that is returned by bcm_multicast_create. Flag BCM_L3_MULTIPATH cannot be used with BCM_L3_IPMC. Using BCM_L3_IPMC for unicast IP, Or not using BCM_L3_IPMC for class-D IP Multicast address has undefined behavior on traffic flow.</p>
<p>On BCM56870 family, the default global low IPMC routes(with vrf type BCM_L3_VRF_GLOBAL) MUST be added if LPM/ALPM is used for IPMC programming. The default IPMC routes are: 224.0.0.0/4(IPv4) and FF::0/8(IPv6).</p>
<p>NOTE: SDK Upgrade.</p>
<p>For BCM56870 family, when SDK updates from the version which is below SDK-6.5.14 to SDK-6.5.14 or above, make sure that there is no IP multicast LPM routes left in the system before the warmboot.</p>
<h1><a class="anchor" id="l3_data_types"></a>
L3 Data Types</h1>
<ul>
<li>bcm_ip_t is the standard IPv4 address, and is a 32-bit unsigned integer. In the control structures, it is stored in host endian order.</li>
<li>bcm_ip6_t is the standard IPv6 address, and is an array of 16 8-bit unsigned integers totaling 128 bits. It is stored in network endian order.</li>
<li>bcm_if_t is the interface identifier number.</li>
<li>bcm_if_group_t is the interface group number. This is a group number supplied by the application to group multiple L3 interfaces for classification purposes.</li>
<li>bcm_vrf_t is the virtual router instance number.</li>
</ul>
<a class="anchor" id=""></a>
<table class="doxtable">
<caption>L3 Special VRF Types</caption>
<tr>
<th>Name </th><th>Purpose  </th></tr>
<tr>
<td>BCM_L3_VRF_OVERRIDE </td><td>Matches before VRF specific entries. When BCM_L3_INGRESS_GLOBAL_ROUTE is unset on L3 ingress Interface (indicating global routes not allowed), override routes can still be hit in LPM mode, but not in ALPM mode.   </td></tr>
<tr>
<td>BCM_L3_VRF_GLOBAL </td><td>Matches after VRF specific entries.  </td></tr>
<tr>
<td>BCM_L3_VRF_DEFAULT </td><td>Default VRF ID.  </td></tr>
<tr>
<td>BCM_L3_VRF_INVALID </td><td>Invalid VRF - Only used in bcm_l3_ingress_create / ingress_get API calls, to specify that the given VRF is not valid and should be marked invalid in the corresponding L3_IIF entry. This VRF type is valid only for BCM56870 family of devices.   </td></tr>
</table>
<ul>
<li>bcm_tunnel_type_t enumerates the tunnel types supported by the API shown in <a class="el" href="l3.html#L3_Tunneling_Types_x">L3_Tunneling_Types_x</a> <a class="anchor" id="L3_Tunneling_Types_x"></a><a class="anchor" id=""></a>
<table class="doxtable">
<caption>L3 Tunneling Types</caption>
<tr>
<th>Name </th><th>Purpose  </th></tr>
<tr>
<td>bcmTunnelTypeNone = 0, </td><td>Disable IP tunneling on interface.  </td></tr>
<tr>
<td>bcmTunnelTypeIp4In4 </td><td>IPv4-in-IPv4 tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeIp6In4 </td><td>IPv6-in-IPv4 tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeIpAnyIn4 </td><td>IPv6/4-in-IPv4 tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeIp4In6 </td><td>IPv4-in-IPv6 tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeIp6In6 </td><td>IPv6-in-IPv6 tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeIpAnyIn6 </td><td>IPv6/4-in-IPv6 tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeGre4In4 </td><td>GRE IPv4-in-IPv4 tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeGre6In4 </td><td>GRE IPv6-in-IPv4 tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeGreAnyIn4 </td><td>GRE IPv6/4-in-IPv4 tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeGre4In6 </td><td>GRE IPv4-in-IPv6 tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeGre6In6 </td><td>GRE IPv6-in-IPv6 tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeGreAnyIn6 </td><td>GRE IPv6/4-in-IPv6 tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeIsatap, </td><td>ISATAP tunneling.  </td></tr>
<tr>
<td>bcmTunnelType6In4Uncheck, </td><td>Unchecked 6to4 tunnel.  </td></tr>
<tr>
<td>bcmTunnelType6In4, </td><td>Checked 6to4 tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeMpls, </td><td>MPLS tunneling.  </td></tr>
<tr>
<td>bcmTunnelTypeUdp, </td><td>UDP tunneling.  </td></tr>
<tr>
<td>bcmTunnelTypePimSmDr1, </td><td>PIM SM Tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypePimSmDr2, </td><td>PIM SM Tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypePim6SmDr1, </td><td>PIM6 SM Tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypePim6SmDr2, </td><td>PIM6 SM Tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeWlanWtpToAc, </td><td>IPv4 WLAN AP to switch tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeWlanAcToAc, </td><td>IPv4 WLAN switch to switch tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeWlanWtpToAc6, </td><td>IPv6 WLAN AP to switch tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeWlanAcToAc6, </td><td>IPv6 WLAN switch to switch tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeAutoMulticast, </td><td>IPv4 AutoMulticast (AMT) tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeAutoMulticast6, </td><td>IPv6 AutoMulticast (AMT) tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeEtherIp4In4, </td><td>EoIP - Fixed encapsulation (2B).  </td></tr>
<tr>
<td>bcmTunnelTypeL2Gre, </td><td>L2GRE Tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeVxlan, </td><td>VXLAN Tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeErspan, </td><td>ERSPAN tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeRspan, </td><td>RSAPN tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeL2EncapExternalCpu </td><td>External CPU L2 tunnel  </td></tr>
<tr>
<td>bcmTunnelTypeLawfulInterception </td><td>Lawful Interception tunnel  </td></tr>
<tr>
<td>bcmTunnelTypeVxlan6 </td><td>VXLAN IPv6 Tunnel.  </td></tr>
<tr>
<td>bcmTunnelTypeL2SrcEncap </td><td>L2 Source Mac Encapsulation  </td></tr>
<tr>
<td>bcmTunnelTypeCount </td><td>Number of fields in this enum.  </td></tr>
</table>
</li>
<li>bcm_l3_intf_t contains information used when setting or retrieving L3 interface definitions. The description for each API below describes which structure members are used for inputs and outputs.</li>
</ul>
<p>Always initialize an L3 interface structure using the <a class="el" href="group__l3.html#bcm_l3_intf_t_init">bcm_l3_intf_t_init</a> function prior to passing it to an API, because future API releases may add more structure members.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__l3__intf__s.html">bcm_l3_intf_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a>         <a class="code" href="structbcm__l3__intf__s.html#ab8583c7eb0fff0be9d1e60cd0424198c">l3a_flags</a>;         <span class="comment">/* See BCM_L3_XXX flag definitions */</span></div><div class="line">    <a class="code" href="group__types.html#ga75bff066bcf4665db211170f0f49e58e">bcm_vrf_t</a>      <a class="code" href="structbcm__l3__intf__s.html#a4b355a1e61bb5ad21f5bb8e9f742f743">l3a_vrf</a>;           <span class="comment">/* Virtual router identifier */</span></div><div class="line">    <a class="code" href="group__types.html#ga30e6e81bfad0b18e55d3a1c8148fd75d">bcm_if_t</a>       <a class="code" href="structbcm__l3__intf__s.html#a770123c6baad5b99818a5901c672d718">l3a_intf_id</a>;       <span class="comment">/* Interface ID */</span></div><div class="line">    <a class="code" href="group__types.html#ga4ccf23ca53e7e7e9a7be38b950aa7943">bcm_mac_t</a>      <a class="code" href="structbcm__l3__intf__s.html#af883e5a8280927fb4cb98f22f8c30b06">l3a_mac_addr</a>;      <span class="comment">/* MAC address */</span></div><div class="line">    <a class="code" href="group__types.html#ga206cad73150c7e799b9a1cd4ebe13465">bcm_vlan_t</a>     <a class="code" href="structbcm__l3__intf__s.html#a558bb7131f6903a8d77bc82abb165b21">l3a_vid</a>;           <span class="comment">/* VLAN ID */</span></div><div class="line">    <a class="code" href="group__types.html#ga206cad73150c7e799b9a1cd4ebe13465">bcm_vlan_t</a>     <a class="code" href="structbcm__l3__intf__s.html#a4487c144cdbe048720762c84d300a9bf">l3a_inner_vlan</a>;    <span class="comment">/* Inner VLAN for double tagged packets. */</span></div><div class="line">    <span class="keywordtype">int</span>            <a class="code" href="structbcm__l3__intf__s.html#a5732f7ff098a5a2fdaece975c8393265">l3a_tunnel_idx</a>;    <span class="comment">/* Tunnel (initiator) index */</span></div><div class="line">    <span class="keywordtype">int</span>            <a class="code" href="structbcm__l3__intf__s.html#a0f9d06170c5c3cddc907cc67db1fee41">l3a_ttl</a>;           <span class="comment">/* TTL threshold */</span></div><div class="line">    <span class="keywordtype">int</span>            <a class="code" href="structbcm__l3__intf__s.html#a34253f97224b6a676354636732137b7b">l3a_mtu</a>;           <span class="comment">/* MTU */</span></div><div class="line">    <span class="keywordtype">int</span>        <a class="code" href="structbcm__l3__intf__s.html#ae8f85f6ed84f2f233d806b9456910ef9">l3a_mtu_forwarding</a>;<span class="comment">/* Forwarding Layer MTU */</span></div><div class="line">    <a class="code" href="group__types.html#ga7411d4040c457e0dba2515852ccd8475">bcm_if_group_t</a> <a class="code" href="structbcm__l3__intf__s.html#a24a1f05a3cc1cf278fa69bb5ca544603">l3a_group</a>;         <span class="comment">/* Interface group number */</span></div><div class="line">    <a class="code" href="structbcm__l3__intf__qos__s.html">bcm_l3_intf_qos_t</a> <a class="code" href="structbcm__l3__intf__s.html#a0cfa283b1a97e1230d3c688e089ef05e">vlan_qos</a>;       <span class="comment">/* Outer-Vlan QoS Setting. */</span></div><div class="line">    <a class="code" href="structbcm__l3__intf__qos__s.html">bcm_l3_intf_qos_t</a> <a class="code" href="structbcm__l3__intf__s.html#ab9c0c2298aa8e361b93779070922e89c">inner_vlan_qos</a>; <span class="comment">/* Inner-Vlan QoS Setting. */</span></div><div class="line">    <a class="code" href="structbcm__l3__intf__qos__s.html">bcm_l3_intf_qos_t</a> <a class="code" href="structbcm__l3__intf__s.html#aa444c81159524e17250dba1dd2b09cf0">dscp_qos</a>;       <span class="comment">/* DSCP QoS Setting. */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__l3__intf__s.html#a7d0dd62a05a85c7a0f231eb837a84b02">l3a_intf_class</a>;               <span class="comment">/* L3 interface class ID */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__l3__intf__s.html#aab953cf2ed183c059bc4590752530459">l3a_ip4_options_profile_id</a>;   <span class="comment">/* Profile ID for handling IP options */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__l3__intf__s.html#a3fea55fda8003da21a7bdc4b2685915e">l3a_nat_realm_id</a>;             <span class="comment">/* Realm id of the interface for NAT */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>  <a class="code" href="structbcm__l3__intf__s.html#af0778c25248d26c33068cb6b8efeeb59">outer_tpid</a>;               <span class="comment">/* TPID value */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__l3__intf__s.html#a3f623e51e45fdb1f4af7ac8aac1dafb6">l3a_intf_flags</a>;            <span class="comment">/* See BCM_L3_INTF_XXX flag definitions. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__l3__intf__s.html#af41b8b08b18dd05b57f7d6096ab3716e">native_routing_vlan_tags</a>;   <span class="comment">/* Set number of VLAN tags expected when</span></div><div class="line"><span class="comment">                                         interface is used for native routing */</span></div><div class="line">    <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> <a class="code" href="structbcm__l3__intf__s.html#aab90814f2a99aacf8af9beb4da0e5398">l3a_source_vp</a>;        <span class="comment">/* Source virtual port in overlay</span></div><div class="line"><span class="comment">                                         domain. SVP is used for deriving port</span></div><div class="line"><span class="comment">                                         properties in the egress device when</span></div><div class="line"><span class="comment">                                         packets are sent over HG flow. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__l3__intf__s.html#ad88714fd31aaffbe3d7ec5ef11953eb4">flow_handle</a>;               <span class="comment">/* FLOW handle for flex entries. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__l3__intf__s.html#ac1476b1566a82dc9cff355cf1469e4eb">flow_option_handle</a>;        <span class="comment">/* FLOW option handle for flex entries. */</span></div><div class="line">    <a class="code" href="structbcm__flow__logical__field__s.html">bcm_flow_logical_field_t</a> <a class="code" href="structbcm__l3__intf__s.html#ab67f880885666a4177abc8610ce96467">logical_fields</a>[BCM_FLOW_MAX_NOF_LOGICAL_FIELDS]; <span class="comment">/* logical fields array for flex entries. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__l3__intf__s.html#ae14523a239aee03d12249039a79c876c">num_of_fields</a>;             <span class="comment">/* number of logical fields. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a>  <a class="code" href="structbcm__l3__intf__s.html#a5f770e4e3034fe6d592531a967d80729">l3a_ttl_dec</a>;           <span class="comment">/* TTL decrement value */</span></div><div class="line">} <a class="code" href="group__l3.html#ga96f34665db11b91ae5641e589e757384">bcm_l3_intf_t</a>;</div></div><!-- fragment --><ul>
<li>bcm_l3_intf_qos_t contains information used when setting or retrieving L3 interface QoS definitions. The qos_map_id must be set through QoS APIs. Refer QoS API section to create and add QoS Maps.</li>
</ul>
<p>The flags field in Layer 3 Interface QoS structure may take on values which are the logical OR of one or more of the following flags.</p>
<a class="anchor" id=""></a>
<table class="doxtable">
<caption>BCM Layer 3 Interface QoS Flags</caption>
<tr>
<th>Name </th><th>Purpose  </th></tr>
<tr>
<td>BCM_L3_INTF_QOS_OUTER_VLAN_PRI_COPY </td><td>Copy Outer Vlan .1p from incoming packet .1p.  </td></tr>
<tr>
<td>BCM_L3_INTF_QOS_OUTER_VLAN_PRI_SET </td><td>Set Outer Vlan .1p from table entry.  </td></tr>
<tr>
<td>BCM_L3_INTF_QOS_OUTER_VLAN_PRI_REMARK </td><td>Remark Outer Vlan .1p from PHB.  </td></tr>
<tr>
<td>BCM_L3_INTF_QOS_INNER_VLAN_PRI_COPY </td><td>Copy Inner Vlan .1p from incoming packet .1p.  </td></tr>
<tr>
<td>BCM_L3_INTF_QOS_INNER_VLAN_PRI_SET </td><td>Set Inner Vlan .1p from table entry.  </td></tr>
<tr>
<td>BCM_L3_INTF_QOS_INNER_VLAN_PRI_REMARK </td><td>Remark Outer Vlan .1p from PHB.  </td></tr>
<tr>
<td>BCM_L3_INTF_QOS_DSCP_COPY </td><td>Use existing DSCP.  </td></tr>
<tr>
<td>BCM_L3_INTF_QOS_DSCP_SET </td><td>Set DSCP from table entry.  </td></tr>
<tr>
<td>BCM_L3_INTF_QOS_DSCP_REMARK </td><td>Remark DSCP from PHB.  </td></tr>
<tr>
<td>BCM_L3_INTF_OVERLAY_ENCAP </td><td>L3 interface used for overlay routing. Relevant for intra DC routed packets  </td></tr>
<tr>
<td>BCM_L3_INTF_NATIVE_ENCAP </td><td>L3 interface used for native outing. Relevant for intra DC routed packets  </td></tr>
</table>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__l3__intf__qos__s.html">bcm_l3_intf_qos_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__l3__intf__qos__s.html#a81a27ce50e78368b0d0de1e8767fd32d">flags</a>;                     <span class="comment">/* BCM_L3_INTF_QOS_xxx. */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__l3__intf__qos__s.html#ae0f3a8319d260386ef0ad80c714ef5a2">qos_map_id</a>;                   <span class="comment">/* QOS Map ID. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__l3__intf__qos__s.html#a31af7f2fccedd540790c853adb9bc3d5">pri</a>;                        <span class="comment">/* Packet .1p */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__l3__intf__qos__s.html#a00e5355c25655f1b4775f3e9bc326044">cfi</a>;                        <span class="comment">/* Packet CFI */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__l3__intf__qos__s.html#a139f7aad5397431a4e30fd2787c29dc5">dscp</a>;                         <span class="comment">/* packet DSCP */</span></div><div class="line">} <a class="code" href="group__l3.html#ga51902bb00f568a2a06b07170fa3c8bf5">bcm_l3_intf_qos_t</a>;</div></div><!-- fragment --><ul>
<li>The inner VLAN Tag handling action may be specified for an interface using the BCM_L3_INTF_INNER_VLAN_XXX flags. The flags describe in the table specify the handling of Inner VLAN tag. Actions could be to add if no inner VLAN tag is present, Replace with specified ivid, delete the ivid or by default do not modify.</li>
</ul>
<a class="anchor" id=""></a>
<table class="doxtable">
<caption>BCM Layer 3 Interface Flags</caption>
<tr>
<th>Name </th><th>Purpose  </th></tr>
<tr>
<td>BCM_L3_INTF_INNER_VLAN_DO_NOT_MODIFY </td><td>Do Not Modify the Inner VLAN Tag  </td></tr>
<tr>
<td>BCM_L3_INTF_INNER_VLAN_ADD </td><td>Add Inner VLAN Tag  </td></tr>
<tr>
<td>BCM_L3_INTF_INNER_VLAN_REPLACE </td><td>Replace Inner VLAN Tag  </td></tr>
<tr>
<td>BCM_L3_INTF_INNER_VLAN_DELETE </td><td>Delete Inner VLAN Tag  </td></tr>
<tr>
<td>BCM_L3_INTF_UNDERLAY </td><td>Underlay interface  </td></tr>
<tr>
<td>BCM_L3_INTF_IPMC_SAME_INTF_DROP </td><td>Drop IPMC packets destined to the interface same as the incoming interface  </td></tr>
<tr>
<td>BCM_L3_INTF_TTL_CHECK </td><td>Enable TTL check  </td></tr>
</table>
<ul>
<li>IP4 options processing could be defined on on a given interface. A profile for handling IP options may be created, the profile ID could then be used during the L3 interface create. The IP options may be set to a default action and/or individual options could be updated in a desired way. Following actions are defined for handling IP options.</li>
</ul>
<a class="anchor" id=""></a>
<table class="doxtable">
<caption>BCM Layer 3 Interface IP options actions</caption>
<tr>
<th>Name </th><th>Purpose  </th></tr>
<tr>
<td>bcmIntfIPOptionActionNone </td><td>No actions for processing IP options.  </td></tr>
<tr>
<td>bcmIntfIPOptionActionCopyToCPU </td><td>Copy IP datagrams with IP options to CPU  </td></tr>
<tr>
<td>bcmIntfIPOptionActionDrop </td><td>Drop IP datagrams with IP options  </td></tr>
</table>
<ul>
<li>bcm_l3_ingress_t contains information to configure Layer3 Ingress Interfaces(L3-IIF). It is important always to initialize an L3 Ingress structure using the <a class="el" href="group__l3.html#bcm_l3_ingress_t_init">bcm_l3_ingress_t_init</a> function prior to passing it to an API.</li>
<li>Refer to usage of bcmSwitchL3IngressMode <a class="el" href="group__switch.html#bcm_switches">bcm_switches</a> . L3 Interfaces (L3-IIF) for MPLS and L3 Tunnels are created using <a class="el" href="group__l3.html#bcm_l3_ingress_create">bcm_l3_ingress_create</a> API.</li>
<li>For traditional Layer3 forwarding, incoming VLAN identity-maps to L3_IIF. However for Strict URPF a configurable mapping of incoming VLAN to L3_IIF may be required. For this purpose refer to usage of bcmSwitchL3IngressInterfaceMapSet <a class="el" href="group__switch.html#bcm_switches">bcm_switches</a> . If the interface is not mapped, then incoming VLAN maps to BCM_L3_INGRESS_INTERFACE_INVALID.</li>
<li><a class="anchor" id=""></a>
<table class="doxtable">
<caption>Invalid L3 Ingress Interface</caption>
<tr>
<td>BCM_L3_INGRESS_INTERFACE_INVALID 4095 /* Invalid L3 Ingress Interface </td></tr>
</table>
</li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<div class="footer-brcm-wrapper">
<table class="footer-brcm">
	<tbody><tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align="left"></td>
		<td class="footer-brcm"><small><b>Proprietary and Confidential &copy; 2019 Broadcom</b></small>
			<div class="footer-brcm">Broadcom Incorporated reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design.
Information furnished by Broadcom Incorporated is believed to be accurate and reliable. However, Broadcom Incorporated does not assume any liability arising
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license
under its patent rights nor the rights of others.
			</div>
		</td>
	</tr>
</tbody></table>
</div>
</body>
</html>
