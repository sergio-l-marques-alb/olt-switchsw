<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDK API Guide: Mirroring</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css"/>
<link href="tabs_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SDK API Guide
   &#160;<span id="projectnumber">Version 6.5.18</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Mirroring </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Port mirroring feature allows port traffic to be duplicated on another port (the "mirror-to" port) for debugging or sniffing purposes. The BCM mirroring module allows network application developers to manage mirroring configuration.</p>
<p><a class="anchor" id="mirrormodes"></a></p><a class="anchor" id=""></a>
<table class="doxtable">
<caption>BCM Mirroring modes</caption>
<tr>
<th>Name </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_DISABLE </td><td>Disable Mirroring  </td></tr>
<tr>
<td>BCM_MIRROR_L2 </td><td>L2 Mirroring  </td></tr>
<tr>
<td>BCM_MIRROR_L2_L3 </td><td>L3 Mirroring (Deprecated)  </td></tr>
</table>
<p>The <a class="el" href="mirror_8h.html#bcm_mirror_port_set">bcm_mirror_port_set</a> API function provides a simplified mirroring configuration method that supports mirroring to mirror-to ports on other switch chips as well as mirroring to trunk groups (StrataXGS III only). This API function takes a flags parameter that may contain any of the flags defined in <a class="el" href="mirroring.html#mirrorflags">mirrorflags</a> below: <a class="anchor" id="mirrorflags"></a></p><a class="anchor" id=""></a>
<table class="doxtable">
<caption>BCM Mirroring Flags</caption>
<tr>
<th>Name </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_PORT_ENABLE </td><td>Enable mirroring (Deprecated)  </td></tr>
<tr>
<td>BCM_MIRROR_PORT_INGRESS </td><td>Enable ingress mirroring  </td></tr>
<tr>
<td>BCM_MIRROR_PORT_EGRESS </td><td>Enable egress mirroring  </td></tr>
<tr>
<td>BCM_MIRROR_PORT_EGRESS_TRUE </td><td>Enable true egress mirroring  </td></tr>
<tr>
<td>BCM_MIRROR_PORT_DEST_TRUNK </td><td>dest_port is a trunk  </td></tr>
<tr>
<td>BCM_MIRROR_PORT_EGRESS_ACL </td><td>Enable Egress Mirroring for ACLs  </td></tr>
<tr>
<td>BCM_MIRROR_PORT_SFLOW </td><td>Enable sFlow mirroring  </td></tr>
<tr>
<td>BCM_MIRROR_PORT_UNTAGGED_ONLY </td><td>Enable Ingress mirroring for Untagged traffic only  </td></tr>
<tr>
<td>BCM_MIRROR_PORT_TAGGED_DEFAULT </td><td>Enable Ingress mirroring for Tagged traffic with unspecified VID  </td></tr>
<tr>
<td>BCM_MIRROR_PORT_INT </td><td>Enable copy to mirror on INT turnaround  </td></tr>
<tr>
<td>BCM_MIRROR_PORT_ELEPHANT </td><td>Enable Ingress mirroring for Elephant flows  </td></tr>
<tr>
<td>BCM_MIRROR_PORT_DLB_MONITOR </td><td>Enable Ingress mirroring for DLB Flow Monitoring feature  </td></tr>
</table>
<p><a class="anchor" id="mirrorDestinationflags"></a></p><a class="anchor" id=""></a>
<table class="doxtable">
<caption>BCM Mirror Destination Flags</caption>
<tr>
<th>Name </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_DEST_REPLACE </td><td>Replace mirror destination.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_WITH_ID </td><td>Mirror destination ID is valid.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_TUNNEL_L2 </td><td>Mirrored packet should be L2 tunneled.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_TUNNEL_IP_GRE </td><td>Mirrored packet should be L3 GRE tunneled.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_PAYLOAD_UNTAGGED </td><td>Strip VLAN tag from mirrored packet.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_TUNNEL_TRILL </td><td>Mirrored packet should be TRILL tunneled. May be combined with L2 or L3 GRE tunnels.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_TUNNEL_NIV </td><td>Mirrored packet should be NIV tunneled. May be combined with L2 or L3 GRE tunnels.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_UPDATE_POLICER </td><td>update policer using policer_id.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_UPDATE_COUNTER </td><td>update counter using stat_id.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_DEST_MULTICAST </td><td>destination is ingress multicast.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_TUNNEL_WITH_ENCAP_ID </td><td>Mirror destination encap_id is valid.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_TUNNEL_WITH_SPAN_ID </td><td>Mirrored packet should be with ERSPAN encapsulation.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_TUNNEL_RSPAN </td><td>Mirrored packet should be RSPAN (VLAN) tunneled.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_INT_PRI_SET </td><td>Mirrored packet should be set with internal priority.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_TUNNEL_ETAG </td><td>Mirrored packet should be ETAG(Port Extender VLAN Tag) tunneled. May be combined with L2 or L3 GRE tunnels.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_TUNNEL_SFLOW </td><td>Mirrored packet should be with sFlow encapsulation.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_IS_SNOOP </td><td>Specify that the destination type is a snoop destination.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_IS_TRAP </td><td>Specify that the destination is a trap destination.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_IS_STAT_SAMPLE </td><td>Specify that the destination type is a STATISTIC SAMPLING destination.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_EGRESS_ADD_ORIG_SYSTEM_HEADER </td><td>The start of the original packet system header will be included in the outbound mirrored packets.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_EGRESS_TRAP_WITH_SYSTEM_HEADER </td><td>BCM88{2,3,4,6}{7,8}x: For packets recycled by egress applications and not forwarded, retain the incoming packet's system headers as received from the fabric, and in case of an Egress MC packet, stamp the FTMH.OutLIF field with the CUD.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_FIELD </td><td>Mirror destination owner is Field Processor.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_PORT </td><td>Mirror destination owner is Port.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_DROP_SNIFF_IF_FWD_DROPPED </td><td>Drop the sniff packet if the original packet is dropped.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_UPDATE_COUNTER_1 </td><td>update counter No.1  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_UPDATE_COUNTER_2 </td><td>update counter No.2  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_UPDATE_TUNNEL_SFLOW </td><td>Update mirror destination with sflow encapsulation  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_ID_SHARE </td><td>Share mirror destination id among multi ports  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_EEI_INVALID </td><td>Set EEI invalid  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_MTP_ADD </td><td>Add an MTP into a shared-id mirror destination  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_MTP_DELETE </td><td>Delete an MTP from a shared-id mirror destination  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_MTP_REPLACE </td><td>REPLACE an MTP of a shared-id mirror destination  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_TUNNEL_PSAMP </td><td>Update mirror destination with PSAMP encapsulation  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_OUT_MIRROR_DISABLE </td><td>Assert out mirror disable  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_TUNNEL_WITH_SEQ </td><td>Include Sequence number in header (used with BCM_MIRROR_DEST_TUNNEL_IP_GRE)  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_UPDATE_EXT_COUNTERS </td><td>Set statistic interfaces for mirrored packets  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_FLAGS2_TUNNEL_VXLAN </td><td>Mirrored packet should be VXLAN Tunneled.  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_FLAGS2_PSAMP_FORMAT_2 </td><td>Use format2 header for PSAMP mirrored packets  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_FLAGS2_INT_PROBE </td><td>Insert INT probe base header to the mirrored packet  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_FLAGS2_IFA </td><td>Insert IFA base header to the mirrored packet  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_FLAGS2_UPDATE_EXT_STAT_VALID </td><td>Update external statistics valid bit for mirror packets  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_FLAGS2_UPDATE_EXT_STAT_TYPES </td><td>Update external statistics types for mirror packets  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_FLAGS2_MIRROR_ON_DROP </td><td>Indicate mirror on drop profile  </td></tr>
<tr>
<td>BCM_MIRROR_DEST_FLAGS2_MOD_TUNNEL_PSAMP </td><td>Mirror packet with PSAMP mirror-on-drop encapsulation.  </td></tr>
</table>
<p><a class="anchor" id="mirrorProfileInvalidValue"></a></p><table class="doxtable">
<tr>
<th>Name </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_INVALID_PROFILE </td><td>Mirror profile invalid value used in bcm_mirror_destination_get and bcm_mirror_port_destination_get  </td></tr>
</table>
<p><a class="anchor" id="mirrorPktHeaderUpdatesflags"></a></p><a class="anchor" id=""></a>
<table class="doxtable">
<caption>BCM Mirror Packet Header Updates Flags. Updates various fields in the packet header.</caption>
<tr>
<th>Name </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_UPDATE_COLOR </td><td>Drop precedence.  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_UPDATE_PRIO </td><td>The internal packet priority (traffic class before ingress mapping to cosq).  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_UPDATE_ECN_VALUE </td><td>ECN capable and congestion encoding.  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_UPDATE_ECN_CNM_CANCEL </td><td>Ignore Congestion Point (CNM).  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_UPDATE_TRUNK_HASH_RESULT </td><td>LAG load balancing key.  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_UPDATE_IN_PORT </td><td>Source port from which the packet arrived.  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_UPDATE_VSQ </td><td>Selects STF (statistics flow) VSQ.  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_UPDATE_FABRIC_HEADER_EDITING </td><td>Changes to the fabric headers.  </td></tr>
</table>
<p>bcm_mirror_pkt_header_updates_t represents header updates of mirrored packets </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line">  <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> valid; <span class="comment">/* Used to specify which fields to use for header changes. Possible values will be named BCM_MIRROR_PKT_HEADER_UPDATE_* */</span></div><div class="line">  <a class="code" href="group__types.html#ga24111d898bb4ee4a12793dfa40c3a79d">bcm_color_t</a> color; <span class="comment">/* drop precedence */</span></div><div class="line">  <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> prio; <span class="comment">/* the internal packet priority (traffic class before ingress mapping to cosq) */</span></div><div class="line">  <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> ecn_value; <span class="comment">/* ECN capable and congestion encoding */</span></div><div class="line">  <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> cnm_cancel; <span class="comment">/* Ignore Congestion Point (CNM) */</span></div><div class="line">  <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> trunk_hash_result; <span class="comment">/* LAG load balancing key */</span></div><div class="line">  <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> in_port; <span class="comment">/* 8b should be exposed? */</span></div><div class="line">  <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> vsq; <span class="comment">/* selects STF (statistics flow) VSQ */</span></div><div class="line">  <a class="code" href="structbcm__pkt__s.html">bcm_pkt_t</a> fabric_header_editing; <span class="comment">/* changes to the fabric headers */</span></div><div class="line">  <a class="code" href="structbcm__mirror__pkt__header__fabric__s.html">bcm_mirror_pkt_header_fabric_t</a> header_fabric; <span class="comment">/* Fabric header updates of mirrored packets */</span></div><div class="line">} <a class="code" href="mirror_8h.html#a22f769bf987dad4f4b4970ade8d4cb4c">bcm_mirror_pkt_header_updates_t</a>; <span class="comment">/* represents header updates of mirrored packets */</span></div></div><!-- fragment --><p> <a class="anchor" id="mirrorOptionsUpdatesflags"></a></p><a class="anchor" id=""></a>
<table class="doxtable">
<caption>BCM Mirror Options Updates Flags.</caption>
<tr>
<th>Name </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_OPTIONS_COPY_DROP </td><td>drop the copied packet.  </td></tr>
<tr>
<td>BCM_MIRROR_OPTIONS_FORWARD_DROP </td><td>drop the original packet.  </td></tr>
</table>
<p>represents the options for the mirroring of packets </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__mirror__options__s.html">bcm_mirror_options_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__options__s.html#a81a27ce50e78368b0d0de1e8767fd32d">flags</a>;</div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__options__s.html#a47815f9dd1e844e9350adda0f755a475">forward_strength</a>;</div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__options__s.html#ad5d1b58c9d41f158a1f1b99b935956a6">copy_strength</a>;</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__options__s.html#a8549cbe48f7ddf36a549da6c9839d4e1">recycle_cmd</a>;     <span class="comment">/* dedicated for ETPP traps */</span></div><div class="line">} <a class="code" href="mirror_8h.html#a07adc5cfc9ffb9cb6934902a152c8476">bcm_mirror_options_t</a>;</div></div><!-- fragment --><p> <a class="anchor" id="mirrorTruncateZeroFlags"></a></p><a class="anchor" id=""></a>
<table class="doxtable">
<caption>BCM Mirroring Truncation and Zeroing Flags.</caption>
<tr>
<th>Name </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_PAYLOAD_DO_NOT_TRUNCATE </td><td>Disable payload truncation/zeroing  </td></tr>
<tr>
<td>BCM_MIRROR_PAYLOAD_TRUNCATE </td><td>Enable payload truncation  </td></tr>
<tr>
<td>BCM_MIRROR_PAYLOAD_TRUNCATE_AND_ZERO </td><td>Enable payload truncation &amp; zeroing  </td></tr>
</table>
<p><a class="anchor" id="mirrorTruncateZeroInvalidValues"></a></p><a class="anchor" id=""></a>
<table class="doxtable">
<caption>BCM Mirroring Truncation and Zeroing Invalid Values.</caption>
<tr>
<th>Name </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_PAYLOAD_ZERO_INVALID_PROTO_PORT </td><td>No associated protocol or port value for a offset  </td></tr>
<tr>
<td>BCM_MIRROR_PAYLOAD_ZERO_INVALID_OFFSET </td><td>Set a offset field in case of an error  </td></tr>
</table>
<p>Identifiers for accessing protocol or port numbers and/or the corresponding offset values for a particular protocol, or a layer </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="mirror_8h.html#a1eecd33400c49e76cd26dd624e708a39">bcm_mirror_payload_zero_field_e</a> {</div><div class="line">    <a class="code" href="mirror_8h.html#a1eecd33400c49e76cd26dd624e708a39a3ff24e3e12b1b19488283a1d90bef226">bcmMirrorPayloadZeroIp4Protocol0</a> = 0, <span class="comment">/* 1st of upto 3 IPv4 protocol values */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a1eecd33400c49e76cd26dd624e708a39a73515274820098bea88526ab64c87806">bcmMirrorPayloadZeroIp4Protocol1</a> = 1, <span class="comment">/* 2nd of upto 3 IPv4 protocol values */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a1eecd33400c49e76cd26dd624e708a39a625d6560513f21ab671c7cee59035792">bcmMirrorPayloadZeroIp4Protocol2</a> = 2, <span class="comment">/* 3rd of upto 3 IPv4 protocol values */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a1eecd33400c49e76cd26dd624e708a39a5b041bf7dbecaf6793d6d1fc262ae22b">bcmMirrorPayloadZeroIp6NxtHdr0</a> = 3, <span class="comment">/* 1st of upto 3 IPv6 nxthdr values */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a1eecd33400c49e76cd26dd624e708a39a075c4491c481cb2698e417ec0aa9ed95">bcmMirrorPayloadZeroIp6NxtHdr1</a> = 4, <span class="comment">/* 2nd of upto 3 IPv6 nxthdr values */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a1eecd33400c49e76cd26dd624e708a39ab3db159da54f0c2e517ff7d664128a02">bcmMirrorPayloadZeroIp6NxtHdr2</a> = 5, <span class="comment">/* 3rd of upto 3 IPv6 nxthdr values */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a1eecd33400c49e76cd26dd624e708a39a76446b3c390457d0788a272728a4e652">bcmMirrorPayloadZeroUdpPort0</a> = 6,   <span class="comment">/* First of upto 2 UDP port values */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a1eecd33400c49e76cd26dd624e708a39a031e5232029d5b4d06c5a1a189c33a93">bcmMirrorPayloadZeroUdpPort1</a> = 7,   <span class="comment">/* Second of upto 2 UDP port values */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a1eecd33400c49e76cd26dd624e708a39a85085f923cba5f347c6cad2190928d1d">bcmMirrorPayloadZeroIpInIpOffset</a> = 8, <span class="comment">/* IpInIP offset. No corresponding</span></div><div class="line"><span class="comment">                                           protocol value associated */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a1eecd33400c49e76cd26dd624e708a39a648fc4c5ffc306824932819b591dc292">bcmMirrorPayloadZeroL2Offset</a> = 9,   <span class="comment">/* L2 offset. No corresponding protocol</span></div><div class="line"><span class="comment">                                           value associated */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a1eecd33400c49e76cd26dd624e708a39ad0f2329a1a74a0baa44b8dedc11b3375">bcmMirrorPayloadZeroL3Offset</a> = 10,  <span class="comment">/* L3 offset. No corresponding protocol</span></div><div class="line"><span class="comment">                                           value associated */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a1eecd33400c49e76cd26dd624e708a39a73e70763c92d5c73dd6ed0f7e053b7f2">bcmMirrorPayloadZeroMplsOffset</a> = 11, <span class="comment">/* MPLS offset. No corresponding</span></div><div class="line"><span class="comment">                                           protocol value associated */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a1eecd33400c49e76cd26dd624e708a39a6e4da3d7c52a35a938267a8bd38d6a11">bcmMirrorPayloadZeroCount</a> = 12      <span class="comment">/* Last member, not a usable value */</span></div><div class="line">} <a class="code" href="mirror_8h.html#a3d189ede2785c756078883754e3ffc3f">bcm_mirror_payload_zero_field_t</a>;</div></div><!-- fragment --><p>Protocol or port numbers and/or the corresponding offset values for a particular protocol, or a layer. </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__mirror__payload__zero__info__s.html">bcm_mirror_payload_zero_info_s</a> {</div><div class="line">    <a class="code" href="mirror_8h.html#a3d189ede2785c756078883754e3ffc3f">bcm_mirror_payload_zero_field_t</a> <a class="code" href="structbcm__mirror__payload__zero__info__s.html#a75663221a44fb8267e83616566524c75">field_id</a>; <span class="comment">/* Identifies protocol or port item to be programmed, or read. Values below belong to this item */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__payload__zero__info__s.html#ae78e1331b65718abed6699b5e2771236">protocol_port_value</a>; <span class="comment">/* Specifies protocol number or port number. Is not valid for all field_id&#39;s */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__payload__zero__info__s.html#acc741b139ee7c4001c4c367a3749cc18">protocol_port_offset</a>; <span class="comment">/* Offset, in bytes, corresponding to field_id. Valid for all field_id&#39;s */</span></div><div class="line">} <a class="code" href="mirror_8h.html#af7d6753a100c46fcd66449d07e5e8fbc">bcm_mirror_payload_zero_info_t</a>;</div></div><!-- fragment --><p>Sflow or Psamp header's meta data field carries one of the values mentioned below. </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="mirror_8h.html#aa49bbd1769731c266372be9dc8ec6dd9">bcm_mirror_psamp_fmt2_meta_data_e</a> {</div><div class="line">    <a class="code" href="mirror_8h.html#aa49bbd1769731c266372be9dc8ec6dd9a0bced97e266eac89b7286a2bd65a6841">bcmMirrorPsampFmt2HeaderZeroes</a> = 0, <span class="comment">/* All zeroes */</span></div><div class="line">    <a class="code" href="mirror_8h.html#aa49bbd1769731c266372be9dc8ec6dd9a4ae86df59440909db57448de4173dfd9">bcmMirrorPsampFmt2HeaderI2eClassId</a> = 1, <span class="comment">/* I2E class id */</span></div><div class="line">    <a class="code" href="mirror_8h.html#aa49bbd1769731c266372be9dc8ec6dd9aee10d93b338c6be566667bc24ae7925b">bcmMirrorPsampFmt2HeaderNextHopClassId</a> = 2, <span class="comment">/* Next hop class id */</span></div><div class="line">    <a class="code" href="mirror_8h.html#aa49bbd1769731c266372be9dc8ec6dd9a909e0ea1dae42a37621d96dc4e84ca47">bcmMirrorPsampFmt2HeaderUserMeta</a> = 3, <span class="comment">/* User meta data (opaque) value */</span></div><div class="line">    <a class="code" href="mirror_8h.html#aa49bbd1769731c266372be9dc8ec6dd9a0504e93bba7dfa25997f423b6517d458">bcmMirrorPsampFmt2HeaderCount</a> = 4   <span class="comment">/* Last member. Not a usable value */</span></div><div class="line">} <a class="code" href="mirror_8h.html#a56220d8bc5aec20767d922e2c9953100">bcm_mirror_psamp_fmt2_meta_data_t</a>;</div></div><!-- fragment --><p>Port Selection Criteria for mirroring. </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="mirror_8h.html#a9dea5a24a03681a3c81542078f92442b">bcm_mirror_psc_e</a> {</div><div class="line">    <a class="code" href="mirror_8h.html#a9dea5a24a03681a3c81542078f92442ba68ec37610b1193a191cc3604fa268c3c">bcmMirrorPscNone</a> = 0,       <span class="comment">/* Invalid rtag. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a9dea5a24a03681a3c81542078f92442ba4f913f4d736e511639bcfd0488a56007">bcmMirrorPscSrcMac</a> = 1,     <span class="comment">/* Source MAC address. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a9dea5a24a03681a3c81542078f92442ba28eb54d46cf97b0023e0fb7c370b8abc">bcmMirrorPscDstMac</a> = 2,     <span class="comment">/* Destination MAC address. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a9dea5a24a03681a3c81542078f92442babc2c1508d40a51a8eb6e748cb33ed934">bcmMirrorPscSrcDstMac</a> = 3,  <span class="comment">/* Source+dest MAC address. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a9dea5a24a03681a3c81542078f92442baf4c7aa0cb6ba3aba9559b2d5c971cb46">bcmMirrorPscSrcIp</a> = 4,      <span class="comment">/* Source IP address. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a9dea5a24a03681a3c81542078f92442bac13db3104bf7521c0fa89c10db34e7ad">bcmMirrorPscDstIp</a> = 5,      <span class="comment">/* Destination IP address. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a9dea5a24a03681a3c81542078f92442baf883bd2db96ce3b0eafef5d6915ab67c">bcmMirrorPscSrcDstIp</a> = 6,   <span class="comment">/* Source+dest IP address. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a9dea5a24a03681a3c81542078f92442ba08a16b039e91ddba249776a126787ec7">bcmMirrorPscCount</a> = 7       <span class="comment">/* Must be last. Not a usable value. */</span></div><div class="line">} <a class="code" href="mirror_8h.html#ab9b137a3f311c4d4b5475067eed79073">bcm_mirror_psc_t</a>;</div></div><!-- fragment --><p>The bcm_mirror_pkt_erspan_encap_t structure contains information required for ERSPAN encapsulation header.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__mirror__pkt__erspan__encap__s.html">bcm_mirror_pkt_erspan_encap_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__pkt__erspan__encap__s.html#aa341f4e0365a8e3c92e2367b0d1bee64">truncated_flag</a>;               <span class="comment">/* If set to 0x1, the frame copy</span></div><div class="line"><span class="comment">                                           encapsulated in the ERSPAN packet</span></div><div class="line"><span class="comment">                                           will be truncated. This should be set</span></div><div class="line"><span class="comment">                                           if ERSPAN encapsulated frame exceeds</span></div><div class="line"><span class="comment">                                           the configured MTU. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__pkt__erspan__encap__s.html#a83e851515a327cfc20311f7404911970">session_id</a>;                  <span class="comment">/* Identification associated with each</span></div><div class="line"><span class="comment">                                           ERSPAN session. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__pkt__erspan__encap__s.html#a9f8935cc795b6da33b0b213b3f54236c">gbp_sid</a>;                     <span class="comment">/* Group Based Policy Source Id */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__pkt__erspan__encap__s.html#a040b1ae6ca8941d5da287539c3dc1b88">hw_id</a>;                        <span class="comment">/* Unique identifier of an ERSPAN engine</span></div><div class="line"><span class="comment">                                           within a system. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__pkt__erspan__encap__s.html#aebe03900f2401bdd7364559cb64abfb6">timestamp_granularity</a>;        <span class="comment">/* If it is not set, NTP timestamp will</span></div><div class="line"><span class="comment">                                           be used. If it is set to 0x1, PTP</span></div><div class="line"><span class="comment">                                           timestamp will used. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__pkt__erspan__encap__s.html#a8f8883521951b4397d1fba244d80a6cf">optional_hdr</a>;                 <span class="comment">/* Indicates if the optional</span></div><div class="line"><span class="comment">                                           platform-specific sub-header is</span></div><div class="line"><span class="comment">                                           present. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__pkt__erspan__encap__s.html#abdfa8b5c6eafdd098d254c7cae90a238">platform_id</a>;                  <span class="comment">/* Platform identifier to parse the</span></div><div class="line"><span class="comment">                                           optional platform-specific</span></div><div class="line"><span class="comment">                                           sub-header. Valid only if</span></div><div class="line"><span class="comment">                                           optional_hdr is set. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__pkt__erspan__encap__s.html#ac8f586b47af8d249946b2ed2e5342834">user_defined_value</a>;          <span class="comment">/* To store the user defined field */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__pkt__erspan__encap__s.html#a92d6005eb4272b44824605b26d67ca71">switch_id</a>;                   <span class="comment">/* Identifies a source switch at the</span></div><div class="line"><span class="comment">                                           receiving end. Valid only if</span></div><div class="line"><span class="comment">                                           optional_hdr is set and platform_id</span></div><div class="line"><span class="comment">                                           as 0x5 or 0x6. */</span></div><div class="line">} <a class="code" href="mirror_8h.html#ae6fd98f97595643a75d5e7cd5ccbaf18">bcm_mirror_pkt_erspan_encap_t</a>;</div></div><!-- fragment --><p>The <a class="el" href="structbcm__mirror__destination__s.html">bcm_mirror_destination_s</a> structure contains mirroring physical destination and encapsulation. Mirror destination is described in the following structure.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="structbcm__mirror__destination__s.html">bcm_mirror_destination_s</a> {</div><div class="line">    <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> <a class="code" href="structbcm__mirror__destination__s.html#afb6d222f683125c42bcad04617e4f35e">mirror_dest_id</a>; <span class="comment">/* Unique mirror destination and encapsulation</span></div><div class="line"><span class="comment">                                   identifier. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__destination__s.html#a81a27ce50e78368b0d0de1e8767fd32d">flags</a>;               <span class="comment">/* See BCM_MIRROR_DEST_xxx flag definitions. */</span></div><div class="line">    <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> <a class="code" href="structbcm__mirror__destination__s.html#a5bbb92b9248c9ea595e205dd48adefd8">gport</a>;          <span class="comment">/* Mirror destination. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__destination__s.html#a098ac2d424221424d34e26bc1ad1af2d">version</a>;              <span class="comment">/* IP header version. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__destination__s.html#a6d6ae8fdceed5ce2626727fc74749064">tos</a>;                  <span class="comment">/* Traffic Class/Tos byte. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__destination__s.html#ae02775d2432ca36401c2953643720b4b">ttl</a>;                  <span class="comment">/* Hop limit. */</span></div><div class="line">    <a class="code" href="group__types.html#gafb45fd06727fa45d83ce6f5e4c328378">bcm_ip_t</a> <a class="code" href="structbcm__mirror__destination__s.html#acd7f297beac873edf5d41fe4e87247e4">src_addr</a>;          <span class="comment">/* Tunnel source IP address (IPv4). */</span></div><div class="line">    <a class="code" href="group__types.html#gafb45fd06727fa45d83ce6f5e4c328378">bcm_ip_t</a> <a class="code" href="structbcm__mirror__destination__s.html#a6125eac44fc4dd560b6239ee768e7690">dst_addr</a>;          <span class="comment">/* Tunnel destination IP address (IPv4). */</span></div><div class="line">    <a class="code" href="group__types.html#ga40bc5eab76a137a39d5fff98d823094a">bcm_ip6_t</a> <a class="code" href="structbcm__mirror__destination__s.html#a0db58aaf12a17cde3b38bce80cb6c266">src6_addr</a>;        <span class="comment">/* Tunnel source IP address (IPv6). */</span></div><div class="line">    <a class="code" href="group__types.html#ga40bc5eab76a137a39d5fff98d823094a">bcm_ip6_t</a> <a class="code" href="structbcm__mirror__destination__s.html#a13f79f1f95fe2137e7cd74013902796d">dst6_addr</a>;        <span class="comment">/* Tunnel destination IP address (IPv6). */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__destination__s.html#a647730c93bbddceace3e92e5e567a90b">flow_label</a>;          <span class="comment">/* IPv6 header flow label field. */</span></div><div class="line">    <a class="code" href="group__types.html#ga4ccf23ca53e7e7e9a7be38b950aa7943">bcm_mac_t</a> <a class="code" href="structbcm__mirror__destination__s.html#aa921daa2f03946ed7c419003a5682c7c">src_mac</a>;          <span class="comment">/* L2 source MAC address. */</span></div><div class="line">    <a class="code" href="group__types.html#ga4ccf23ca53e7e7e9a7be38b950aa7943">bcm_mac_t</a> <a class="code" href="structbcm__mirror__destination__s.html#a33c5fcf3763db0dc69dfabf13ae238d8">dst_mac</a>;          <span class="comment">/* L2 destination MAC address. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#a32ad75ce30562c526f5b504fbb0187c1">tpid</a>;                <span class="comment">/* L2 header outer TPID. */</span></div><div class="line">    <a class="code" href="group__types.html#ga206cad73150c7e799b9a1cd4ebe13465">bcm_vlan_t</a> <a class="code" href="structbcm__mirror__destination__s.html#a5da4724324e0b2fcd77308a2dac2dcbc">vlan_id</a>;         <span class="comment">/* VLAN ID. */</span></div><div class="line">    <a class="code" href="group__types.html#ga04c6eee407827c6e305098013209b1de">bcm_trill_name_t</a> <a class="code" href="structbcm__mirror__destination__s.html#a303c46a7dd5c37a2bcdcd68dfac89d19">trill_src_name</a>; <span class="comment">/* TRILL source bridge nickname */</span></div><div class="line">    <a class="code" href="group__types.html#ga04c6eee407827c6e305098013209b1de">bcm_trill_name_t</a> <a class="code" href="structbcm__mirror__destination__s.html#af92cb906b1972eca0b343c5d36b2fd61">trill_dst_name</a>; <span class="comment">/* TRILL destination bridge nickname */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__mirror__destination__s.html#a17090c0028db91bc6575a095bff9b38b">trill_hopcount</a>;         <span class="comment">/* TRILL hop count */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#a38441481692d4b4cbd8a19d9938de60a">niv_src_vif</a>;         <span class="comment">/* Source Virtual Interface of NIV tag */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#add28f56a9d1e59aa4b33d98760378eed">niv_dst_vif</a>;         <span class="comment">/* Destination Virtual Interface of NIV tag */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__destination__s.html#a2b3f89fd1cc03ad33c50fccc9a410c06">niv_flags</a>;           <span class="comment">/* NIV flags BCM_MIRROR_NIV_XXX */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#a4667a70eb04a951fe3d6cf49e88b7130">gre_protocol</a>;        <span class="comment">/* L3 GRE header protocol */</span></div><div class="line">    <a class="code" href="group__types.html#ga252d53447d82acf3fb573f1918e7f251">bcm_policer_t</a> <a class="code" href="structbcm__mirror__destination__s.html#a143d6b42473f4c7f524f7980b2f02ee3">policer_id</a>;   <span class="comment">/* policer_id */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__mirror__destination__s.html#a31bf8ad94a92b00a66bc7e32e1ba7c98">stat_id</a>;                <span class="comment">/* stat_id */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__mirror__destination__s.html#a024313371d8915934963ca4caf4c1593">stat_id2</a>;               <span class="comment">/* stat_id2 for second counter pointer */</span></div><div class="line">    <a class="code" href="group__types.html#ga30e6e81bfad0b18e55d3a1c8148fd75d">bcm_if_t</a> <a class="code" href="structbcm__mirror__destination__s.html#a399a9c2e57c84182ae4d633fb9340f11">encap_id</a>;          <span class="comment">/* Encapsulation index */</span></div><div class="line">    <a class="code" href="group__types.html#ga30e6e81bfad0b18e55d3a1c8148fd75d">bcm_if_t</a> <a class="code" href="structbcm__mirror__destination__s.html#aff50af007d002d5a1b460617ce5778b4">tunnel_id</a>;         <span class="comment">/* IP tunnel for encapsulation. Valid only if BCM_MIRROR_DEST_TUNNEL_IP_GRE is set */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#a8797d60467977b8702526105de761922">span_id</a>;             <span class="comment">/* SPAN-ID. Valid only if BCM_MIRROR_DEST_TUNNEL_WITH_SPAN_ID is set */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__destination__s.html#a7fea62f9774dcf46f215550b4d8dcfb5">pkt_prio</a>;             <span class="comment">/* L2 header PCP */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__destination__s.html#aa92023c76a3bdfcb6f5e1420c0116d0b">sample_rate_dividend</a>;<span class="comment">/* The probability of mirroring a packet is: sample_rate_dividend &gt;= sample_rate_divisor ? 1 : sample_rate_dividend / sample_rate_divisor */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__destination__s.html#abefd0f361935e57664f99f3f956c9a5e">sample_rate_divisor</a>;</div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__destination__s.html#a630d812a47a869eb40694bb145c96cb0">int_pri</a>;              <span class="comment">/* Internal Priority */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#a4f9e0e0e65bc668397cf0ea82b861295">etag_src_vid</a>;        <span class="comment">/* Extended (source) port vlan id */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#a87dd215c9c60f9657426dff6d93e4ca6">etag_dst_vid</a>;        <span class="comment">/* Extended (destination) port vlan id */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#a5aeb16066884baecd9b18fac7be10c92">udp_src_port</a>;        <span class="comment">/* UDP source port */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#a36e2b1075a56c6c23ec5555b27bff470">udp_dst_port</a>;        <span class="comment">/* UDP destination port */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__destination__s.html#a8139ca10ed0df81e7463a157937feb92">egress_sample_rate_dividend</a>; <span class="comment">/* The probability of outbound mirroring a packet from the destination is sample_rate_dividend &gt;= sample_rate_divisor ? 1 : sample_rate_dividend / sample_rate_divisor */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__destination__s.html#a950d9a997a7796d4353c6a3d835b9d23">egress_sample_rate_divisor</a>;</div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__destination__s.html#a3c2dad1dfe0de0872623933e7f84c20b">recycle_context</a>;     <span class="comment">/* recycle context of egress originating packets */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#ac4d3502cf909a1a06611e5b827f18202">packet_copy_size</a>;   <span class="comment">/* If non zero, the copied packet will be truncated to the first packet_copy_size . Current supported values for DNX are 0, 64, 128, 192. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#a2382a8c01347c808393a1ca180e59a0d">egress_packet_copy_size</a>; <span class="comment">/* If non zero and the packet is copied from the egress, the packet will be truncated to the first packet_copy_size . Current supported values for DNX are 0, 256. */</span></div><div class="line">  <a class="code" href="structbcm__mirror__pkt__header__updates__s.html">bcm_mirror_pkt_header_updates_t</a> <a class="code" href="structbcm__mirror__destination__s.html#a0e9bfb43bca001b7ba2e10b246042f8d">packet_control_updates</a>;</div><div class="line">    <a class="code" href="mirror_8h.html#ab9b137a3f311c4d4b5475067eed79073">bcm_mirror_psc_t</a> <a class="code" href="structbcm__mirror__destination__s.html#a55cf107070435f888fe684233730cdda">rtag</a>;              <span class="comment">/* specify RTAG HASH algorithm used for shared-id mirror destination */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__destination__s.html#a7057f0596aa0dbd357518f87de50338d">df</a>;                  <span class="comment">/* Set the do not fragment bit of IP header in mirror encapsulation */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__destination__s.html#a8c569425cee94cf039e99605c54cdeb7">truncate</a>;            <span class="comment">/* Setting truncate would result in mirroring a truncated frame */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#ae15f673328eb3e043712dd060063d385">template_id</a>;        <span class="comment">/* Template ID for IPFIX HDR */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__destination__s.html#a8ca0f46f46696a025844bc0b813ba2ae">observation_domain</a>; <span class="comment">/* Observation Domain for IPFIX HDR */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__destination__s.html#ac56d0533e82dba9f4ca2361e27b2d692">is_recycle_strict_priority</a>; <span class="comment">/* Recycle priority (1-lossless, 0-high) */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__mirror__destination__s.html#a57ea6cf11b0ac0613ec0219a4acaa132">ext_stat_id</a>[BCM_MIRROR_EXT_STAT_ID_COUNT]; <span class="comment">/* ext_stat_id to support statistic interface for mirror packets */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__destination__s.html#a9e558b14122793cfe22e8f340eeeab04">flags2</a>;             <span class="comment">/* See BCM_MIRROR_DEST_FLAGS2_xxx flag definitions. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__destination__s.html#ae0bc77dc6fea1911a10ba44aa06d73f5">vni</a>;                <span class="comment">/* Virtual Network Interface ID. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__destination__s.html#ab10062943f0ac4824d762653869c987c">gre_seq_number</a>;     <span class="comment">/* Sequence number value used in GRE header. If no value is provided, gre_seq_number will start with 0. Valid only if BCM_MIRROR_DEST_TUNNEL_IP_GRE is set. */</span></div><div class="line">    <a class="code" href="structbcm__mirror__pkt__erspan__encap__s.html">bcm_mirror_pkt_erspan_encap_t</a> <a class="code" href="structbcm__mirror__destination__s.html#abfab78250d59433f9b020543027f0d42">erspan_header</a>; <span class="comment">/* ERSPAN encapsulation header fields. Valid only if only BCM_MIRROR_DEST_TUNNEL_IP_GRE is set. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__destination__s.html#af445eec232188d72aae9a2bd7acd1250">initial_seq_number</a>; <span class="comment">/* Starting seq number in SFLOW or PSAMP header */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a56220d8bc5aec20767d922e2c9953100">bcm_mirror_psamp_fmt2_meta_data_t</a> <a class="code" href="structbcm__mirror__destination__s.html#a80edea8059b4e1a427f9424918237ddb">meta_data_type</a>; <span class="comment">/* Type of item in &#39;meta_data&#39; */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#a7bb9a9cbfd663fd81abae84d0163eeee">meta_data</a>; <span class="comment">/* Actual value of class id or meta data, based on &#39;meta_data_type&#39; */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__mirror__destination__s.html#ae1abb0f564deb11c4b5a1c01aee586ee">ext_stat_valid</a>;                 <span class="comment">/* Validates the ext_stat. */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__mirror__destination__s.html#af7fe1321366a73893f9762b38de368fc">ext_stat_type_id</a>[BCM_MIRROR_EXT_STAT_ID_COUNT]; <span class="comment">/* Type ids for statistic interface. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#a6ed8ed39c80a07468c97aa4aa46c2c2a">ipfix_version</a>;               <span class="comment">/* IPFIX version number in PSAMP</span></div><div class="line"><span class="comment">                                           encapsulation. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> <a class="code" href="structbcm__mirror__destination__s.html#a5be882d8acf4e0aa828201c8032137e8">psamp_epoch</a>;                 <span class="comment">/* PSAMP epoch field. */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__mirror__destination__s.html#a9e0c11950f4ae23837f51204f32caa1d">cosq</a>;                           <span class="comment">/* Queue id that mirror copy is enqueued</span></div><div class="line"><span class="comment">                                           into. */</span></div><div class="line">} <a class="code" href="mirror_8h.html#a01307291aea8c640c06479a8f3393b39">bcm_mirror_destination_t</a>;</div></div><!-- fragment --><p>The Mirror destination callback function prototype is defined as follows: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> int (*<a class="code" href="mirror_8h.html#ae55de69745bcdeec00bbc35e40ca470e">bcm_mirror_destination_traverse_cb</a>)(</div><div class="line">    <span class="keywordtype">int</span> unit,</div><div class="line">    <a class="code" href="structbcm__mirror__destination__s.html">bcm_mirror_destination_t</a> *mirror_dest,</div><div class="line">    <span class="keywordtype">void</span> *<a class="code" href="l3_8dox.html#afc6e325b3b8c838e0a205aa5c1ec69bd">user_data</a>);</div></div><!-- fragment --><p> Mirroring destinations traverse callback might be used to traverse all installed mirror destinations <a class="el" href="mirror_8h.html#bcm_mirror_destination_traverse">bcm_mirror_destination_traverse</a> .</p>
<p>The <a class="el" href="structbcm__mirror__port__info__s.html">bcm_mirror_port_info_s</a> structure contains mirroring information per port. Mirror information is described in the following structure.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="structbcm__mirror__port__info__s.html">bcm_mirror_port_info_s</a> {</div><div class="line">    <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> <a class="code" href="structbcm__mirror__port__info__s.html#a570a5974de3cce8ea7d7ae2b71bc0ca5">mirror_system_id</a>;   <span class="comment">/* Unique mirror System identifier. */</span></div><div class="line">} <a class="code" href="mirror_8h.html#a9932668fbf0455c5611c606d22fc6f00">bcm_mirror_port_info_t</a>;</div></div><!-- fragment --><p>Mirroring to trunk groups is only supported on StrataXGS III switch chips, and to use this feature, bcmSwitchDirectedMirroring must be set to 1 using the <a class="el" href="group__switch.html#bcm_switch_control_set">bcm_switch_control_set</a> API function. With this setting enabled it is also possible to use more than one mirror-to port.</p>
<p>The device mirroring resources on some StrataXGS III switch chips may be configured to provide more mirror destinations at the cost of unpredictable interactions between field processor and port-based mirroring. If only one mirroring source type is required, or conflicting configuration between the two sources is considered manageable, then the full quantity of mirror destinations may be enabled by setting the bcmSwitchFlexibleMirrorDestinations control to 1 via the <a class="el" href="group__switch.html#bcm_switch_control_set">bcm_switch_control_set</a> API function. Note that bcmSwitchDirectedMirroring must also be enabled to use this capability.</p>
<p>Some StrataXGS devices permit more than eight members in a trunk group. A mirror destination will only utilize up to the first eight members of a trunk group. Thus, if a trunk is intended to be used as a mirror destination, at most eight members should be added. If a trunk group is configured to be used as both a mirror destination and for other switching purposes, the members to receive mirror copies should be the first eight ports of the trunk group configuration.</p>
<p>Mirroring with encapsulation is supported on StrataXGS III switch chips, and requires bcmSwitchDirectedMirroring set to 1. (Some devices support only this directed mirroring mode.)</p>
<p>Mirroring destinations traverse callback might be used to traverse all installed mirror destinations bcm_mirror_destination_traverse (page 707) Mirroring to trunk groups is only supported on StrataXGS III switch chips, and to use this feature, bcmSwitchDirectedMirroring must be set to 1 using the bcm_switch_control_set (page 709) API function. With this setting enabled it is also possible to use more than one mirror-to port. Mirroring with encapsulation is supported on StrataXGS III switch chips, and requires bcmSwitchDirectedMirroring set to 1. (Some devices support only this directed mirroring mode.)</p>
<p>For BCM5684x and subsequent devices, both L2 and L3 GRE tunnels may be configured as part of a mirror destination on the mirror source device. For prior XGS devices, an L2 tunnel may be configured as part of the mirror destination only if the destination gport is local to the mirror source device. If the mirror destination gport is remote, then the mirror destination should omit the BCM_MIRROR_DEST_TUNNEL_L2 flag. Instead, the mirror destination should be created with the remote gport, and the port should be configured on its own device via the bcm_mirror_vlan_set <a class="el" href="mirror_8h.html#bcm_mirror_vlan_set">bcm_mirror_vlan_set</a> API. BCM5684x and subsequent devices will support either of these modes &ndash; the previous version employing bcm_mirror_vlan_set to interoperate in a stack with predecessor devices, and the new mirror destination mode to allow additional TRILL or NIV encapsulation.</p>
<p>A new switch control bcmSwitchMirrorExclusive is introduced for devices BCM56334_A0, BCM56334_B0, BCM56624_A0, BCM56624_B0, BCM56680_A0, BCM56680_B0, BCM56725_A0, BCM56820_A0. Basically this mirror exclusive mode is applicable for devices which support 4 Mirroring destination but 2 Slot Containers. In this mode mirror slot containers between Port and FP becomes mutually exclusive. Mirror slot container can be shared within Port Mirroring and FP mirroring but not across. This behavior introduces it's own limitation. For eg. If Port Mirroring uses both Slot Containers Slot0 and Slot1 for ingress then FP cannot program third ingress MTP destination, same is true in vice versa case. bcmSwitchMirrorExclusive must be set to 1 using the <a class="el" href="group__switch.html#bcm_switch_control_set">bcm_switch_control_set</a> API function. By default Mirror Exclusive is not set. This mode also require bcmSwitchDirectedMirroring set to 1 to take effect.</p>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a276f4b1aa803996a678295043e81d2c5" title="Initialize the mirroring module to its initial configuration.">bcm_mirror_init(int unit)</a>  </td><td>Initialize the mirroring module to its initial configuration.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a8e0942b9bf3bbf701ba3c68d912f4dc7" title="Set the current mirroring mode for the device.">bcm_mirror_mode_set(int unit, int mode)</a>  </td><td>Set the current mirroring mode for the device.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a7cce8fc4d5e57901c5da9f5d7badaed4" title="Get the current mirroring mode for the device.">bcm_mirror_mode_get(int unit, int* mode)</a>  </td><td>Get the current mirroring mode for the device.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a782025747ab059831b5b717e7341a5e2" title="Set the mirror-to port for the device.">bcm_mirror_to_set(int unit, bcm_port_t port)</a>  </td><td>Set the mirror-to port for the device.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#acdfebec3ba4c2272ca73d58b41b3355f" title="Get the mirror-to port for the device.">bcm_mirror_to_get(int unit, bcm_port_t* port)</a>  </td><td>Get the mirror-to port for the device.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a6bfc29719dd0198a90c064f740298f4a" title="Enable or Disable ingress mirroring for a port on the device.">bcm_mirror_ingress_set(int unit, bcm_port_t port, int val)</a>  </td><td>Enable or Disable ingress mirroring for a port on the device.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a011502bb1c743ec48bb7698d97b30208" title="Get the ingress mirroring enabled/disabled status for a port on the device.">bcm_mirror_ingress_get(int unit, bcm_port_t port, int* val)</a>  </td><td>Get the ingress mirroring enabled/disabled status for a port on the device.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#affd908e5feb4ad66c88948952fd7ab3d" title="Enable or Disable egress mirroring for a port on the device.">bcm_mirror_egress_set(int unit, bcm_port_t port, int val)</a>  </td><td>Enable or Disable egress mirroring for a port on the device.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a373a510202836d45d4452b602536de9c" title="Get the egress mirroring enabled/disabled status for a port on the device.">bcm_mirror_egress_get(int unit, bcm_port_t port, int* val)</a>  </td><td>Get the egress mirroring enabled/disabled status for a port on the device.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#ad7908eec06f073518f91504ae3593d5b" title="Set the mirror-to port bitmap for the device.">bcm_mirror_to_pbmp_set(int unit, bcm_port_t port, bcm_pbmp_t pbmp)</a>  </td><td>Set the mirror-to port bitmap for the device.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#afe17a83afc4e00e30c08a8b9a213e5ad" title="Get the mirror-to port bitmap for the device.">bcm_mirror_to_pbmp_get(int unit, bcm_port_t port, bcm_pbmp_t* pbmp)</a>  </td><td>Get the mirror-to port bitmap for the device.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a5f513af97cf11e94ec111623814e3c0f" title="Set mirroring configuration for a port.">bcm_mirror_port_set(int unit, bcm_port_t port, bcm_module_t dest_mod, bcm_port_t dest_port, uint32 flags)</a>  </td><td>Set mirroring configuration for a port.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#ad63a1f2bfbf9cb94f16cb6bc85b66808" title="Get mirroring configuration for a port.">bcm_mirror_port_get(int unit, bcm_port_t port, bcm_module_t* dest_mod, bcm_port_t* dest_port, uint32* flags)</a>  </td><td>Get mirroring configuration for a port.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#ac60c97d850e525361bf9c8c35652a0aa" title="Set VLAN for egressing mirrored packets on a port (RSPAN).">bcm_mirror_vlan_set(int unit, bcm_port_t port, uint16 tpid, uint16 vlan)</a>  </td><td>Set VLAN for egressing mirrored packets on a port (RSPAN).   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a3bfee90aa979ac899251380fa0bea63c" title="Get VLAN for egressing mirrored packets on a port (RSPAN).">bcm_mirror_vlan_get(int unit, bcm_port_t port, uint16* tpid, uint16* vlan)</a>  </td><td>Get VLAN for egressing mirrored packets on a port (RSPAN).   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#ab83a6f7599bf6c669269ed2394b47327" title="Add mirroring destination to a port.">bcm_mirror_port_dest_add(int unit, bcm_port_t port, uint32 flags, bcm_gport_t mirror_dest_id)</a>  </td><td>Add mirroring destination to a port   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a4e3efd0c55a737346f62814659d9bb2b" title="Delete mirroring destination from a port.">bcm_mirror_port_dest_delete(int unit, bcm_port_t port, uint32 flags, bcm_gport_t mirror_dest_id)</a>  </td><td>Delete mirroring destination from a port   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#ac266e6ed65ae947e0ec9e362c5719f41" title="Delete all mirroring destinations from a port.">bcm_mirror_port_dest_delete_all(int unit, bcm_port_t port, uint32 flags)</a>  </td><td>Delete all mirroring destinations from a port   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a56c393ea461966910e6a712937cad7f7" title="Get port mirroring destinations.">bcm_mirror_port_dest_get(int unit, bcm_port_t port, uint32 flags, int mirror_dest_size, bcm_gport_t* mirror_dest, int* mirror_dest_count)</a>  </td><td>Get port mirroring destinations   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#abe3cb5a24e3835aaeb4a3edcd89132c8" title="Initialize a mirror destination structure.">bcm_mirror_destination_t_init(bcm_mirror_destination_t* mirror_dest)</a>  </td><td>Initialize a mirror destination structure.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a5d8e183a4b7d59771aa49fd60dff50bd" title="Add mirror destination descriptor.">bcm_mirror_destination_create(int unit, bcm_mirror_destination_t* mirror_dest)</a>  </td><td>Add mirror destination descriptor.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#ad06603b1175faba40be05154d422c367" title="Remove mirror destination descriptor.">bcm_mirror_destination_destroy(int unit, bcm_gport_t mirror_dest_id)</a>  </td><td>Remove mirror destination descriptor.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a3eb9d13981a8b1bff06e8d2f0f3badee" title="Read content of mirror destination descriptor.">bcm_mirror_destination_get(int unit, bcm_gport_t mirror_dest_id, bcm_mirror_destination_t* mirror_dest)</a>  </td><td>Read content of mirror destination descriptor   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a3f875475453ffc7cfb5c372f920ad2bb" title="Traverse over all installed mirror destination descriptors.">bcm_mirror_destination_traverse(int unit, bcm_mirror_destination_traverse_cb cb, void* user_data)</a>  </td><td>Traverse over all installed mirror destination descriptors.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a6a89dcbfacd616db7ed2dd27eb2e33a2" title="Set mirroring configuration for a port-vlan.">bcm_mirror_port_vlan_set(int unit, bcm_port_t port, bcm_vlan_t vlan, bcm_gport_t destport, uint32 flags)</a>  </td><td>Set mirroring configuration for a port-vlan.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a26ff60dd98b4d290ed53e438bd96ae17" title="Get mirroring configuration for a port-vlan.">bcm_mirror_port_vlan_get(int unit, bcm_port_t port, bcm_vlan_t vlan, bcm_gport_t* dest_port, uint32* flags)</a>  </td><td>Get mirroring configuration for a port-vlan   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a454a0c48053d460220d39ff473880090" title="Add mirroring destination to a port-vlan.">bcm_mirror_port_vlan_dest_add(int unit, bcm_port_t port, bcm_vlan_t vlan, uint32 flags, bcm_gport_t destid)</a>  </td><td>Add mirroring destination to a port-vlan   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#affd8efce57cbddf8dff5bb48f6df72d4" title="Delete mirroring destination from a port-vlan.">bcm_mirror_port_vlan_dest_delete(int unit, bcm_port_t port, bcm_vlan_t vlan, uint32 flags, bcm_gport_t destid)</a>  </td><td>Delete mirroring destination from a port-vlan   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a0c4f81032b5d7fa83b0ab8e8e8a90d66" title="Delete all mirroring destinations from a port-vlan.">bcm_mirror_port_vlan_dest_delete_all(int unit, bcm_port_t port, bcm_vlan_t vlan, uint32 flags)</a>  </td><td>Delete all mirroring destinations from a port-vlan.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#abb9a166ed6b131e4852addb4e06436ba" title="Get port-vlan mirroring destinations.">bcm_mirror_port_vlan_dest_get(int unit, bcm_port_t port, bcm_vlan_t vlan, uint32 flags, uint32 mirror_dest_size, bcm_gport_t* destid, uint32* destcount)</a>  </td><td>Get port-vlan mirroring destinations   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a7aba1266cf7fd582e255dd893020acf3" title="Initialize a mirror port information structure.">bcm_mirror_port_info_t_init(bcm_mirror_port_info_t* info)</a>  </td><td>Initialize a mirror port information structure.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#ab7646d7330b6f33de81f4befc7d05e08" title="Set mirroring information per port.">bcm_mirror_port_info_set(int unit, bcm_port_t port, uint32 flags, bcm_mirror_port_info_t* info)</a>  </td><td>Set mirroring information per port.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a4883da2841a75aee25c8681924ab1375" title="Get mirroring information per port.">bcm_mirror_port_info_get(int unit, bcm_port_t port, uint32 flags, bcm_mirror_port_info_t* info)</a>  </td><td>Get mirroring information per port.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a9e72c69eb7934c021e1e93b8f58e97a3" title="Initialized bcm_mirror_pkt_header_updates_t struct.">bcm_mirror_pkt_header_updates_t_init(bcm_mirror_pkt_header_updates_t* mirror_dest)</a>  </td><td>Initialized bcm_mirror_pkt_header_updates_t struct   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a7f054cd4cd49921c0382f9f03b80e513" title="extended versions of existing dest APIs using a bcm_mirror_options_t argument">bcm_mirror_options_t_init(bcm_mirror_options_t* mirror_dest)</a>  </td><td>extended versions of existing <em>dest</em> APIs using a bcm_mirror_options_t argument   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a8e22665de816a02d60b4700e30765bb1" title="extended versions of existing dest APIs using a bcm_mirror_options_t argument">bcm_mirror_port_destination_add(int unit, bcm_port_t port, uint32 flags, bcm_gport_t mirror_dest, bcm_mirror_options_t options)</a>  </td><td>extended versions of existing <em>dest</em> APIs using a bcm_mirror_options_t argument   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a1afc79f7bbae66495f563ec54ede1710" title="extended versions of existing dest APIs using a bcm_mirror_options_t argument">bcm_mirror_port_destination_get(int unit, bcm_port_t port, uint32 flags, int mirror_dest_size, bcm_gport_t* mirror_dest, int* mirror_dest_count, bcm_mirror_options_t* options)</a>  </td><td>extended versions of existing <em>dest</em> APIs using a bcm_mirror_options_t argument   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a46a2297e1aa5cc8a19ad10eaba63c575" title="extended versions of existing dest APIs using a bcm_mirror_options_t argument">bcm_mirror_port_vlan_destination_add(int unit, bcm_port_t port, bcm_vlan_t vlan, uint32 flags, bcm_gport_t destid, bcm_mirror_options_t options)</a>  </td><td>extended versions of existing <em>dest</em> APIs using a bcm_mirror_options_t argument   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a78e624cd28ffa04570149a318c7a70bd" title="extended versions of existing dest APIs using a bcm_mirror_options_t argument">bcm_mirror_port_vlan_destination_get(int unit, bcm_port_t port, bcm_vlan_t vlan, uint32 flags, uint32 mirror_dest_size, bcm_gport_t* destid, uint32* destcount, bcm_mirror_options_t* options)</a>  </td><td>extended versions of existing <em>dest</em> APIs using a bcm_mirror_options_t argument   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#abc12b61677cc473d112600cf4e9d76cd" title="Initialize a payload zero information structure.">bcm_mirror_payload_zero_info_t_init(bcm_mirror_payload_zero_info_t* info)</a>  </td><td>Initialize a payload zero information structure.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#af9d628619f60e57655f2c3d26806f9e6" title="Set values of one or more payload zeroing parameters.">bcm_mirror_payload_zero_control_multi_set(int unit, bcm_mirror_payload_zero_info_t* payload_zero_config_array, int num_configs)</a>  </td><td>Set values of one or more payload zeroing parameters.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#ac584e6cbb2a2bbdf3dca7b0c66459615" title="Get values of one or more payload zeroing parameters.">bcm_mirror_payload_zero_control_multi_get(int unit, bcm_mirror_payload_zero_info_t* payload_zero_config_array, int num_configs)</a>  </td><td>Get values of one or more payload zeroing parameters.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a51b39177babe39f89bb20c5c68c14c17" title="Map/unmap forward port to recycle mirror port (to unmap set rcy_mirror_port to BCM_MIRROR_INVALID_RCY...">bcm_mirror_port_to_rcy_port_map_set(int unit, uint32 flags, bcm_port_t forward_port, bcm_mirror_port_to_rcy_map_info_t* rcy_map_info)</a>  </td><td>Map/unmap forward port to recycle mirror port (to unmap set rcy_mirror_port to BCM_MIRROR_INVALID_RCY_PORT)   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a3666545ee52b7eacaba1cf68cfbaa401" title="Get recycle mirror port from forward port.">bcm_mirror_port_to_rcy_port_map_get(int unit, uint32 flags, bcm_port_t forward_port, bcm_mirror_port_to_rcy_map_info_t* rcy_map_info)</a>  </td><td>Get recycle mirror port from forward port.   </td></tr>
</table>
<p>TM header information for mirrored packet </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__mirror__pkt__dnx__ftmh__header__s.html">bcm_mirror_pkt_dnx_ftmh_header_s</a> {</div><div class="line">    <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> <a class="code" href="structbcm__mirror__pkt__dnx__ftmh__header__s.html#a4f30fb6c901f52b90f5dfe5f8fd44368">src_sysport</a>;            <span class="comment">/* Source System port */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__pkt__dnx__ftmh__header__s.html#aa05d1c0e2c97f1d181cd9ee1157bc608">tc</a>;                           <span class="comment">/* Traffic class */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__pkt__dnx__ftmh__header__s.html#ab4d4c687bf9419271f714b730c3b78a2">dp</a>;                           <span class="comment">/* Drop precedence */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__pkt__dnx__ftmh__header__s.html#ae2f6bf52459760e0f101f34a8d973985">is_mc_traffic</a>;                <span class="comment">/* Destination is multicast */</span></div><div class="line">    <a class="code" href="group__types.html#ga0f3f07b8f11cb4e625b0f42d6cc7f94c">bcm_multicast_t</a> <a class="code" href="structbcm__mirror__pkt__dnx__ftmh__header__s.html#af62dd92a224599f71757a3fb0b832436">mc_id</a>;              <span class="comment">/* Destination Multicast ID (when</span></div><div class="line"><span class="comment">                                           is_mc_traffic is set) */</span></div><div class="line">    <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> <a class="code" href="structbcm__mirror__pkt__dnx__ftmh__header__s.html#a2ed45dc2573bee86f08615e287796a67">out_vport</a>;              <span class="comment">/* Destination Outlif (when</span></div><div class="line"><span class="comment">                                           is_mc_traffic is cleared) */</span></div><div class="line">    <a class="code" href="structbcm__pkt__dnx__ftmh__ase__extension__s.html">bcm_pkt_dnx_ftmh_ase_extension_t</a> <a class="code" href="structbcm__mirror__pkt__dnx__ftmh__header__s.html#a9f8a3e3a4fe64e8207f61eb39c1e6c24">ase_ext</a>; <span class="comment">/* FTMH Application Specific Extension */</span></div><div class="line">    <a class="code" href="structbcm__pkt__dnx__ftmh__flow__id__extension__s.html">bcm_pkt_dnx_ftmh_flow_id_extension_t</a> <a class="code" href="structbcm__mirror__pkt__dnx__ftmh__header__s.html#a8816c410c1250c5450575b898270cbb4">flow_id_ext</a>; <span class="comment">/* FTMH Flow-ID Extension */</span></div><div class="line">} <a class="code" href="mirror_8h.html#ade0af3ab4bc74b8daabf7846b2eeb18d">bcm_mirror_pkt_dnx_ftmh_header_t</a>;</div></div><!-- fragment --><p>PP header information for mirrored packet </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__mirror__pkt__dnx__pp__header__s.html">bcm_mirror_pkt_dnx_pp_header_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> tailedit_en;              <span class="comment">/* Tailedit enable (reserved, set to 0) */</span></div><div class="line">    <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> <a class="code" href="structbcm__mirror__pkt__dnx__pp__header__s.html#aa0c2520d1dcb49fbbe47bf7f3b002248">out_vport_ext</a>[3];   <span class="comment">/* Extended outlif(s) */</span></div><div class="line">} <a class="code" href="mirror_8h.html#a120709c229eb5419be422d328b123016">bcm_mirror_pkt_dnx_pp_header_t</a>;</div></div><!-- fragment --><p>System header information </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__mirror__header__info__s.html">bcm_mirror_header_info_s</a> {</div><div class="line">    <a class="code" href="structbcm__mirror__pkt__dnx__ftmh__header__s.html">bcm_mirror_pkt_dnx_ftmh_header_t</a> <a class="code" href="structbcm__mirror__header__info__s.html#a50598ad5b364d7d002eba166fb312bed">tm</a>; <span class="comment">/* TM header */</span></div><div class="line">    <a class="code" href="structbcm__mirror__pkt__dnx__pp__header__s.html">bcm_mirror_pkt_dnx_pp_header_t</a> <a class="code" href="structbcm__mirror__header__info__s.html#aad6b6a2a107863444e1881124dda9a4c">pp</a>;  <span class="comment">/* PP header */</span></div><div class="line">    <a class="code" href="structbcm__pkt__dnx__udh__s.html">bcm_pkt_dnx_udh_t</a> <a class="code" href="structbcm__mirror__header__info__s.html#a06ecccee858782384208c7c3ee94687a">udh</a>[4];           <span class="comment">/* UDH header */</span></div><div class="line">} <a class="code" href="mirror_8h.html#a3ec69a70ac7a561cc8807058126f04b5">bcm_mirror_header_info_t</a>;</div></div><!-- fragment --><table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="mirror_8h.html#ad85926092b7604054c04fd68e28f77b7" title="Set system header information.">bcm_mirror_header_info_set(int unit, uint32 flags, bcm_gport_t mirror_dest_id, bcm_mirror_header_info_t* mirror_header_info)</a>  </td><td>Set system header information   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a578cb61f503fdbb7e2617f83dd079243" title="Get system header information.">bcm_mirror_header_info_get(int unit, bcm_gport_t mirror_dest_id, uint32* flags, bcm_mirror_header_info_t* mirror_header_info)</a>  </td><td>Get system header information   </td></tr>
</table>
<p><a class="anchor" id="MirrorPktHeaderFabricFtmhValidFlags"></a></p><a class="anchor" id=""></a>
<table class="doxtable">
<caption>BCM Mirror pkt header fabric ftmh_valid flags</caption>
<tr>
<th>Name </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_PACKET_SIZE </td><td>Packet size  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_PRIO </td><td>Traffic Class  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_SRC_SYSPORT </td><td>Source System port  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_DST_PORT </td><td>Destination local port  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_DP </td><td>Drop precedence  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_ACTION_TYPE </td><td>Action type  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_OUT_MIRROR_DISABLE </td><td>Disable Outbound mirroring  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_IS_MC_TRAFFIC </td><td>Indicate if the traffic is multicast  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_MULTICAST_ID </td><td>DMulticast ID  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_OUT_VPORT </td><td>Virtual port  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_CNI </td><td>Congestion indication  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_LB_KEY </td><td>Load Balancing Key  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_DST_SYSPORT </td><td>Destination System Port  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_STACK_ROUTE </td><td>Route bitmap to prevent loops in stacking system  </td></tr>
</table>
<p><a class="anchor" id="mirrorDestNoCount"></a></p><table class="doxtable">
<tr>
<th>Name </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_DEST_NO_COUNT </td><td>Value to disable counting of the snooped/mirrored copy, used in bcm_mirror_destination_create when flags BCM_MIRROR_DEST_UPDATE_COUNTER_1 and BCM_MIRROR_DEST_UPDATE_COUNTER_2 are given.  </td></tr>
</table>
<p><a class="anchor" id="MirrorPktHeaderFabricOamTsValidFlags"></a></p><a class="anchor" id=""></a>
<table class="doxtable">
<caption>BCM Mirror pkt header fabric oam_ts_valid flags</caption>
<tr>
<th>Name </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_OAM_TS_TYPE </td><td>Type  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_OAM_TS_SUB_TYPE </td><td>OAM-Sub-Type  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_OAM_TS_UP_MEP </td><td>MEP-Type  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_OAM_TS_TP_CMD </td><td>TP-Cmd  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_OAM_TS_ENCAPS </td><td>TS-Encaps  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_OAM_TS_DATA </td><td>OAM-TS-Data  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_OAM_TS_LATENCY_FLOW_ID </td><td>Latency flow ID  </td></tr>
<tr>
<td>BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_OAM_TS_OFFSET </td><td>Offset  </td></tr>
</table>
<p>bcm_mirror_pkt_header_fabric_t represents Fabric header updates of mirrored packets </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> ftmh_valid;          <span class="comment">/* Used to specify which fields to use for</span></div><div class="line"><span class="comment">                                   header changes. Possible values will be named</span></div><div class="line"><span class="comment">                                   BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_FTMH_ */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> internal_valid;      <span class="comment">/* Used to specify which fields to use for</span></div><div class="line"><span class="comment">                                   header changes. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> oam_ts_valid;        <span class="comment">/* Used to specify which fields to use for</span></div><div class="line"><span class="comment">                                   header changes. Possible values will be named</span></div><div class="line"><span class="comment">                                   BCM_MIRROR_PKT_HEADER_FABRIC_UPDATE_OAM_TS_ */</span></div><div class="line">    <a class="code" href="structbcm__pkt__dnx__ftmh__s.html">bcm_pkt_dnx_ftmh_t</a> ftmh;    <span class="comment">/* FTMH header fields */</span></div><div class="line">    <a class="code" href="structbcm__pkt__dnx__internal__s.html">bcm_pkt_dnx_internal_t</a> <span class="keyword">internal</span>;      <span class="comment">/* Internal header fields */</span></div><div class="line">    <a class="code" href="structbcm__pkt__dnx__otsh__s.html">bcm_pkt_dnx_otsh_t</a> oam_ts;  <span class="comment">/* OAM-TS header fields */</span></div><div class="line">} <a class="code" href="mirror_8h.html#a875e6ec86e7f9d29128bb34e3ced1d62">bcm_mirror_pkt_header_fabric_t</a>; <span class="comment">/* represents Fabric header updates of mirrored packets */</span></div></div><!-- fragment --><a class="anchor" id=""></a>
<table class="doxtable">
<caption>BCM MIRROR EXT flags</caption>
<tr>
<th>Name </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_EXT_STAT_ID_COUNT </td><td>Number of statistic interfaces for mirrored packets.  </td></tr>
</table>
<a class="anchor" id=""></a>
<table class="doxtable">
<caption>BCM MIRROR ZERO OFFSET PROFILE flags</caption>
<tr>
<th>Name </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_PAYLOAD_ZERO_FP </td><td>Denotes that profile is used by Field Module.  </td></tr>
</table>
<p>Mirror payload zero offset profile information </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__mirror__payload__zero__offsets__s.html">bcm_mirror_payload_zero_offsets_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__payload__zero__offsets__s.html#aa031e74528821832cc939329b4fcaae2">l2_offset</a>;        <span class="comment">/* The offset from the end of the known L2 headers to start zeroing</span></div><div class="line"><span class="comment">                               the truncated mirrored packet. This is in increments of 2 bytes (16b).*/</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__payload__zero__offsets__s.html#a875720c9554286b6ffb6ea13d25620f2">l3_offset</a>;        <span class="comment">/* The offset from the end of the known L3 headers to start zeroing</span></div><div class="line"><span class="comment">                               the truncated mirrored packet non UDP packets. This is in</span></div><div class="line"><span class="comment">                               increments of 2 bytes (16b). */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__payload__zero__offsets__s.html#a928b306e7aed4c75b64607e796708f05">udp_offset</a>;       <span class="comment">/* The offset from the end of the known L3 headers to start zeroing</span></div><div class="line"><span class="comment">                               the truncated mirrored packet for UDP. This in in increments</span></div><div class="line"><span class="comment">                               of 2 bytes (16b). */</span></div><div class="line">} <a class="code" href="mirror_8h.html#ac956837deac67fa95445b83ac827d5b5">bcm_mirror_payload_zero_offsets_t</a>;</div></div><!-- fragment --><table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="mirror_8h.html#afe3d4d211a7fc18bf3df2494f5dca481" title="Creates a profile for Payload Zeroing.">bcm_mirror_payload_zero_profile_create(int unit, bcm_mirror_payload_zero_offsets_t* mirror_payload_offset_info, uint32 flags, uint32* profile_index)</a>  </td><td>Creates a profile for Payload Zeroing.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#ac76677b7ea659d013f6af024220bf0d9" title="Deletes a created profile for Payload Zeroing. Please make sure that all related configurations in ot...">bcm_mirror_payload_zero_profile_destroy(int unit, uint32 flags, uint32 profile_index)</a>  </td><td>Deletes a created profile for Payload Zeroing. Please make sure that all related configurations in other dependent modules like Field need to be cleaned up before calling the destroy. Otherwise the related configs will become stale/improper entries in the dependent modules.   </td></tr>
</table>
<p>Sample type: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="mirror_8h.html#a52c2c0dd7ef42cc8aaffec426c8b2a32">bcm_mirror_sample_type_e</a> {</div><div class="line">    <a class="code" href="mirror_8h.html#a52c2c0dd7ef42cc8aaffec426c8b2a32a5890e187d8766218bcdcd142d2801795">bcmMirrorSampleTypeIngress</a> = 0, <span class="comment">/* Ingress sample. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a52c2c0dd7ef42cc8aaffec426c8b2a32a27f55fd479dc00c95df38914fdac0f23">bcmMirrorSampleTypeFlex</a> = 1,    <span class="comment">/* Flex sample. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a52c2c0dd7ef42cc8aaffec426c8b2a32ac6111f4a6cb9c0353487d121a74cdd71">bcmMirrorSampleTypeCount</a> = 2    <span class="comment">/* The last one, not valid. */</span></div><div class="line">} <a class="code" href="mirror_8h.html#ae4b0ced52b12a2fb35d83459abfbfba8">bcm_mirror_sample_type_t</a>;</div></div><!-- fragment --><p>Sample mirror mode: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="mirror_8h.html#a3bc1458ee2aa351c33df697ee884e5ef">bcm_mirror_sample_mirror_mode_e</a> {</div><div class="line">    <a class="code" href="mirror_8h.html#a3bc1458ee2aa351c33df697ee884e5efa80be4d3a37b71ed4ec55a6e8e50cd071">bcmMirrorSampleMirrorModeNone</a> = 0,  <span class="comment">/* No mirror. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a3bc1458ee2aa351c33df697ee884e5efa841095fdbacc5db25a8aef9d58f3185c">bcmMirrorSampleMirrorModeBelowRate</a> = 1, <span class="comment">/* Mirror packets below sample rate. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a3bc1458ee2aa351c33df697ee884e5efa44e0315bb3ac32306af833577830dbb1">bcmMirrorSampleMirrorModeAboveRate</a> = 2, <span class="comment">/* Mirror packets above sample rate. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a3bc1458ee2aa351c33df697ee884e5efa3652a9989f342bd6319e886c2d57d09b">bcmMirrorSampleMirrorModeCount</a> = 3  <span class="comment">/* The last one, not valid. */</span></div><div class="line">} <a class="code" href="mirror_8h.html#ad0de94a49357e5215c6f89983da73f68">bcm_mirror_sample_mirror_mode_t</a>;</div></div><!-- fragment --><p>Sample profile structure: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__mirror__sample__profile__s.html">bcm_mirror_sample_profile_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__sample__profile__s.html#ae29c66fc4d2a4150945997ea87eaf08c">enable</a>;                       <span class="comment">/* Sample enable. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__sample__profile__s.html#ae79ebefe045af3d6787d3496dc4ab726">rate</a>;                        <span class="comment">/* Sample rate. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__sample__profile__s.html#a6f994d4c84c0da4c92ff4f486a2b3b20">pool_count_enable</a>;            <span class="comment">/* Enable to count the packets seen by</span></div><div class="line"><span class="comment">                                           the sampler. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__sample__profile__s.html#a2426b9e727cf9336ec266969d3402d43">sample_count_enable</a>;          <span class="comment">/* Enable to count the packets sampled</span></div><div class="line"><span class="comment">                                           by the sampler. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__mirror__sample__profile__s.html#a2d3d6068e2897d456339f5ae2c8ea59a">trace_enable</a>;                 <span class="comment">/* Enable to generate trace event. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#ad0de94a49357e5215c6f89983da73f68">bcm_mirror_sample_mirror_mode_t</a> <a class="code" href="structbcm__mirror__sample__profile__s.html#a2883c0a65ad589c2a83ab8ffe5152c55">mirror_mode</a>; <span class="comment">/* Sample mirror mode. */</span></div><div class="line">} <a class="code" href="mirror_8h.html#aa788edb4d2323a02c6078e01ad07bdc2">bcm_mirror_sample_profile_t</a>;</div></div><!-- fragment --><a class="anchor" id=""></a>
<table class="doxtable">
<caption>Sample profile option flags</caption>
<tr>
<th>Name </th><th>Value </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_SAMPLE_PROFILE_OPTIONS_WITH_ID </td><td>0x00000001 </td><td>Create sample profile with id.  </td></tr>
</table>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="mirror_8h.html#accca6560db476fade8af8a7d5de0e786" title="Initialize a sample profile structure.">bcm_mirror_sample_profile_t_init(bcm_mirror_sample_profile_t *profile)</a>  </td><td>Initialize a sample profile structure.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a29a9ae48db3c1419e91f34c863d6a507" title="Create a sample profile.">bcm_mirror_sample_profile_create(int unit, uint32 options, bcm_mirror_sample_type_t type, int *profile_id)</a>  </td><td>Create a sample profile.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a3a66e04ba1c91e7adac8462a892a3abd" title="Destroy a sample profile.">bcm_mirror_sample_profile_destroy(int unit, bcm_mirror_sample_type_t type, int profile_id)</a>  </td><td>Destroy a sample profile.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a9b90e8ba590d12d68ef56b099354097d" title="Set sample profile entry with given profile id and type.">bcm_mirror_sample_profile_set(int unit, bcm_mirror_sample_type_t type, int profile_id, bcm_mirror_sample_profile_t *profile)</a>  </td><td>Set sample profile entry with given profile id and type.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a75ba2436bd1297d249dbe43a08fbb6bf" title="Get sample profile entry with given profile id and type.">bcm_mirror_sample_profile_get(int unit, bcm_mirror_sample_type_t type, int profile_id, bcm_mirror_sample_profile_t *profile)</a>  </td><td>Get sample profile entry with given profile id and type.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a51c169c7e7688d34eda29837cd65e3d3" title="Attach counter entries to a sample type.">bcm_mirror_sample_stat_attach(int unit, bcm_mirror_sample_type_t type, uint32 stat_counter_id)</a>  </td><td>Attach counter entries to a sample type.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#ad1139d0b62c431a3b25e9e2c1c8d13a8" title="Detach counter entries from a sample type.">bcm_mirror_sample_stat_detach(int unit, bcm_mirror_sample_type_t type, uint32 stat_counter_id)</a>  </td><td>Detach counter entries from a sample type.   </td></tr>
</table>
<p>Mirror source type enum: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="mirror_8h.html#af93ab38f75357c8d9a0de4151e6e4a98">bcm_mirror_source_type_e</a> {</div><div class="line">    <a class="code" href="mirror_8h.html#af93ab38f75357c8d9a0de4151e6e4a98ad27d37fbc6d2142c29bfd375ca4c2350">bcmMirrorSourceTypePort</a> = 0,        <span class="comment">/* Port/gport type. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#af93ab38f75357c8d9a0de4151e6e4a98aa31111be3a98174383e4c3238efa1bff">bcmMirrorSourceTypePktTraceEvent</a> = 1, <span class="comment">/* Packet trace event type. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#af93ab38f75357c8d9a0de4151e6e4a98a5d11d2e6a1c38d98221481783b10176d">bcmMirrorSourceTypePktDropEvent</a> = 2, <span class="comment">/* Packet drop event type. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#af93ab38f75357c8d9a0de4151e6e4a98a2a9b75f8cefd0abc9b982749b0b9c513">bcmMirrorSourceTypeCosqMod</a> = 3,     <span class="comment">/* MMU mirror-on-drop type. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#af93ab38f75357c8d9a0de4151e6e4a98aa169ab7062db43ff7d3e31e1e1efc18a">bcmMirrorSourceTypeSampleIngress</a> = 4, <span class="comment">/* Ingress sample type. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#af93ab38f75357c8d9a0de4151e6e4a98a1b13e314d521b1214a8f6eedc00aea05">bcmMirrorSourceTypeSampleFlex</a> = 5,  <span class="comment">/* Flex sample type. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#af93ab38f75357c8d9a0de4151e6e4a98a885e63af08998e80bc4f06375b1c7502">bcmMirrorSourceTypeCount</a> = 6        <span class="comment">/* Must Be Last. Not a valid value. */</span></div><div class="line">} <a class="code" href="mirror_8h.html#a5c02b1fe456a1f4886992f8fcda5ed87">bcm_mirror_source_type_t</a>;</div></div><!-- fragment --><a class="anchor" id=""></a>
<table class="doxtable">
<caption>Mirror source flags</caption>
<tr>
<th>Name </th><th>Value </th><th>Description  </th></tr>
<tr>
<td>BCM_MIRROR_SOURCE_INGRESS </td><td>0x00000001 </td><td>Ingress Mirroring.  </td></tr>
<tr>
<td>BCM_MIRROR_SOURCE_EGRESS </td><td>0x00000002 </td><td>Egress Mirroring.  </td></tr>
</table>
<p>Mirror source structure: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__mirror__source__s.html">bcm_mirror_source_s</a> {</div><div class="line">    <a class="code" href="mirror_8h.html#a5c02b1fe456a1f4886992f8fcda5ed87">bcm_mirror_source_type_t</a> <a class="code" href="structbcm__mirror__source__s.html#a921d66084eef63932bb914e78a689af0">type</a>;      <span class="comment">/* Mirror source type. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__source__s.html#a81a27ce50e78368b0d0de1e8767fd32d">flags</a>;                       <span class="comment">/* Mirror source flags only with port</span></div><div class="line"><span class="comment">                                           source type. */</span></div><div class="line">    <a class="code" href="group__types.html#gad7e36a8d90f5765e8ca58770666c0860">bcm_port_t</a> <a class="code" href="structbcm__mirror__source__s.html#a1ce53999f0a069c5ce2e2716f19178ba">port</a>;                    <span class="comment">/* Port/gport id. */</span></div><div class="line">    <a class="code" href="group__types.html#ga630850e9f2bdbeb5e870f6b406b9ebf0">bcm_pkt_trace_event_t</a> <a class="code" href="structbcm__mirror__source__s.html#add786110fa3ad35ca5fb873b17ee1d8f">trace_event</a>;  <span class="comment">/* Trace event. */</span></div><div class="line">    <a class="code" href="group__types.html#gaf54cd2cb3d4253aeba23a1dd2bf78523">bcm_pkt_drop_event_t</a> <a class="code" href="structbcm__mirror__source__s.html#a876cd54c67e56e9eba00afebb6b81e9b">drop_event</a>;    <span class="comment">/* Drop event. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__source__s.html#a92eaf469e55d2126d5580f43e2b51fc3">sample_profile_id</a>;           <span class="comment">/* Sample profile id. */</span></div><div class="line">} <a class="code" href="mirror_8h.html#ad633737c47bbbf3d32a45a164f62c399">bcm_mirror_source_t</a>;</div></div><!-- fragment --><table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a646ac33c3cd1a15f00eca524b0f0cf58" title="Initialize mirror source structure.">bcm_mirror_source_t_init(bcm_mirror_source_t* source)</a>  </td><td>Initialize mirror source structure.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a1c8ad168226cdda6ec687f5a71deb9a0" title="Add a mirror destination to a mirror source.">bcm_mirror_source_dest_add(int unit, bcm_mirror_source_t* source, bcm_gport_t mirror_dest_id)</a>  </td><td>Add a mirror destination to a mirror source.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#ab42f0ee34b795a1970bc80a4d06a7e45" title="Delete a mirror destination from a mirror source.">bcm_mirror_source_dest_delete(int unit, bcm_mirror_source_t* source, bcm_gport_t mirror_dest_id)</a>  </td><td>Delete a mirror destination from a mirror source.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a55f05a9e8a43509548e7473ca89b5907" title="Delete all mirror destinations applied on a mirror source.">bcm_mirror_source_dest_delete_all(int unit, bcm_mirror_source_t* source)</a>  </td><td>Delete all mirror destinations applied on a mirror source.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#aa4bef9e875cb7e66689c7e733e8a9ef6" title="Get all mirror destinations applied on a mirror source.">bcm_mirror_source_dest_get_all(int unit, bcm_mirror_source_t* source, int array_size, bcm_gport_t* mirror_dest, int* count)</a>  </td><td>Get all mirror destinations applied on a mirror source.   </td></tr>
</table>
<p>Mirror statistics object structure: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__mirror__stat__object__s.html">bcm_mirror_stat_object_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__mirror__stat__object__s.html#a8149fa809ff3793a4a83878699ca39fb">source_flags</a>;        <span class="comment">/* Mirror source flags. */</span></div><div class="line">    <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> <a class="code" href="structbcm__mirror__stat__object__s.html#afb6d222f683125c42bcad04617e4f35e">mirror_dest_id</a>; <span class="comment">/* Mirror destination id. */</span></div><div class="line">} <a class="code" href="mirror_8h.html#a80a45a19009e4d720f3203afed0e038c">bcm_mirror_stat_object_t</a>;</div></div><!-- fragment --><p>Mirror statistics type enum: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="mirror_8h.html#a35af9a486aeb6f6591a8ace042a738b2">bcm_mirror_stat_e</a> {</div><div class="line">    <a class="code" href="mirror_8h.html#a35af9a486aeb6f6591a8ace042a738b2a0c17e49b13f9118ba227436011582ad2">bcmMirrorStatPackets</a> = 0,   <span class="comment">/* Packet statistics. */</span></div><div class="line">    <a class="code" href="mirror_8h.html#a35af9a486aeb6f6591a8ace042a738b2a6e8c406f2f48032abfbf26085fb21cbc">bcmMirrorStatCount</a> = 1      <span class="comment">/* Max value defined for this enum. */</span></div><div class="line">} <a class="code" href="mirror_8h.html#a1291439d86afc90c60e2e50b7a172fe0">bcm_mirror_stat_t</a>;</div></div><!-- fragment --><table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="mirror_8h.html#a269280005350e444cffe2e40db79bb12" title="Initialize mirror statistics object structure.">bcm_mirror_stat_object_t_init(bcm_mirror_stat_object_t* object)</a>  </td><td>Initialize mirror statistics object structure.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#ae0f454d8e3ae0bdd8c33dbbde6784585" title="Get statistics counter for specific mirror statistics object and type.">bcm_mirror_stat_get(int unit, bcm_mirror_stat_object_t* object, bcm_mirror_stat_t type, uint64* value)</a>  </td><td>Get statistics counter for specific mirror statistics object and type.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#af70b2cf3bd31c90511a574e9c1f59cdb" title="Get statistics counter for specific mirror statistics object and type.">bcm_mirror_stat_sync_get(int unit, bcm_mirror_stat_object_t* object, bcm_mirror_stat_t type, uint64* value)</a>  </td><td>Get statistics counter for specific mirror statistics object and type in sync mode.   </td></tr>
<tr>
<td><a class="el" href="mirror_8h.html#acbd7b6f9dd33586dcb7423d40f2c0610" title="Set statistics counter for specific mirror statistics object and type.">bcm_mirror_stat_set(int unit, bcm_mirror_stat_object_t* object, bcm_mirror_stat_t type, uint64 value)</a>  </td><td>Set statistics counter for specific mirror statistics object and type.   </td></tr>
</table>
<h1><a class="anchor" id="mtp_design_xgs"></a>
XGS-specific details</h1>
<p>This section summarizes the state of Multiple Mirror-to-port mirroring support of Broadcom BCM56nnn series devices in SDK 6. Other devices architectures (BCM53nnn, BCM88nnn, etc.) are not addressed. It is assumed that the reader is familiar with XGS mirroring from the hardware point of view.</p>
<p><a class="anchor" id="mtp_terminology"></a></p><a class="anchor" id=""></a>
<table class="doxtable">
<caption>Terminology</caption>
<tr>
<td>MTP </td><td>"Mirror To Port" the destination port of mirrored traffic  </td></tr>
<tr>
<td>XGS I </td><td>Devices prior to BCM56504  </td></tr>
<tr>
<td>XGS III </td><td>BCM56504-BCM56800 series of devices  </td></tr>
<tr>
<td>XGS IV </td><td>BCM56624 and later  </td></tr>
<tr>
<td>Firebolt </td><td>BCM56504  </td></tr>
<tr>
<td>Draco </td><td>BCM5690  </td></tr>
<tr>
<td>FP </td><td>"Field Processor"  </td></tr>
</table>
<h1><a class="anchor" id="mtp_overview"></a>
Overview</h1>
<p>XGS III devices and XGS IV devices prior to BCM56840 support two mirroring modes: undirected mirroring, also known as "Draco style
mirroring" or XGS 1 mirroring, and directed mirroring, also known as "Firebolt style mirroring" or XGS III mirroring. XGS devices starting with BCM56840 only support directed mirroring.</p>
<p>Undirected mirroring only supports one MTP per device; all ingress and egress mirrored traffic can only go to one port on a device.</p>
<p>Directed mirroring may support multiple MTPs; how many MTPs in total, and how many simultaneous MTPs are supported for a given mirroring feature depends on the device and its specific mirroring configuration.</p>
<p>The directed mirroring architecture has evolved from supporting only one MTP per ingress frame starting with BCM56504, to two MTPs per ingress frame starting with BCM56620, and to up to four MTPs per ingress frame, starting with BCM56340. MTP selection flexibility has similarly evolved, along with different criteria to select which frames to mirror.</p>
<p>Supporting mirroring on XGS devices generally involves trade-offs between complexity, flexibility and fidelity (how close MTP traffic resembles the frames being mirrored). When there is a choice, SDK software tends to favor simplicity and fidelity over complexity and flexibility. Achieving high mirroring fidelity becomes challenging when ports become congested, when frames are modified before egress, or with non-unicast traffic. Apart from reduced fidelity due to port congestion, mirroring unicast ingress traffic is generally not problematic.</p>
<h1><a class="anchor" id="mtp_programming"></a>
Mirror Programming</h1>
<p>Mirror programming involves three basic steps:</p>
<ul>
<li>1) Configure the mirroring subsystem</li>
<li>2) Create mirror destinations</li>
<li>3) Attach a mirror destination to some resource</li>
</ul>
<p>There are, of course, similar operations to undo each of the three steps above.</p>
<p>Programming simple mirroring operations, for example, mirroring a set of ports to a single MTP, are generally the same across all XGS devices families. As more mirroring features of a particular device family are used, the programming necessarily becomes more complex, and, in some cases, it may be helpful to have an understanding of a device family mirroring architecture.</p>
<h1><a class="anchor" id="mtp_xgs_3"></a>
XGS III Mirroring</h1>
<p>The XGS III mirroring hardware architecture allows up to four ingress MTPs and four egress MTPs per device and a single MTP per ingress frame. Port and FP allow for ingress and egress mirroring to one MTP.</p>
<p>All mirroring decisions are made in the ingress pipeline. If a port is ingress mirrored, then a copy of the ingressing frame, whether unicast or non-unicast, is duplicated on the MTP associated with the ingress port. If a port is egress mirrored, the MTP will depend on if the ingressing frame is unicast or non-unicast.</p>
<p>Egress mirrored unicast frames are mirrored to the MTP associated with the egress port. Egress mirrored non-unicast frames are mirrored to an MTP based on the ingress port. Note the difference in how the MTP is selected depending on whether the frame is unicast or not. Because there is only a single MTP associated with each ingress port, and because there may be multiple egress ports associated with the ingress of a non-unicast frame, releases since SDK 6.2.1 restrict the number of egress MTPs to one. Previous SDK releases had no such restriction, but the behavior of mirrored non-unicast traffic was anomalous as all non-unicast traffic would be directed to only one egress MTP, regardless of which egress port such non-unicast traffic would ultimately egress from. Egress mirrored frames are copies of the frame as ingressed, so any modifications made to a frame at egress, such as VLAN tag stripping or modification, L3 TTL decrements, etc. are not seen at the MTP.</p>
<p>To improve fidelity in the presence of non-unicast traffic, SDK software allows only one egress MTP is per device. This is less than what the hardware allows, but improves the fidelity of the mirrored traffic, particularly with non-unicast traffic - which includes flooded unicast traffic.</p>
<p>Mirroring can be enabled via the Port, FP, or L2 software modules.</p>
<p>XGS III mirror programming, where the architecture allows only one copy of a frame to egress an MTP, is the most straightforward, and presents little interaction between the different modules that can mirror. As noted above, egress mirroring encounters more limitations than ingress mirroring, but this presents itself as more of a capacity limitation, not a programming limitation. If both the port and FP module select the same frame for ingress or egress mirroring, the FP module mirror decision takes precedence.</p>
<h1><a class="anchor" id="xgs_4_3"></a>
XGS IV Devices supporting XGS III mirroring (IV+III)</h1>
<p>Early XGS IV devices (BCM56620 and related devices) support XGS III mirroring, with the added feature of specifying up to two MTPs per ingress frame. This allows up to two egress MTPs to be allocated per device. This is called XGS IV+III mirroring for the remainder of this document.</p>
<p>Although L2 Mirroring is supported in hardware via the L2 table, software does not support this feature due to the introduction of multiple egress MTPs.</p>
<p>XGS IV+III mirroring, while allowing more egress MTPs, also presents more configuration challenges when using multiple MTPs. When using only one MTP, XGS IV+III mirroring is logically the same as XGS III mirroring.</p>
<p>Mirror destinations are added to ports and FP actions one at a time. If both the port and FP module select the same frame for ingress or egress mirroring, the FP module mirror decision takes precedence. Port and FP actions have two "slots" for each MTP added, and each slot in turns points to one of four MTPs. These mirror slots are ordered such that there is a first and second slot, and destinations are added to the first free slot. This aspect of the mirroring hardware architecture is usually transparent to the application, however, certain orders of mirroring operations between port and field modules can expose this architectural feature in surprising ways.</p>
<p>Consider, for example, the following mirror configuration:</p>
<ul>
<li>1) port ge0 mirrors to ge23 and ge24</li>
<li>2) port ge1 mirrors to ge24 and ge23</li>
<li>3) FP qualifies on ge1 and mirrors to ge23</li>
</ul>
<p>Frames received on ge0 will be mirrored to ge23 and ge24, as programmed. Frames received on ge1 however, will have two copies of the ingressing frame mirrored on ge23, not on ge23 and ge24 as may be expected. Why? Because, from configuration line (2) port ge1 MTP slot 1 points to ge24, port ge1 MTP slot 2 points to ge23 and from configuration line (3) FP mirror action slot 1 points to ge23. All mirror resource slot 1 entries are resolved, in this case in favor of the mirror MTP ge23, and the mirror resource slot 2 entries are resolved, which only port ge1 has configured from line (2). One frame on ge23 is a result of the FP action on slot 1 and one frame is a result of the ge1 port mirror on slot 2.</p>
<h1><a class="anchor" id="xgs_4"></a>
XGS IV Mirroring</h1>
<p>XGS IV devices starting with BCM56634 introduced a "flexible
mirroring" architecture, with up to four MTPs per ingress frame, 4 MTPs per device shared between ingress and egress, and, on some devices, true egress mirroring. In other respects, it is similar to XGS III mirroring.</p>
<p>True egress mirrored frames are copies of the frame as egressed, so any modifications made to a frame at egress, such as VLAN tag stripping or modification, L3 TTL decrements, etc. are seen at the MTP, in contrast to regular ingress directed egress mirroring, where the egress modifications are not seen.</p>
<p>Note that true egress mirroring is independent of ingress directed XGS III style egress mirroring; port egress mirroring can select one or the other, but not both simultaneously for any given port. Not all devices based on the XGS IV mirroring architecture support true egress mirroring; for example, BCM56440 and BCM56840 do not support this feature.</p>
<p>Depending on specific device configuration, True Egress Mirroring may affect device resources, such as MMU bandwidth, in a manner different than using "ingress directed" egress mirroring, where the trade-off may be between mirror fidelity and MMU bandwidth allocated to other ports. On the other hand, true egress mirroring is not subject to the MTP limitations of XGS III ingress directed egress mirroring, and the true egress mirroring MTPs are allocated independently from the XGS III ingress directed egress mirroring MTPs.</p>
<p>Although L2 Mirroring is supported in some hardware, software does not support this feature. Starting with BCM56840, L2 mirroring is no longer supported via the L2 table.</p>
<p>Similar to XGS IV+III mirroring, mirror destinations are added to ports and FP actions one at a time. If both the port and FP module select the same frame for ingress or egress mirroring, the FP module mirror decision takes precedence. Port and FP actions have four "slots" for each MTP added, and each slot in turns points to one of four MTPs. These mirror slots are ordered such that there is a first, second, third and fourth slot, and destinations are added to the first free slot.</p>
<p>The number of regular (ingress directed) egress MTPs is limited to the number of egress mirror slots configured in order to address the non-unicast egress mirroring situation described in XGS III mirroring above. The number of true egress mirroring MTPs is always four for those devices that support that feature.</p>
<p>To help applications avoid the port/mirror conflict outlined in XGS IV+III mirroring, by default the maximum number of mirror destinations is set to four, and each mirror destination is assigned to a slot. In this way there are no "slot resolution" conflicts. However, this does result in a reduction in the total number of ingress MTPs available.</p>
<p>Applications may overcome this restriction by using the bcmSwitchFlexibleMirrorDestinations switch control. In so using this control, application are now subject to the complexity of potentially managing the slot resolution conflict in XGS IV+III mirroring. This configuration only affects the number of MTPs available for ingress mirroring.</p>
<h1><a class="anchor" id="mtp_port"></a>
Port mirroring</h1>
<p>The bcm_mirror (and related) APIs configure mirroring based frames ingressing or egressing a designated port.</p>
<p>True egress mirroring can be selected on devices that support that feature by specifying BCM_MIRROR_PORT_EGRESS_TRUE instead of BCM_MIRROR_PORT_EGRESS for mirror flags.</p>
<p>Mirror actions for a given port are allocated starting with the first free slot. Mirror actions can be added for each mirror slot available for a given mirroring architecture.</p>
<h1><a class="anchor" id="mtp_fp"></a>
FP Mirroring</h1>
<p>The bcm_field (and related APIs) can qualify on whether a frame is a mirror copy, or specify an ingress or egress mirror action, or cancel a previously requested mirroring action.</p>
<p>True egress mirroring can be selected on devices that support that feature by selecting egress mirroring on the FP Egress (EFP) stage.</p>
<p>Mirror actions for a given entry are allocated starting with the first free slot. Mirror actions can be added for each mirror slot available for a given mirroring architecture.</p>
<h1><a class="anchor" id="mtp_l2"></a>
L2 Mirroring</h1>
<p>On some early XGS III devices, an egress mirror operation can be associated with an L2 entry. Most XGS III devices do not support this feature.</p>
<h1><a class="anchor" id="mtp_ipfix"></a>
IPFIX Mirroring</h1>
<p>Although the SDK has interfaces to support mirroring for configured IPFIX flows, this feature is unsupported.</p>
<h1><a class="anchor" id="mtp_svp"></a>
SVP Mirroring</h1>
<p>Some devices (e.g., BCM56840) can select to mirror frames belonging to system virtual ports, such as a frame ingressing on a specific port with a specific VLAN Identifier.</p>
<h1><a class="anchor" id="mtp_rspan"></a>
RSPAN Mirroring</h1>
<p>XGS III and XGS IV devices support RSPAN mirroring, with the limitation that RSPAN will only use the first configured MTP, and only supports one MTP.</p>
<h1><a class="anchor" id="mtp_support_matrix"></a>
Mirroring Support Matrix</h1>
<p>The support matrix below shows what the SDK software can support for a given architecture and device feature.</p>
<p><a class="anchor" id="mtp_matrix"></a></p><a class="anchor" id=""></a>
<table class="doxtable">
<caption>Mirroring Support Matrix</caption>
<tr>
<th>Family </th><th>MTP </th><th>Port </th><th>FP </th><th>L2 </th><th>SVP  </th></tr>
<tr>
<td>XGS III </td><td>4+1 </td><td>1 </td><td>1 </td><td>1 </td><td>0  </td></tr>
<tr>
<td>XGS IV+III </td><td>4+2 </td><td>2 </td><td>2 </td><td>0 </td><td>0  </td></tr>
<tr>
<td>XGS IV </td><td>4-7 </td><td>4 </td><td>4 </td><td>0 </td><td>0  </td></tr>
<tr>
<td>XGS IV+SVP 4-7 </td><td>4 </td><td>4 </td><td>0 </td><td>4  </td></tr>
</table>
<p>Note For XGS III and XGS IV+III mirroring, the first number is the number of ingress MTPs, and the second is the number of egress MTPs. For XGS IV mirroring, this shows the range of MTPs available, from the minimum of 4 if all mirror slots are ingress or egress mirrored or bcmSwitchFlexibleMirrorDestinations is not enabled, to a maximum of 7 MTPs, with one ingress mirror slot and three egress mirror slots and bcmSwitchFlexibleMirrorDestinations enabled. Devices supporting true egress mirroring will have an additional four MTPs. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<div class="footer-brcm-wrapper">
<table class="footer-brcm">
	<tbody><tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align="left"></td>
		<td class="footer-brcm"><small><b>Proprietary and Confidential &copy; 2019 Broadcom</b></small>
			<div class="footer-brcm">Broadcom Incorporated reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design.
Information furnished by Broadcom Incorporated is believed to be accurate and reliable. However, Broadcom Incorporated does not assume any liability arising
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license
under its patent rights nor the rights of others.
			</div>
		</td>
	</tr>
</tbody></table>
</div>
</body>
</html>
