<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDK API Guide: Link Monitoring and Notification</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css"/>
<link href="tabs_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SDK API Guide
   &#160;<span id="projectnumber">Version 6.5.20</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Link Monitoring and Notification </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The BCM API provides a mechanism to scan the ports, monitoring for link-up and link-down events. This is accomplished using a thread to constantly monitor the PHYs for link status, and then calling user-supplied callbacks.</p>
<p>Most PHYs latch link down events, not permitting the status to change to link up until software has read the link down state. After the register containing the link down state has been read, the PHY may transition to link up. If multiple applications (or threads of execution) are accessing the link status registers in the PHY, only the first application to issue the read is guaranteed to see the link as down. The <a class="el" href="group__port.html#bcm_port_link_status_get">bcm_port_link_status_get</a> API call retrieves the current link status from the linkscan task, and not by reading the PHY itself, allowing multiple applications to recover the current link status without the possibility of missing an event. For this reason, the use of the supplied linkscan is recommended, and link status should always be retrieved using the appropriate API calls and not by inspecting the PHY registers directly.</p>
<p>Although hardware and software link scanning are supported, software link scanning is recommended on StrataXGS and StrataXGS I-based platforms. Hardware link scanning requires the correct mapping of physical port numbers PHY's MIIM addresses.On XGS3 devices and devices belonging to later generations that have the remapping hardware, it will be programmed correctly, based on the port information. On XGS1 and XGS2 devices that do not have this hardware, the requirement is for the external PHYs to have MIIM addresses that are equal the physical port number plus 1 Hardware linkscan is interrupt driven and reduces the latency before software sees link changes. However, it must be disabled and re-enabled on each normal software MDIO access, significantly slowing down these accesses. Link scanning works with the <a class="el" href="group__port.html#bcm_port_update">bcm_port_update</a> API function. It calls the function on link-up and link-down events, to configure the MAC to operate properly with the current PHY mode, which includes programming the MAC to match autonegotiated settings. When using linkscan, users of the BCM library should not call bcm_port_update. The linkscan process ensures that user supplied callbacks are called once for each link-up and link-down event recognized on each port.</p>
<p>The link status change callbacks is triggered by a change in the link state, whether it is caused by the PHY's link status or by explicit port enable/disable. That is,</p>
<p>Enabled port - Link state callbacks reflect the PHY state (or remote fault, or LAG failover ..). Disabled port - No link callbacks due to PHY state, since it is not in use Enabled port is disabled - Link down callback Disabled port is enabled - Link up callback (or remote fault, or LAG failover..).</p>
<h1><a class="anchor" id="linkscan_data_types"></a>
Linkscan Data Types</h1>
<ul>
<li>BCM_LINKSCAN_INTERVAL_DEFAULT(250000 usec) is the default interval value for linkscan thread when bcm_linkscan_interval is not set in config.bcm.</li>
</ul>
<h1><a class="anchor" id="linkscan_api"></a>
Linkscan APIs</h1>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="link_8h.html#ad44755b871893ca23722b2a081a5656c" title="Initialize the link scanning subsystem.">bcm_linkscan_init(int unit)</a>  </td><td>Initialize the link scanning subsystem.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#a51af2711dea0d82c4d6fa2de6b4aae87" title="Get or set the link scanning mode for a port.">bcm_linkscan_mode_set(int unit, bcm_port_t port, int mode)</a>  </td><td>Get or set the link scanning mode for a port.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#a3d4b2660c02dc33c47aa2c19ed9f3573" title="Get or set the link scanning mode for a port.">bcm_linkscan_mode_set_pbm(int unit, bcm_pbmp_t pbm, int mode)</a>  </td><td>Get or set the link scanning mode for a port.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#afc8c5d004c26cf41c2d7b81ce9f1344c" title="Get or set the link scanning mode for a port.">bcm_linkscan_mode_get(int unit, bcm_port_t port, int* mode)</a>  </td><td>Get or set the link scanning mode for a port.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#a95c0599afeaa166d75ea05f73575edf8" title="Enable and disable link scanning or set the polling interval.">bcm_linkscan_enable_set(int unit, int us)</a>  </td><td>Enable and disable link scanning or set the polling interval.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#a1cd6496b8ef094bc859b94a7d9f5c3df" title="Enable and disable link scanning or set the polling interval.">bcm_linkscan_enable_get(int unit, int* us)</a>  </td><td>Enable and disable link scanning or set the polling interval.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#ae10bdb7ad15123133ed51d96f485db75" title="Retrieve if linkscan managing a specified port.">bcm_linkscan_enable_port_get(int unit, bcm_port_t port)</a>  </td><td>Retrieve if linkscan managing a specified port.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#abedbc1c3777c473d3d88ed79d086c092">bcm_linkscan_handler_t()</a>  </td><td>Link notification handler prototype.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#a50020035f7d926e845299a48ab9f708c" title="Register and unregister link notification callouts.">bcm_linkscan_register(int unit, bcm_linkscan_handler_t f)</a>  </td><td>Register and unregister link notification callouts.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#af717cdd084b31ff7bfbb1f2275a0237e" title="Register and unregister link notification callouts.">bcm_linkscan_unregister(int unit, bcm_linkscan_handler_t f)</a>  </td><td>Register and unregister link notification callouts.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#a6b9912462e0ea2a4a6db200a1bea8acd">bcm_linkscan_port_handler_t()</a>  </td><td>Link state handler prototype.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#afbc4b939c7cd4ce91ebd6689353bb050" title="Register and unregister link status callout.">bcm_linkscan_port_register(int unit, bcm_port_t port, bcm_linkscan_port_handler_t f)</a>  </td><td>Register and unregister link status callout.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#a272531149e10f9ac790b548caae1ef32" title="Register and unregister link status callout.">bcm_linkscan_port_unregister(int unit, bcm_port_t port, bcm_linkscan_port_handler_t f)</a>  </td><td>Register and unregister link status callout.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#ab91619c4fe5d2e70fb795aeabcbbbd16" title="Terminate linkscan on the specified unit.">bcm_linkscan_detach(int unit)</a>  </td><td>Terminate linkscan on the specified unit.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#a6a8e387b69af2822b3f7849cb7c8b078" title="Wait for a set of links to recognize link up.">bcm_link_wait(int unit, bcm_pbmp_t* pbm, int us)</a>  </td><td>Wait for a set of links to recognize link up.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#ae0f931c882584fdbbed7833a4e69de6b" title="Force a transient link down event on a port.">bcm_link_change(int unit, bcm_pbmp_t pbmp)</a>  </td><td>Force a transient link down event on a port.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#a92f69480772370da348fe754a56d2c8a" title="Check for a change in link status on each link.">bcm_linkscan_update(int unit, bcm_pbmp_t pbm)</a>  </td><td>Check for a change in link status on each link.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#aaec25ea5ca0cc60faefeefac10a51386" title="Display information about linkscan callbacks.">bcm_linkscan_dump(int unit)</a>  </td><td>Display information about linkscan callbacks.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#ad0f45f0e3a98e86778c8c80552562978" title="Get/set the link event from/to Linkscan function.">bcm_linkscan_trigger_event_set(int unit, bcm_port_t port, uint32 flags, bcm_linkscan_trigger_event_t trigger_event, int enable)</a>  </td><td>Get/set the link event from/to Linkscan function.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#a20ebefb6edb920b455bd1c87382adf58" title="Get/set the link event from/to Linkscan function.">bcm_linkscan_trigger_event_get(int unit, bcm_port_t port, uint32 flags, bcm_linkscan_trigger_event_t trigger_event, int* enable)</a>  </td><td>Get/set the link event from/to Linkscan function.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#aaa22958f8a6f9ea3af8d5c6e90dbd61a" title="Get/set the override link state for the specified port.">bcm_linkscan_override_link_state_set(int unit, bcm_port_t port, int link)</a>  </td><td>Get/set the override link state for the specified port.   </td></tr>
<tr>
<td><a class="el" href="link_8h.html#a284790f5480b6635b2d6e72b929e4750" title="Get/set the override link state for the specified port.">bcm_linkscan_override_link_state_get(int unit, bcm_port_t port, int* link)</a>  </td><td>Get/set the override link state for the specified port.   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<div class="footer-brcm-wrapper">
<table class="footer-brcm">
	<tbody><tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align="left"></td>
		<td class="footer-brcm"><small><b>Proprietary and Confidential &copy; 2020 Broadcom</b></small>
			<div class="footer-brcm">Broadcom Incorporated reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design.
Information furnished by Broadcom Incorporated is believed to be accurate and reliable. However, Broadcom Incorporated does not assume any liability arising
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license
under its patent rights nor the rights of others.
			</div>
		</td>
	</tr>
</tbody></table>
</div>
</body>
</html>
