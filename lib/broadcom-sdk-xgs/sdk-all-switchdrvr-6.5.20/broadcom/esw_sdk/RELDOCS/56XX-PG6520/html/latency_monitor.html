<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDK API Guide: Latency Monitor</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css"/>
<link href="tabs_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SDK API Guide
   &#160;<span id="projectnumber">Version 6.5.20</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Latency Monitor </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The feature allows user to obtain latency distribution histogram per queue/queue-group for a given pairs of ports or port-group. User can use the latency measurements to identify which paths are impacted by latency issues, for example from uplink port to downlink port.</p>
<h1><a class="anchor" id="Latency_Monitor_overview"></a>
Latency Monitor Overview</h1>
<p>Latency at a switch node is a good proxy for congestion experienced at the node. The Latency Distribution Monitoring feature marks every ingress and egress packets with a timestamp value. The latency for each packet is computed by comparing the ingress with the egress timestamp. Operator can configure buckets to categorize the latency for each packet. Each bucket has a counter that counts the number of packets experiencing latency that is in the bounds for that bucket.</p>
<p>A monitor generates a set of histograms for every time step period (one per each queue). A histogram is nothing but a set of counters where each counter corresponds to a bucket. A histogram can have maximum of 8 buckets and each bucket is defined with upper and lower latency limits. The counter corresponding to the bucket will be incremented when a packet within that latency limit is detected. Set of histograms for a given port or port range is a histogram set. For example if the system has 12 queues for a port and if all the 12 queues are monitored then the set of 12 histograms is one histogram set.</p>
<p>The Latency Monitor can operate in either TIME_SERIES mode or ACCRUE mode, explained below.</p>
<p>TIME_SERIES Mode: In this mode, the time series information is preserved by copying histograms counters in to a software ring buffer. Here, the user application specifies the number of 'histogram set count' in the Software Ring Buffer. SDK allocates the memory for the Software Ring Buffer based on the requested 'histogram set count'. User application can optionally register a call back handler. The SDK calls the call back handler every time when there is update of counter data in the Software Ring Buffer. The call back function is passed with base address and the next write pointer to the Software Ring Buffer. Here the user application is the consumer of the SW ring buffer and SDK is the producer. It is the responsibility of the user application to read the counter info from the Software Ring Buffer before it wraps around. The wrap around time for the SW Ring Buffer is 'Time Step' value times the 'histogram set count'.</p>
<p>The Software Ring Buffer is 64 bit wide and the entries are interpreted by user application as below: </p><pre class="fragment">Bit Field 00:27 is Packet Counter (28 Bit wide)

Bit field 28:63 is Byte Counter   (36 Bit wide)
</pre><p>ACCRUE Mode (Default mode): In this mode, the time series information is not retained as the counter values from each histogram set are accumulated into one histogram set. Each histogram within this accumulated set is a set of 64 bit wide counters for a given monitor ID and queue ID. In this mode SDK does the accumulation of counters (one each for packet counter and byte counter).</p>
<h1><a class="anchor" id="latency_monitor_data_types"></a>
Latency Monitor Data Types</h1>
<ul>
<li>The bcm_latency_monitor_mode_t enum describes a Latency Monitor operation mode.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="group__latency__monitor.html#ga8e51bdc6e80d7b48e95de746d5b993db">bcm_latency_monitor_mode_e</a> {</div><div class="line">    <a class="code" href="group__latency__monitor.html#gga8e51bdc6e80d7b48e95de746d5b993dba5ec56bab73aa59104e6fd59a1dd6083b">bcmLatencyMonitorAccrueMode</a>         <span class="comment">/* Histogram data is accumulated per queue per bucket basis */</span></div><div class="line">    <a class="code" href="group__latency__monitor.html#gga8e51bdc6e80d7b48e95de746d5b993dba47b9b167ead38bcaa2a61bc2f5d14665">bcmLatencyMonitorTimeSeriesMode</a>,    <span class="comment">/* Histogram data with time series informations */</span></div><div class="line">} <a class="code" href="group__latency__monitor.html#ga77e55b3400b9ac6658af53e743a1a5cb">bcm_latency_monitor_mode_t</a>;</div></div><!-- fragment --><ul>
<li>The bcm_latency_monitor_count_mode_t enum describes a Latency Monitor count mode (cut-through only or store-and-Forward only or count All packets).</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="group__latency__monitor.html#ga77b29b1b61f281cd280d23dcaa40d96b">bcm_latency_monitor_count_mode_e</a> {</div><div class="line">    <a class="code" href="group__latency__monitor.html#gga77b29b1b61f281cd280d23dcaa40d96ba138707c1fd61ad119a2f2333698ee27d">bcmLatencyMonitorCutThrough</a>,         <span class="comment">/* Count only cut through packets. */</span></div><div class="line">    <a class="code" href="group__latency__monitor.html#gga77b29b1b61f281cd280d23dcaa40d96ba4e501f6482351e9efe93f8d3ddd02f31">bcmLatencyMonitorStoreAndForward</a>,    <span class="comment">/* Count only store and forward packets. */</span></div><div class="line">    <a class="code" href="group__latency__monitor.html#gga77b29b1b61f281cd280d23dcaa40d96ba6b1cc26bb175c467184527d310d4967e">bcmLatencyMonitorCountAll</a>            <span class="comment">/* Count all types of packets. */</span></div><div class="line">} <a class="code" href="group__latency__monitor.html#ga24c77924f3b03c8b8ffa2593e9cd8459">bcm_latency_monitor_count_mode_t</a>;</div></div><!-- fragment --><ul>
<li>The bcm_latency_monitor_status_t enum describes a Latency Monitor status.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="group__latency__monitor.html#gaea3d13ba7e36ac3a4dc840a2b019abd7">bcm_latency_monitor_status_e</a> {</div><div class="line">    <a class="code" href="group__latency__monitor.html#ggaea3d13ba7e36ac3a4dc840a2b019abd7a3e0454bdcf8cee87b75f3553fc76e3c5">bcmLatencyMonitorStatusUninit</a>,         <span class="comment">/* Latency Monitor is in Uninitialized state. */</span></div><div class="line">    <a class="code" href="group__latency__monitor.html#ggaea3d13ba7e36ac3a4dc840a2b019abd7aacbe56109060edc5e6b4562825c32f11">bcmLatencyMonitorStatusIdle</a>,           <span class="comment">/* Latency Monitor is in Idle state. */</span></div><div class="line">    <a class="code" href="group__latency__monitor.html#ggaea3d13ba7e36ac3a4dc840a2b019abd7a30542dd77df6afb8e15f08ed52cb732f">bcmLatencyMonitorStatusRunning</a>,        <span class="comment">/* Latency Monitor is in Running state. */</span></div><div class="line">    <a class="code" href="group__latency__monitor.html#ggaea3d13ba7e36ac3a4dc840a2b019abd7aaa6a1033fb9e208d27117032709aeb88">bcmLatencyMonitorStatusError</a>           <span class="comment">/* Latency Monitor is in Faulty state. */</span></div><div class="line">} <a class="code" href="group__latency__monitor.html#ga2c0e0ce766670d7a3b16a645ddd4f982">bcm_latency_monitor_status_t</a>;</div></div><!-- fragment --><ul>
<li>User application call back function on update of counter info in software ring buffer (Valid in TIME_SERIES mode only).</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> int (*<a class="code" href="group__latency__monitor.html#gab5f27bc7020f478076f9aef3f741efc8">bcm_latency_monitor_cb</a>)(</div><div class="line">    <span class="keywordtype">int</span> unit,</div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> monitor_id,                   <span class="comment">/* Monitor ID */</span></div><div class="line">    <a class="code" href="group__latency__monitor.html#ga2c0e0ce766670d7a3b16a645ddd4f982">bcm_latency_monitor_status_t</a> monitor_status; <span class="comment">/* Monitor status */</span></div><div class="line">    <span class="keywordtype">void</span> *sw_buf_addr,                  <span class="comment">/* Base address of 64 bits wide (Bit Field 0:27 Packet Counter,</span></div><div class="line"><span class="comment">                                           Bit field 28:63 is Byte Counter) software ring buffer */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> sw_buf_size,                 <span class="comment">/* Size of Software ring buffer in terms of 64 bit width. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> sw_buf_wr_idx,               <span class="comment">/* Index in to the software ring buffer pointing to last counter</span></div><div class="line"><span class="comment">                                           write operation. */</span></div><div class="line">    );</div></div><!-- fragment --><ul>
<li>The bcm_latency_monitor_config_t structure describes Latency Monitor configuration.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__latency__monitor__config__s.html">bcm_latency_monitor_config_s</a> {</div><div class="line">    <a class="code" href="group__latency__monitor.html#ga77e55b3400b9ac6658af53e743a1a5cb">bcm_latency_monitor_mode_t</a> <a class="code" href="structbcm__latency__monitor__config__s.html#a4a02816353b88f6531d5013408ac08ad">mode</a>;    <span class="comment">/* Monitor operation mode. */</span></div><div class="line">    <a class="code" href="group__types.html#ga6e9f69e8948f73d9da295756c2ce581d">bcm_pbmp_t</a> <a class="code" href="structbcm__latency__monitor__config__s.html#abe290663945549f2c738c8d5af639535">src_pbmp</a>;                <span class="comment">/* Ingress Port Bit Map */</span></div><div class="line">    <a class="code" href="group__types.html#ga6e9f69e8948f73d9da295756c2ce581d">bcm_pbmp_t</a> <a class="code" href="structbcm__latency__monitor__config__s.html#ac1182317f915f3527988a9b84d89e815">dest_pbmp</a>;               <span class="comment">/* Egress Port Bit Map */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__latency__monitor__config__s.html#a9bd82a35c37f541d7be67318f57d0294">time_step</a>;                   <span class="comment">/* Time series step value in Micro Sec.</span></div><div class="line"><span class="comment">                                           (Min 100 ms). */</span></div><div class="line">    <a class="code" href="group__latency__monitor.html#ga24c77924f3b03c8b8ffa2593e9cd8459">bcm_latency_monitor_count_mode_t</a> <a class="code" href="structbcm__latency__monitor__config__s.html#a8af4fac0999f1eb9194e8030dde64ca5">count_mode</a>; <span class="comment">/* cut-through or store-and-Forward or</span></div><div class="line"><span class="comment">                                           Count All */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__latency__monitor__config__s.html#a8c51f70d1947e755b58355e5b2741469">histogram_set_count</a>;         <span class="comment">/* Max number of histogram sets to</span></div><div class="line"><span class="comment">                                           accommodate in Software Ring Buffer</span></div><div class="line"><span class="comment">                                           (Minimum is 10). */</span></div><div class="line">    <a class="code" href="group__latency__monitor.html#gab5f27bc7020f478076f9aef3f741efc8">bcm_latency_monitor_cb</a> <a class="code" href="structbcm__latency__monitor__config__s.html#ab7b1b44d10a3dbae4321ac66f0c50f18">cb</a>;          <span class="comment">/* User callback function on</span></div><div class="line"><span class="comment">                                           availability of counter info in the</span></div><div class="line"><span class="comment">                                           software ring buffer. */</span></div><div class="line">} <a class="code" href="group__latency__monitor.html#ga090fe85e9637e5c794f7b1e5ec67e7e3">bcm_latency_monitor_config_t</a>;</div></div><!-- fragment --><ul>
<li>The bcm_latency_monitor_cosq_info_t structure describes a per queue latency limit configuration.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__latency__monitor__cosq__info__s.html">bcm_latency_monitor_cosq_info_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__latency__monitor__cosq__info__s.html#a22c528be58b5163f79ec558aaefa90a1">bucket_count</a>;         <span class="comment">/* Number of histogram buckets for a given cosq. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__latency__monitor__cosq__info__s.html#abed2ecebed26a08ae7881c612ed00ae7">latency_index_array</a>[BCM_MAX_HISTOGRAM_BUCKET_COUNT]; <span class="comment">/* Array of indexes in to the latency</span></div><div class="line"><span class="comment">                                   limit table. The indexed value is the upper latency limit for the</span></div><div class="line"><span class="comment">                                   corresponding bucket (Require input values sorted in ascending order). */</span></div><div class="line">} <a class="code" href="group__latency__monitor.html#ga4e86d9db5640a04d7bab5350277ddc27">bcm_latency_monitor_cosq_info_t</a>;</div></div><!-- fragment --><ul>
<li>The bcm_latency_monitor_histogram_t structure describes a Histogram for a given cosq id.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__latency__monitor__histogram__s.html">bcm_latency_monitor_histogram_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__latency__monitor__histogram__s.html#a1a0e9b906b5de98a4572887da8441336">histogram_size</a>;   <span class="comment">/* Number of histogram counters for a given cosq. */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#aa3ad64cf41ec3a042bd92550cc6ed308">uint64</a> <a class="code" href="structbcm__latency__monitor__histogram__s.html#a0962ee06a7ad984d34e0e0bb1d54ac3a">histogram</a>[BCM_MAX_HISTOGRAM_BUCKET_COUNT]; <span class="comment">/* Array of histogram counters */</span></div><div class="line">} <a class="code" href="group__latency__monitor.html#ga58bdc9eafa7a5a1d6b17a3eba689d292">bcm_latency_monitor_histogram_t</a>;</div></div><!-- fragment --><ul>
<li>The bcm_latency_monitor_info_t structure describes Latency Monitor status informations.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__latency__monitor__info__s.html">bcm_latency_monitor_info_s</a> {</div><div class="line">    <a class="code" href="group__latency__monitor.html#ga2c0e0ce766670d7a3b16a645ddd4f982">bcm_latency_monitor_status_t</a> <a class="code" href="structbcm__latency__monitor__info__s.html#a121ced15d96e6171af20cc91751fee58">monitor_status</a>; <span class="comment">/* Monitor status */</span></div><div class="line">    <span class="keywordtype">void</span> *<a class="code" href="structbcm__latency__monitor__info__s.html#abd751dd9fb08b0f26f447cd76b3289f7">sw_buf_addr</a>,                  <span class="comment">/* Base address of 64 bits wide (Bit Field 0:27 Packet Counter,</span></div><div class="line"><span class="comment">                                           Bit field 28:63 is Byte Counter) software ring buffer</span></div><div class="line"><span class="comment">                                           (Valid in Time Series Mode only). */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__latency__monitor__info__s.html#a4565831b9f13723b6f06955a11c08a64">sw_buf_size</a>;                 <span class="comment">/* Size of Software ring buffer in terms</span></div><div class="line"><span class="comment">                                           of 64 bit width (Valid in Time Series Mode only). */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__latency__monitor__info__s.html#a2b49dcec3df784b6344c308db0a84bf2">sw_buf_wr_idx</a>;               <span class="comment">/* Index in to the software ring buffer pointing</span></div><div class="line"><span class="comment">                                           to last counter write operation</span></div><div class="line"><span class="comment">                                           (Valid in Time Series Mode only). */</span></div><div class="line">} <a class="code" href="group__latency__monitor.html#gac03abbc30ea63474b28f9048f12f726e">bcm_latency_monitor_info_t</a>;</div></div><!-- fragment --><h1><a class="anchor" id="Latency_Monitor_config_apis"></a>
Latency Monitor Config APIs</h1>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<div class="footer-brcm-wrapper">
<table class="footer-brcm">
	<tbody><tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align="left"></td>
		<td class="footer-brcm"><small><b>Proprietary and Confidential &copy; 2020 Broadcom</b></small>
			<div class="footer-brcm">Broadcom Incorporated reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design.
Information furnished by Broadcom Incorporated is believed to be accurate and reliable. However, Broadcom Incorporated does not assume any liability arising
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license
under its patent rights nor the rights of others.
			</div>
		</td>
	</tr>
</tbody></table>
</div>
</body>
</html>
