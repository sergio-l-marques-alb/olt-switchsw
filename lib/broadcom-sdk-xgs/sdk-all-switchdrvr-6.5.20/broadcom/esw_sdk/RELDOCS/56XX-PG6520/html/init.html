<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDK API Guide: Initialization</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css"/>
<link href="tabs_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SDK API Guide
   &#160;<span id="projectnumber">Version 6.5.20</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Initialization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>System initialization involves the following steps:</p>
<ul>
<li>Identifying the devices in the system.</li>
<li>Creating a connection to each device.</li>
<li>Initializing the device to the point where software may control it.</li>
<li>Attach an identifier to the device so that BCM calls may refer to the device.</li>
</ul>
<p>The first three steps are carried out by layers of software below the BCM layer. See references to the Broadcom Device Enumerator (BDE) in the Platform Guide for more information.</p>
<p>The BCM API provides the functions to attach the device and then to initialize the software resources necessary to control the device and to initialize the device itself. The order of these operations is critical.</p>
<p>The step of attaching an identifier to the device involves the dispatch layer. This layer allows local and remote devices, as well as devices of different architectures to be controlled through the BCM API. See the <a class="el" href="group__init.html#bcm_attach">bcm_attach</a> description for detailed information about dispatch tables and how devices are associated to a particular dispatch driver.</p>
<h2>BCM Initialization</h2>
<p>Locally attached switching devices must be enumerated by the underlying device driver before BCM initialization can occur. For StrataSwitch and StrataXGS switching devices, the underlying device driver is called the SoC layer and is described in the Broadcom Network Switching Platform Guide.</p>
<p>A typical code sequence would resemble the following (error check has been removed for clarity): </p><div class="fragment"><div class="line"><a class="code" href="boot_8h.html#aad099ce70bc3b0e3dd7f428f2c9a1f1a">sal_core_init</a>();</div><div class="line"><span class="keywordflow">for</span> (<span class="comment">/* each unit found through PCI enumeration */</span>) {</div><div class="line">    soc_reset_init(unit);</div><div class="line">    soc_misc_init(unit);</div><div class="line">    soc_mmu_init(unit);</div><div class="line">    soc_l2x_start(unit, 0, L2X_INTERVAL_USEC);</div><div class="line">    <a class="code" href="group__init.html#gaa9516e3bbbd4c154caf0bfd4e2938aff">bcm_attach</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">char</span>* <a class="code" href="stat_8dox.html#a2b1516d21ffe5483777c2bec8029beb4">type</a>, <span class="keywordtype">char</span>* subtype, <span class="keywordtype">int</span> remunit);</div><div class="line">}</div></div><!-- fragment --><p>Remotely attached switching devices are usually attached as part of Broadcom Stacking software callbacks, as described in the Broadcom Network Switching Stacking Guide.</p>
<h1><a class="anchor" id="attach_callback"></a>
Attach Callback</h1>
<p>Applications can register callback routines that are called by <a class="el" href="group__init.html#bcm_attach">bcm_attach</a> before BCM device attachment, and by <a class="el" href="group__init.html#bcm_detach">bcm_detach</a> after BCM device detachment.</p>
<p>Callback routines are register/unregistered with <a class="el" href="group__init.html#bcm_attach_register">bcm_attach_register</a> and <a class="el" href="group__init.html#bcm_attach_unregister">bcm_attach_unregister</a> APIs.</p>
<ul>
<li>Device State Enumeration</li>
</ul>
<p>The enumeration type bcm_device_state_t specifies whether the callback routine is called during a BCM device attach or detach.</p>
<p>When routine is called by <a class="el" href="group__init.html#bcm_attach">bcm_attach</a>, state is bcmDeviceStateAttach, and when called by <a class="el" href="group__init.html#bcm_detach">bcm_detach</a>, state is bcmDeviceStateDetach.</p>
<div class="fragment"><div class="line"><span class="comment">/* Device State. */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="group__init.html#gaa7289fc474c44340e36ccc82a0e2ca74">bcm_device_state_e</a> {</div><div class="line">    <a class="code" href="group__init.html#ggaa7289fc474c44340e36ccc82a0e2ca74a85b6bb54cb87da30faa0b782a4480553">bcmDeviceStateAttach</a>,   <span class="comment">/* Device attach. */</span></div><div class="line">    <a class="code" href="group__init.html#ggaa7289fc474c44340e36ccc82a0e2ca74a8faaca1a00c08e03e87971ec53aabb0a">bcmDeviceStateDetach</a>    <span class="comment">/* Device detach. */</span></div><div class="line">} <a class="code" href="group__init.html#gaa78292f5a2aecf53ab86b6a6338ecf49">bcm_device_state_t</a>;</div></div><!-- fragment --><p><a class="anchor" id="bcm_attach_info_t"></a></p><ul>
<li>Attach Detach Information Structure</li>
</ul>
<p>The attach/detach information structure bcm_attach_info_t is passed into the callback routine.</p>
<p>The data members in bcm_attach_info_t are passed exactly as received by <a class="el" href="group__init.html#gaa9516e3bbbd4c154caf0bfd4e2938aff" title="Attach a device as a BCM unit.">bcm_attach()</a>.</p>
<div class="fragment"><div class="line"><span class="comment">/* Attach/detach information. */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__attach__info__s.html">bcm_attach_info_s</a> {</div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__attach__info__s.html#affc6a42f59d0f323874565f3b52fc10f">unit</a>;               <span class="comment">/* Attach/detach unit. */</span></div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structbcm__attach__info__s.html#a763fd8db6bba8fbbbc113ca0d61c47c2">type</a>;       <span class="comment">/* Attach/detach type. */</span></div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structbcm__attach__info__s.html#abb4ae60bbcbce3616fdd7d4238869c91">subtype</a>;    <span class="comment">/* Attach/detach subtype. */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__attach__info__s.html#a57ce3369d44970d384f43f82a04e7214">remunit</a>;            <span class="comment">/* Attach/detach remunit. */</span></div><div class="line">} <a class="code" href="group__init.html#gaa11fecd12f95696d57aa4b925ba93d4b">bcm_attach_info_t</a>;</div></div><!-- fragment --><ul>
<li>Attach Detach Callback Function Prototype</li>
</ul>
<p>Callback function is called during the <a class="el" href="group__init.html#bcm_attach">bcm_attach</a> and <a class="el" href="group__init.html#bcm_detach">bcm_detach</a> APIs. See <a class="el" href="group__init.html#gaa865328bb6cacfd9423b401c493c51a1">bcm_attach_cb_t</a></p>
<div class="fragment"><div class="line"><span class="comment">/* Attach/detach callback */</span></div><div class="line"><span class="keyword">typedef</span> int (*<a class="code" href="group__init.html#gaa865328bb6cacfd9423b401c493c51a1">bcm_attach_cb_t</a>)(<span class="keywordtype">int</span> unit,</div><div class="line">                               <a class="code" href="group__init.html#gaa78292f5a2aecf53ab86b6a6338ecf49">bcm_device_state_t</a> state,</div><div class="line">                               <a class="code" href="structbcm__attach__info__s.html">bcm_attach_info_t</a> *<a class="code" href="l3_8dox.html#a34ea06cff5e4db05f1dd7d2bd44e97bd">info</a>,</div><div class="line">                               <span class="keywordtype">void</span> *<a class="code" href="l3_8dox.html#afc6e325b3b8c838e0a205aa5c1ec69bd">user_data</a>);</div></div><!-- fragment --><h1><a class="anchor" id="detach_retry"></a>
Detach Retry</h1>
<p>Detach may fail if there are current BCM APIs in execution while device architecture dependent detachment is in progress.</p>
<p>Detach needs to detect such conditions and defer detachment until there are no active BCM APIs executing in other threads.</p>
<p>Because completion time is indeterminate and <a class="el" href="group__init.html#bcm_detach">bcm_detach</a> needs to eventually return, there needs to be a way to set an upper time limit on how long to wait before giving up and returning with an error.</p>
<p>The detach timeout is dependent on the following factors:</p>
<ul>
<li>Detach poll interval: Interval of time for detach to wait between checks for BCM APIs in execution.</li>
<li>Number of retries: Number of tries detach checks for BCM APIs in execution before it gives up.</li>
</ul>
<p>See <a class="el" href="group__init.html#bcm_detach_retry_set">bcm_detach_retry_set</a> and <a class="el" href="group__init.html#bcm_detach_retry_get">bcm_detach_retry_get</a> for more information.</p>
<p>The default detach retry time is 5 minutes, with poll_usecs set to 100000 usecs, and num_retries set to 3000. These default values can be overridden during compile time with the following compiler flags, BCM_DETACH_POLL_INTERVAL_USECS_DEFAULT and BCM_DETACH_NUM_RETRIES_DEFAULT.</p>
<ul>
<li>Detach Retry Information Structure</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">/* Detach retry. */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__detach__retry__s.html">bcm_detach_retry_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__detach__retry__s.html#a6f6dee2fc2293f1b0ed2e275a7fa1c41">poll_usecs</a>;  <span class="comment">/* Time poll interval in usecs. */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__detach__retry__s.html#add7f658559ed60832bf4f036f5595fe1">num_retries</a>;    <span class="comment">/* Number of retries. */</span></div><div class="line">} <a class="code" href="group__init.html#gaac2a1f086a42030099ded2379810bfed">bcm_detach_retry_t</a>;</div></div><!-- fragment --><table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__init.html#ga5048ba1f59aff4302df0e2643bd939ee" title="Initialize the BCM software layer for a device.">bcm_init(int unit)</a>  </td><td>Initialize the BCM software layer for a device.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#ga9d5808c90d7058b7eaf3fcc3572f1912" title="Check the return value from system_init() operation.">bcm_init_check(int unit)</a>  </td><td>Check the return value from system_init() operation.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#gac1b0f419a83b64c71b8d119e8a250640" title="Initialize the BCM software layer for a device.">bcm_init_selective(int unit, uint32 flags)</a>  </td><td>Initialize the BCM software layer for a device.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#gaa9516e3bbbd4c154caf0bfd4e2938aff" title="Attach a device as a BCM unit.">bcm_attach(int unit, char* type, char* subtype, int remunit)</a>  </td><td>Attach a device as a BCM unit.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#ga57908486412f87e6c080f904e347d150" title="Attach only tx and rx modules to a device as a BCM unit.">bcm_attach_early_txrx(int unit, char* type, char* subtype, int remunit)</a>  </td><td>Attach only tx and rx modules to a device as a BCM unit.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#ga6b496cac7007a6fff0bac431bb6542e2" title="Detach a device as a BCM unit.">bcm_detach(int unit)</a>  </td><td>Detach a device as a BCM unit.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#ga1bb715d06eaec47e70bfba7759d9cfad" title="Detach all modules excluding tx and rx from BCM unit.">bcm_detach_late_txrx(int unit)</a>  </td><td>Detach all modules excluding tx and rx from BCM unit.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#ga5286ef3ef50ae590efbdad815bc4a0ad" title="Find a matching BCM unit.">bcm_find(char* type, char* subtype, int remunit)</a>  </td><td>Find a matching BCM unit.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#ga88b9694d7145c886d91335074ca8e8cd" title="Determine if a BCM unit is attached.">bcm_attach_check(int unit)</a>  </td><td>Determine if a BCM unit is attached.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#ga5d34f99c0d9853131cce6e817ebbfd4c" title="Determine the highest BCM unit currently attached.">bcm_attach_max(int* max_units)</a>  </td><td>Determine the highest BCM unit currently attached.   </td></tr>
<tr>
<td><a class="el" href="group__types.html#gaa3a074b45051c028e37fef6377db568f" title="bcm_unit_max">bcm_unit_max(void )</a>  </td><td>Get maximum number of supported units.   </td></tr>
<tr>
<td><a class="el" href="group__types.html#ga663d02b4500672d8ba2daeee824131d3" title="bcm_unit_valid">bcm_unit_valid(int unit)</a>  </td><td>Check if unit is valid a BCM device.   </td></tr>
<tr>
<td><a class="el" href="group__types.html#ga721ceb3ec0c6a86a904685196f994da8" title="bcm_unit_local">bcm_unit_local(int unit)</a>  </td><td>Check if unit is a local BCM device.   </td></tr>
<tr>
<td><a class="el" href="group__types.html#gab21fae7cf7d3cc0aabe32c0c70dee6cd" title="bcm_unit_remote">bcm_unit_remote(int unit)</a>  </td><td>Check if unit is a remote BCM device.   </td></tr>
<tr>
<td><a class="el" href="group__types.html#gabdd856754848fb76c4706301feff3237" title="bcm_unit_remote_unit_get">bcm_unit_remote_unit_get(int unit, int* remunit)</a>  </td><td>Get local unit number for remote unit.   </td></tr>
<tr>
<td><a class="el" href="group__types.html#ga35dfd304dbe707af2667b85e39bc1b2b" title="bcm_unit_subtype_get">bcm_unit_subtype_get(int unit, char* subtype, int maxlen)</a>  </td><td>Get subtype information for a unit.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#ga7845afe9ccea2c8e9030058d416235da" title="Initialize the BCM Information structure.">bcm_info_t_init(bcm_info_t* info)</a>  </td><td>Initialize the BCM Information structure.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#gadc879c0460da3f429f773176aeb0ea4a" title="Get information about a BCM unit.">bcm_info_get(int unit, bcm_info_t* info)</a>  </td><td>Get information about a BCM unit.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#gabab6d862fe0ee016ab7d4bf7df2ac019" title="Check if device is member in group &#39;member_type&#39;.">bcm_device_member_get(int unit, uint32 flags, bcm_device_member_t member_type, int* is_member)</a>  </td><td>Check if device is member in group 'member_type'   </td></tr>
<tr>
<td><a class="el" href="group__init.html#ga00b025d19352c55cb5daa9b782e8655f" title="Initialize a device excluding stacking functionality.">bcm_clear(int unit)</a>  </td><td>Initialize a device excluding stacking functionality.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#ga5ba7cfadbceeaf7c2d8afd2e9164c45c" title="Initialize a BCM Attach Information structure.">bcm_attach_info_t_init(bcm_attach_info_t* info)</a>  </td><td>Initialize a BCM Attach Information structure.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#gaa865328bb6cacfd9423b401c493c51a1">bcm_attach_cb_t()</a>  </td><td>Attach/detach callback function prototype.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#gafc9cee19324776812a51d6f71bfddc2c" title="Register/unregister a callback function to be called before BCM device attachment and after BCM devic...">bcm_attach_register(int unit, bcm_attach_cb_t cb, void* user_data)</a>  </td><td>Register/unregister a callback function to be called before BCM device attachment and after BCM device detachment.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#gab51c00bf4505d8166e9cd52626c32b6a" title="Register/unregister a callback function to be called before BCM device attachment and after BCM devic...">bcm_attach_unregister(int unit, bcm_attach_cb_t cb, void* user_data)</a>  </td><td>Register/unregister a callback function to be called before BCM device attachment and after BCM device detachment.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#ga560ddbe714e4eb644e0f477957a6081e" title="Initialize a BCM Detach Retry structure.">bcm_detach_retry_t_init(bcm_detach_retry_t* retry)</a>  </td><td>Initialize a BCM Detach Retry structure.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#gac4371c5e0f5fbbd43791ba3ca3d66d9a" title="Set/get the poll interval and number of retries before detach exits.">bcm_detach_retry_set(int unit, bcm_detach_retry_t* retry)</a>  </td><td>Set/get the poll interval and number of retries before detach exits.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#ga01f5890c0dd71f84d4ce2bccbb681408" title="Set/get the poll interval and number of retries before detach exits.">bcm_detach_retry_get(int unit, bcm_detach_retry_t* retry)</a>  </td><td>Set/get the poll interval and number of retries before detach exits.   </td></tr>
</table>
<div class="fragment"><div class="line"><span class="comment">/* Attach/detach information. */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>bcm_advanced_init_info_s {</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> debug_flags              <span class="comment">/*  Holds flags,  such as print time stamp,  print memory utilization, test memory leak, etc */</span></div><div class="line">} bcm_advanced_init_info_t;</div></div><!-- fragment --><table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__init.html#gab22b8aa0a07bde38c5ae812084ac409c" title="API for initialization, caller can decide himself on flags and init info.">bcm_init_advanced(int unit, bcm_init_advanced_info_t* init_advanced_info)</a>  </td><td>API for initialization, caller can decide himself on flags and init info   </td></tr>
<tr>
<td><a class="el" href="group__init.html#gabb0d74e56110cbc92f838262a046c6bd" title="Set/get the warmboot state in BCM Layer.">bcm_warmboot_set(int unit, int warmboot)</a>  </td><td>Set/get the warmboot state in BCM Layer.   </td></tr>
<tr>
<td><a class="el" href="group__init.html#ga7bdea34c4badf15e10ad12b088ec61a2" title="Set/get the warmboot state in BCM Layer.">bcm_warmboot_get(int unit, int* warmboot)</a>  </td><td>Set/get the warmboot state in BCM Layer.   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<div class="footer-brcm-wrapper">
<table class="footer-brcm">
	<tbody><tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align="left"></td>
		<td class="footer-brcm"><small><b>Proprietary and Confidential &copy; 2020 Broadcom</b></small>
			<div class="footer-brcm">Broadcom Incorporated reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design.
Information furnished by Broadcom Incorporated is believed to be accurate and reliable. However, Broadcom Incorporated does not assume any liability arising
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license
under its patent rights nor the rights of others.
			</div>
		</td>
	</tr>
</tbody></table>
</div>
</body>
</html>
