<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDK API Guide: Quality of Service</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css"/>
<link href="tabs_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SDK API Guide
   &#160;<span id="projectnumber">Version 6.5.20</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Quality of Service </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This module generalizes all the different QoS features provided in various other modules. The general idea is to map the incoming packet's QoS markings to an internal priority on the ingress and to map the internal priority to the outgoing packet's QoS markings on the egress. Depending on the application, the packet markings can be 802.1p priority and CFI for Ethernet or MAC-in-MAC, DSCP for Layer 3 and EXP for MPLS. These will be supported for the BCM56634, BCM56524 and BCM56685 families of devices.</p>
<h1><a class="anchor" id="qos_data_type"></a>
Data Types Defined for QoS APIs</h1>
<ul>
<li>QoS Configuration Flags Given below is the list of configuration flags that can be used with the QoS APIs.</li>
</ul>
<div class="fragment"><div class="line">BCM_QOS_MAP_WITH_ID</div><div class="line">BCM_QOS_MAP_REPLACE</div><div class="line">BCM_QOS_MAP_L2</div><div class="line">BCM_QOS_MAP_L2_OUTER_TAG</div><div class="line">BCM_QOS_MAP_L2_INNER_TAG</div><div class="line">BCM_QOS_MAP_L2_UNTAGGED</div><div class="line">BCM_QOS_MAP_L2_VLAN_PCP</div><div class="line">BCM_QOS_MAP_L3</div><div class="line">BCM_QOS_MAP_IPV4</div><div class="line">BCM_QOS_MAP_IPV6</div><div class="line">BCM_QOS_MAP_MPLS</div><div class="line">BCM_QOS_MAP_ENCAP</div><div class="line">BCM_QOS_MAP_INGRESS</div><div class="line">BCM_QOS_MAP_EGRESS</div><div class="line">BCM_QOS_MAP_MPLS_ELSP</div><div class="line">BCM_QOS_MAP_MIM_ITAG</div><div class="line">BCM_QOS_MAP_QUEUE</div><div class="line">BCM_QOS_MAP_POLICER</div><div class="line">BCM_QOS_MAP_PACKET_INVALID</div><div class="line">BCM_QOS_MAP_IGNORE_OFFSET</div><div class="line">BCM_QOS_MAP_OPCODE</div><div class="line">BCM_QOS_MAP_L2_ETAG</div><div class="line">BCM_QOS_MAP_L2_VLAN_ETAG</div><div class="line">BCM_QOS_MAP_MPLS_PHP</div><div class="line">BCM_QOS_MAP_SUBPORT</div><div class="line">BCM_QOS_MAP_VFT</div><div class="line">BCM_QOS_MAP_VSAN</div><div class="line">BCM_QOS_MAP_RCH</div><div class="line">BCM_QOS_MAP_OAM_PCP</div><div class="line">BCM_QOS_MAP_OAM_INTPRI</div><div class="line">BCM_QOS_MAP_OAM_OUTER_VLAN_PCP</div><div class="line">BCM_QOS_MAP_OAM_INNER_VLAN_PCP</div><div class="line">BCM_QOS_MAP_OAM_MPLS_EXP</div><div class="line">BCM_QOS_MAP_REPLICATION</div><div class="line">BCM_QOS_MAP_MIML</div><div class="line">BCM_QOS_MAP_ENCAP_INTPRI_COLOR</div><div class="line">BCM_QOS_MAP_INGRESS_COPIED</div></div><!-- fragment --><a class="anchor" id=""></a>
<table class="doxtable">
<caption>Special QoS map parameters</caption>
<tr>
<th>Name </th><th>Purpose  </th></tr>
<tr>
<td>BCM_QOS_OPCODE_PRESERVE </td><td>Dedicated opcode for qos preserve. Used in egress for mapping qos profile to opcode.  </td></tr>
</table>
<table class="doxtable">
<tr>
<th>Name </th><th>Purpose  </th></tr>
<tr>
<td>BCM_QOS_MAX_TUNNEL_EXP </td><td>Maximum tunnel EXP number  </td></tr>
</table>
<a class="anchor" id=""></a>
<table class="doxtable">
<caption>QoS map action definitions.</caption>
<tr>
<th>Name </th><th>Purpose  </th></tr>
<tr>
<td>BCM_QOS_MAP_ACTION_DROP </td><td>Packet drop  </td></tr>
</table>
<ul>
<li>bcm_qos_map_t The type bcm_qos_map_t is a structure that represents a mapping between packet attributes and internal attributes. It is used by the <a class="el" href="group__qos.html#bcm_qos_map_add">bcm_qos_map_add</a> and the <a class="el" href="group__qos.html#bcm_qos_map_delete">bcm_qos_map_delete</a> APIs along with various configuration flags.</li>
<li>tunnel_exp is to indicate tunnel label EXP values that are remarked on MPLS tunnel encap point. This is valid for the qos map created with BCM_QOS_MAP_MPLS | BCM_QOS_MAP_EGRESS | BCM_QOS_MAP_ENCAP flags combination. The tunnel_exp is an EXP array, BCM_QOS_MAX_TUNNEL_EXP is used to indicate the maximum number of tunnel label EXP that can be remarked. Up to 7 tunnel label EXPs can be remarked out on TD4. The tunnel_exp[BCM_QOS_MAX_TUNNEL_EXP-1] indicates the outermost tunnel label EXP, and tunnel_exp[BCM_QOS_MAX_TUNNEL_EXP-2] indicates the second outermost tunnel label EXP and so on. When the tunnel_exp[n] is set as BCM_MPLS_EXP_INVALID, it indicates do not remark this tunnel EXP.</li>
<li>actions is used to indicate QoS map actions, such as packet drop, which means the packet which hits the QoS map entry will be dropped.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__qos__map__s.html">bcm_qos_map_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__qos__map__s.html#a43f20e42eb08f7e9aef95f2d53831e36">pkt_pri</a>;                      <span class="comment">/* Packet priority */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__qos__map__s.html#a9d02907c7f4901f53eea486052421b70">pkt_cfi</a>;                      <span class="comment">/* Packet CFI */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__qos__map__s.html#a139f7aad5397431a4e30fd2787c29dc5">dscp</a>;                           <span class="comment">/* Packet DSCP */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__qos__map__s.html#a3bb4af16b31e7979f424cf66f1bfa6e2">exp</a>;                            <span class="comment">/* Packet EXP */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__qos__map__s.html#a802cbbe822a00332f210c777da8a0e9a">int_pri</a>;                        <span class="comment">/* Internal priority */</span></div><div class="line">    <a class="code" href="group__types.html#ga24111d898bb4ee4a12793dfa40c3a79d">bcm_color_t</a> <a class="code" href="structbcm__qos__map__s.html#aa6237919183657a4dff521eb0076d310">color</a>;                  <span class="comment">/* Color */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__qos__map__s.html#a36d20ff667b34c61ec0298a011f3e424">remark_int_pri</a>;                 <span class="comment">/* (internal) remarking priority */</span></div><div class="line">    <a class="code" href="group__types.html#ga24111d898bb4ee4a12793dfa40c3a79d">bcm_color_t</a> <a class="code" href="structbcm__qos__map__s.html#a217cc7da3f9e8adaaeb14b281386bfdb">remark_color</a>;           <span class="comment">/* (internal) remark color */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__qos__map__s.html#a76f543ecf8dcecee777d2281a40ac3a1">policer_offset</a>;                 <span class="comment">/* Offset based on pri/cos to fetch a</span></div><div class="line"><span class="comment">                                           policer */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__qos__map__s.html#a4410fb4023f962214b874eefb79e8c66">queue_offset</a>;                   <span class="comment">/* Offset based on int_pri to fetch cosq</span></div><div class="line"><span class="comment">                                           for subscriber ports */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__qos__map__s.html#ac7fcd991462b3c8d6ca190552f9fa18d">port_offset</a>;                    <span class="comment">/* Offset based on port connection for</span></div><div class="line"><span class="comment">                                           indexing into the action table */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__qos__map__s.html#a6fa046f09628fd0e92da7df582733367">etag_pcp</a>;                     <span class="comment">/* ETAG PCP field */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__qos__map__s.html#a638ef65dbe29677b452b6fb1b97ab810">etag_de</a>;                      <span class="comment">/* ETAG DE field */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__qos__map__s.html#a323900d11f042b3a1eae1079729879a1">counter_offset</a>;                 <span class="comment">/* Offset based on priority for indexing</span></div><div class="line"><span class="comment">                                           into the loss measurement counter</span></div><div class="line"><span class="comment">                                           table */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__qos__map__s.html#afc3cb808d09a1492f50be6885a9eb97a">inherited_dscp_exp</a>;             <span class="comment">/* Inherited DSCP EXP value */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__qos__map__s.html#ab496783cb379b9fc82155cd88114b26e">opcode</a>;                      <span class="comment">/* Set QOS Map Opcode ID */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__qos__map__s.html#a5cc777ab65f9b7dddb1f719e0171eacc">inner_pkt_pri</a>;                <span class="comment">/* Inner Tag Packet priority */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__qos__map__s.html#a5c52bc611d151bd5bb20ddf6b424404e">inner_pkt_cfi</a>;                <span class="comment">/* Inner Tag Packet CFI */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__qos__map__s.html#a0454b255a3046830aaea4f157ec6458e">int_cn</a>;                       <span class="comment">/* Internal congestion notification */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__qos__map__s.html#ae7dec94de90b1df678dc10fb30aff6bf">pkt_ecn</a>;                      <span class="comment">/* Packet explicit congestion</span></div><div class="line"><span class="comment">                                           notification */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__qos__map__s.html#a2686306d9ed26d8a58dac7d994b4c865">responsive</a>;                   <span class="comment">/* Responsive flow (like TCP) */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__qos__map__s.html#a479f6592e20ce806dff6097582ced6f4">latency_marked</a>;               <span class="comment">/* Packet marked with latency congestion */</span></div><div class="line">    <span class="keywordtype">int</span> <a class="code" href="structbcm__qos__map__s.html#aca816dbe3c42f406ebcc61b46596c3e7">tunnel_exp</a>[BCM_QOS_MAX_TUNNEL_EXP]; <span class="comment">/* MPLS tunnel EXP */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__qos__map__s.html#ab375e19205d76bd333e1a50d44323570">actions</a>;                     <span class="comment">/* QOS map actions */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__qos__map__s.html#aa0d1d75f64f96e311a74afb8a35762a3">copied_pkt_pri</a>;               <span class="comment">/* Packet priority copied from ingress</span></div><div class="line"><span class="comment">                                           pipeline */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__qos__map__s.html#a5834ffbb7720a73f9ed06027e867decd">copied_pkt_cfi</a>;               <span class="comment">/* Packet CFI copied from ingress</span></div><div class="line"><span class="comment">                                           pipeline */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__qos__map__s.html#a7b1a50e73446084d0d127bb2e9ca4a44">copied_pkt_dscp</a>;              <span class="comment">/* Packet DSCP copied from ingress</span></div><div class="line"><span class="comment">                                           pipeline */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structbcm__qos__map__s.html#accefda2a0567ee4eee37b70082151114">copied_pkt_ecn</a>;               <span class="comment">/* Packet ECN copied from ingress</span></div><div class="line"><span class="comment">                                           pipeline */</span></div><div class="line">} <a class="code" href="group__qos.html#ga566d26c30cdce0858ed0534d8c11d337">bcm_qos_map_t</a>;</div></div><!-- fragment --><h1><a class="anchor" id="qos_apis"></a>
QoS APIs</h1>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__qos.html#gada97ea47d2e887744f76b2b38040d73f" title="Initialize the BCM QoS subsystem.">bcm_qos_init(int unit)</a>  </td><td>Initialize the BCM QoS subsystem.   </td></tr>
<tr>
<td><a class="el" href="group__qos.html#ga09fcef855f16fb8d9a97e61f0b366f19" title="Detach the BCM QoS subsystem.">bcm_qos_detach(int unit)</a>  </td><td>Detach the BCM QoS subsystem.   </td></tr>
<tr>
<td><a class="el" href="group__qos.html#ga0e809cf73bb81440d0d920e2468d40bc" title="Initialize the QoS Map structure.">bcm_qos_map_t_init(bcm_qos_map_t* qos_map)</a>  </td><td>Initialize the QoS Map structure.   </td></tr>
<tr>
<td><a class="el" href="group__qos.html#ga7b7e239d154782c013435339e39986bb" title="Allocates hardware resources for QoS mapping.">bcm_qos_map_create(int unit, uint32 flags, int* map_id)</a>  </td><td>Allocates hardware resources for QoS mapping.   </td></tr>
<tr>
<td><a class="el" href="group__qos.html#ga71a2cba1cef9e24546d03d3da5f3f790" title="Frees hardware resources for QoS mapping.">bcm_qos_map_destroy(int unit, int map_id)</a>  </td><td>Frees hardware resources for QoS mapping.   </td></tr>
<tr>
<td><a class="el" href="group__qos.html#ga1ad24323d378dc4c914ab1289d15dd6f" title="Add a specific mapping entry to a QoS map.">bcm_qos_map_add(int unit, uint32 flags, bcm_qos_map_t* map, int map_id)</a>  </td><td>Add a specific mapping entry to a QoS map.   </td></tr>
<tr>
<td><a class="el" href="group__qos.html#ga769f66b74e4c9b9829c9b3bef722df17" title="Deletes a specific mapping entry from a QoS map.">bcm_qos_map_delete(int unit, uint32 flags, bcm_qos_map_t* map, int map_id)</a>  </td><td>Deletes a specific mapping entry from a QoS map.   </td></tr>
<tr>
<td><a class="el" href="group__qos.html#gad6a583d9cf75b5e7208d82f3ad350a6b" title="Get an entire QoS mapping for the given QoS Map ID.">bcm_qos_map_multi_get(int unit, uint32 flags, int map_id, int array_size, bcm_qos_map_t* array, int* array_count)</a>  </td><td>Get an entire QoS mapping for the given QoS Map ID.   </td></tr>
<tr>
<td><a class="el" href="group__qos.html#ga9ca411d8444ba8000544b4c94ed57284" title="Retrieves the configured QoS mapping for the given GPORT.">bcm_qos_port_map_get(int unit, bcm_gport_t port, int* ing_map, int* egr_map)</a>  </td><td>Retrieves the configured QoS mapping for the given GPORT.   </td></tr>
<tr>
<td><a class="el" href="group__qos.html#ga264299c64f52f3207899daab6d435c30" title="Retrieves the configured QoS mapping matching a type for the given GPORT.">bcm_qos_port_map_type_get(int unit, bcm_gport_t port, uint32 flags, int* map_id)</a>  </td><td>Retrieves the configured QoS mapping matching a type for the given GPORT.   </td></tr>
<tr>
<td><a class="el" href="group__qos.html#ga243ccfb0db958a57cbb41dfb9454d703" title="Associates a GPORT with a QoS map.">bcm_qos_port_map_set(int unit, bcm_gport_t port, int ing_map, int egr_map)</a>  </td><td>Associates a GPORT with a QoS map.   </td></tr>
<tr>
<td><a class="el" href="group__qos.html#ga9cb6846f82f6b3788f9099769891d7d0" title="Associate a port, vid with an ingress and egress QoS mapping.">bcm_qos_port_vlan_map_set(int unit, bcm_port_t port, bcm_vlan_t vid, int ing_map, int egr_map)</a>  </td><td>Associate a port, vid with an ingress and egress QoS mapping.   </td></tr>
<tr>
<td><a class="el" href="group__qos.html#ga3a18b9bd774d490f33980f744083170e" title="Get the QoS map ID for a port, vid.">bcm_qos_port_vlan_map_get(int unit, bcm_port_t port, bcm_vlan_t vid, int* ing_map, int* egr_map)</a>  </td><td>Get the QoS map ID for a port, vid.   </td></tr>
<tr>
<td><a class="el" href="group__qos.html#gaba6ea87f7a8a96d387d74c1c1dd74b31" title="Get the list of all QoS Map IDs.">bcm_qos_multi_get(int unit, int array_size, int* map_ids_array, int* flags_array, int* array_count)</a>  </td><td>Get the list of all QoS Map IDs.   </td></tr>
<tr>
<td>bcm_qos_control_set(int unit, bcm_qos_control_type_t type, int arg)  </td><td>Set/get QoS control properties per the control type.   </td></tr>
<tr>
<td>bcm_qos_control_get(int unit, bcm_qos_control_type_t type, int* arg)  </td><td>Set/get QoS control properties per the control type.   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<div class="footer-brcm-wrapper">
<table class="footer-brcm">
	<tbody><tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align="left"></td>
		<td class="footer-brcm"><small><b>Proprietary and Confidential &copy; 2020 Broadcom</b></small>
			<div class="footer-brcm">Broadcom Incorporated reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design.
Information furnished by Broadcom Incorporated is believed to be accurate and reliable. However, Broadcom Incorporated does not assume any liability arising
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license
under its patent rights nor the rights of others.
			</div>
		</td>
	</tr>
</tbody></table>
</div>
</body>
</html>
