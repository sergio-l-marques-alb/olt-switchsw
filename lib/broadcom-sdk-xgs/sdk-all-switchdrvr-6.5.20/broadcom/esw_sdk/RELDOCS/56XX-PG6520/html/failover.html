<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDK API Guide: Forwarding Failover Protection</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css"/>
<link href="tabs_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SDK API Guide
   &#160;<span id="projectnumber">Version 6.5.20</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Forwarding Failover Protection </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>BCM56634 provides Failover functionality. BCM56440 provides Linear (1:1 and 1+1) protection switching and Ring protection switching. BCM Failover APIs allow application developers to manage protection switching features that are applicable to Ethernet, MPLS, MiM, and Layer-3 applications.</p>
<h1><a class="anchor" id="failover_overview"></a>
Failover Overview</h1>
<p>Forwarding failover protection can be established by calling bcm_failover_create, and then setting the failover ID and the failover port in one of the following structures. This functionality is being supported for ESW and XCore devices.</p>
<div class="fragment"><div class="line"><a class="code" href="group__l3.html#gab8849e144eeaa9c6721632f069ca7fc8">bcm_l3_egress_t</a>:</div><div class="line">   <a class="code" href="group__types.html#gaf273a2d08ebc6fc3e5d0319aeb414ceb">bcm_failover_t</a> <a class="code" href="l3_8dox.html#a5814080f31ea8ec26e594e85df149197">failover_id</a></div><div class="line">   <a class="code" href="group__types.html#ga30e6e81bfad0b18e55d3a1c8148fd75d">bcm_if_t</a>       failover_if</div><div class="line"></div><div class="line"><a class="code" href="group__mpls.html#gaa2dd67e93aa30cd83fcf816a8014ea4c">bcm_mpls_port_t</a>:</div><div class="line">   <a class="code" href="group__types.html#gaf273a2d08ebc6fc3e5d0319aeb414ceb">bcm_failover_t</a> <a class="code" href="l3_8dox.html#a5814080f31ea8ec26e594e85df149197">failover_id</a></div><div class="line">   <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a>    failover_port</div><div class="line"></div><div class="line"><a class="code" href="group__mim.html#gaa135b8d31c230c863917696eec988157">bcm_mim_port_t</a>:</div><div class="line">   <a class="code" href="group__types.html#gaf273a2d08ebc6fc3e5d0319aeb414ceb">bcm_failover_t</a> <a class="code" href="l3_8dox.html#a5814080f31ea8ec26e594e85df149197">failover_id</a></div><div class="line">   <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a>    failover_port</div></div><!-- fragment --><h1><a class="anchor" id="failover_data_types"></a>
Failover Data Types</h1>
<ul>
<li>The bcm_failover_element_t structure describes a failover object used for protection switching.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__failover__element__s.html">bcm_failover_element_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__failover__element__s.html#a81a27ce50e78368b0d0de1e8767fd32d">flags</a>;               <span class="comment">/* flags */</span></div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__failover__element__s.html#aa0042e0d5ff262024d85502b2f499f35">element_flags</a>;       <span class="comment">/* flags specific to elements. */</span></div><div class="line">    <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> <a class="code" href="structbcm__failover__element__s.html#a56da6f3a91f2f6d38953ef7c66fa78b2">port</a>;           <span class="comment">/* MPLS/MiM/VLAN gport */</span></div><div class="line">    <a class="code" href="group__types.html#gaf273a2d08ebc6fc3e5d0319aeb414ceb">bcm_failover_t</a> <a class="code" href="structbcm__failover__element__s.html#a5814080f31ea8ec26e594e85df149197">failover_id</a>; <span class="comment">/* Failover Object Index. */</span></div><div class="line">    <a class="code" href="group__types.html#ga30e6e81bfad0b18e55d3a1c8148fd75d">bcm_if_t</a> <a class="code" href="structbcm__failover__element__s.html#a56ead26537d07bc392e17b49dcdb686e">intf</a>;              <span class="comment">/* Egress Object index. */</span></div><div class="line">} <a class="code" href="group__failover.html#gad36067641ea3b499caa349c42631c5f5">bcm_failover_element_t</a>;</div></div><!-- fragment --><a class="anchor" id=""></a>
<table class="doxtable">
<caption>Failover Create Flags</caption>
<tr>
<th>FLAG </th><th>Meaning  </th></tr>
<tr>
<td>BCM_FAILOVER_WITH_ID </td><td>Create a failover object using the specified ID.  </td></tr>
<tr>
<td>BCM_FAILOVER_REPLACE </td><td>Update a failover object with the specified ID.  </td></tr>
<tr>
<td>BCM_FAILOVER_CLEAR </td><td>Flag to clear the failover state.  </td></tr>
<tr>
<td>BCM_FAILOVER_LOOKUP_DISABLE </td><td>Flag to enable flooding by disabling l2 lookup.  </td></tr>
<tr>
<td>BCM_FAILOVER_LEARN_DISABLE </td><td>Flag to disable learning while failover is in progress.  </td></tr>
<tr>
<td>BCM_FAILOVER_ID_LOCAL </td><td>Failover id reserved for local protection, this ID cannot be created or destroyed  </td></tr>
<tr>
<td>BCM_FAILOVER_L2_LOOKUP </td><td>flag to create a failover object for L2 lookup (fast flush)  </td></tr>
<tr>
<td>BCM_FAILOVER_PAIRED </td><td>flag to allocate a pair of adjoining failover objects  </td></tr>
<tr>
<td>BCM_FAILOVER_FEC </td><td>flag to create a FEC failover object for 1:1 UC Protection  </td></tr>
<tr>
<td>BCM_FAILOVER_INGRESS </td><td>flag to create an Ingress failover object for 1+1 Protection  </td></tr>
<tr>
<td>BCM_FAILOVER_ENCAP </td><td>flag to create an encapsulation failover object for 1:1 MC Protection  </td></tr>
<tr>
<td>BCM_FAILOVER_VPN_TYPE </td><td>flag to use VPN ID for failover  </td></tr>
<tr>
<td>BCM_FAILOVER_MULTI_LEVEL_TYPE </td><td>flag to create multi level failover  </td></tr>
<tr>
<td>BCM_FAILOVER_FEC_2ND_HIERARCHY </td><td>flag to allocate failover id to be used for FEC second hierarchys  </td></tr>
<tr>
<td>BCM_FAILOVER_FEC_3RD_HIERARCHY </td><td>flag to allocate failover id to be used for FEC third hierarchy  </td></tr>
</table>
<a class="anchor" id=""></a>
<table class="doxtable">
<caption>Failover Element Flags</caption>
<tr>
<th>FLAG </th><th>Meaning  </th></tr>
<tr>
<td>BCM_FAILOVER_ELEMENT_USE_SECONDARY </td><td>Use Secondary/failover path.  </td></tr>
</table>
<ul>
<li><a class="anchor" id="bcm_failover_multi_level_t"></a>The bcm_failover_multi_level_t structure is used to create a hierarchy of failover paths for multi level protection switching.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__failover__multi__level__s.html">bcm_failover_multi_level_s</a> {</div><div class="line">    <a class="code" href="group__types.html#gaf273a2d08ebc6fc3e5d0319aeb414ceb">bcm_failover_t</a> <a class="code" href="structbcm__failover__multi__level__s.html#a5814080f31ea8ec26e594e85df149197">failover_id</a>;    <span class="comment">/* Parent Failover id */</span></div><div class="line"></div><div class="line">    <a class="code" href="group__types.html#gaf273a2d08ebc6fc3e5d0319aeb414ceb">bcm_failover_t</a> <a class="code" href="structbcm__failover__multi__level__s.html#a3938bd22c58958f301ed3818b6bdd335">prot_group_1</a>;  <span class="comment">/* Child protection group 1*/</span></div><div class="line">    <a class="code" href="group__types.html#gaf273a2d08ebc6fc3e5d0319aeb414ceb">bcm_failover_t</a> <a class="code" href="structbcm__failover__multi__level__s.html#a9a54c75a370f421bef1d44d71dbc0b0c">prot_group_2</a>;  <span class="comment">/* Child protection group 2</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">} bcm_failover_multi_level_t;</span></div></div><!-- fragment --><h1><a class="anchor" id="failover_apis"></a>
Failover APIs</h1>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__failover.html#gaa1903101a567750044d35a79d2e801e8" title="Initialize Failover element structure.">bcm_failover_element_t_init(bcm_failover_element_t* failover)</a>  </td><td>Initialize Failover element structure.   </td></tr>
</table>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__failover.html#gadbef0a0d18b56a575e0b4aa2201fe512" title="Initialize the Failover software module.">bcm_failover_init(int unit)</a>  </td><td>Initialize the Failover software module.   </td></tr>
</table>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__failover.html#ga0921aa79ead24b9acda0976b0991360e" title="Detach the Failover software module.">bcm_failover_cleanup(int unit)</a>  </td><td>Detach the Failover software module.   </td></tr>
</table>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__failover.html#gaaa8fc5af22cb8188a68aec98f1ff6272" title="Create a failover object.">bcm_failover_create(int unit, uint32 flags, bcm_failover_t* failover_id)</a>  </td><td>Create a failover object.   </td></tr>
</table>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__failover.html#ga25e89b55c8987681d75734330fe48745" title="Destroy a failover object.">bcm_failover_destroy(int unit, bcm_failover_t failover_id)</a>  </td><td>Destroy a failover object.   </td></tr>
</table>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__failover.html#ga495d138f433910e8fa5c0b6f64ff2688" title="Set a failover object to enable or disable (note that failover object 0 is reserved.">bcm_failover_set(int unit, bcm_failover_t failover_id, int enable)</a>  </td><td>Set a failover object to enable or disable.   </td></tr>
<tr>
<td><a class="el" href="group__failover.html#ga5cbdc3d01399d3af9e953434ee5aa448" title="Set a failover object to enable or disable (note that failover object 0 is reserved.">bcm_failover_status_set(int unit, bcm_failover_element_t* failover, int enable)</a>  </td><td>Set a failover object to enable or disable.   </td></tr>
</table>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__failover.html#gade39d01e805a9d7feb6634356de56fe1" title="Get the enable status of a failover object.">bcm_failover_get(int unit, bcm_failover_t failover_id, int* enable)</a>  </td><td>Get the enable status of a failover object.   </td></tr>
<tr>
<td><a class="el" href="group__failover.html#ga64b65157961afb3e26f56e8f9ef5c99d" title="Get a failover object to enable or disable (note that failover object 0 is reserved.">bcm_failover_status_get(int unit, bcm_failover_element_t* failover, int* enable)</a>  </td><td>Get the enable status of a failover object.   </td></tr>
</table>
<h1><a class="anchor" id="failover_ring_protection"></a>
Failover ring protection</h1>
<p>Provides configuration for ring failover protection mechanism.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structbcm__failover__ring__s.html">bcm_failover_ring_s</a> {</div><div class="line">    <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structbcm__failover__ring__s.html#a81a27ce50e78368b0d0de1e8767fd32d">flags</a>;                   <span class="comment">/* BCM_FAILOVER_XXX flags */</span></div><div class="line">    <a class="code" href="group__types.html#ga120cca4977dad5b50498e5a8d31a12a5">bcm_vlan_vector_t</a> <a class="code" href="structbcm__failover__ring__s.html#ad60fcc640b0c68215ac7e89075b4e4ef">vlan_vector</a>;  <span class="comment">/* List of Vlans. */</span></div><div class="line">    <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> <a class="code" href="structbcm__failover__ring__s.html#a513c2beb3982a7198dd46a57ef35a1f3">port0</a>;              <span class="comment">/* VLAN gport */</span></div><div class="line">    <a class="code" href="group__types.html#gac5f933aaac05c65b2a78ad8a04316994">bcm_gport_t</a> <a class="code" href="structbcm__failover__ring__s.html#a9b171a81a2e1d10d963620d7a6bd4776">port1</a>;              <span class="comment">/* VLAN gport */</span></div><div class="line">    <a class="code" href="group__types.html#ga422ca67b6dd5ea09fe52b01a44cf3bf6">bcm_vpn_vector_t</a> <a class="code" href="structbcm__failover__ring__s.html#a8f616226e214f932e1fc44c410d9b046">vpn_vector</a>;    <span class="comment">/* List of VPN IDs. */</span></div><div class="line">} <a class="code" href="group__failover.html#gadee15aa83f6ba975502db0409d05a0a9">bcm_failover_ring_t</a>;</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The application must initialize all bcm_failover_ring_t structures using <a class="el" href="group__failover.html#ga47722b96cebdbddf8bff1106c3a1b229" title="Initialize an empty failover ring structure.">bcm_failover_ring_t_init()</a>. The applicable flags are BCM_FAILOVER_LOOKUP_DISABLE, BCM_FAILOVER_LEARN_DISABLE, BCM_FAILOVER_CLEAR, BCM_FAILOVER_VPN_TYPE. To set/get/clear the bits in vpn_vector, VPN_ID has to be passed to macros BCM_VPN_VEC_SET/BCM_VPN_VEC_GET/BCM_VPN_VEC_CLR respectively. Similarly, to set/get/clear the bits in vlan_vector, bit corresponding to VLAN_ID has to be passed to macros BCM_VLAN_VEC_SET/BCM_VLAN_VEC_GET/BCM_VLAN_VEC_CLR respectively.</dd></dl>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__failover.html#ga47722b96cebdbddf8bff1106c3a1b229" title="Initialize an empty failover ring structure.">bcm_failover_ring_t_init(bcm_failover_ring_t* failover)</a>  </td><td>Initialize an empty failover ring structure.   </td></tr>
<tr>
<td><a class="el" href="group__failover.html#gae758591a62e4ef48c85c15006419d76f" title="Configure the failover ring on the system.">bcm_failover_ring_config_set(int unit, bcm_failover_ring_t* failover_ring)</a>  </td><td>Configure the failover ring on the system.   </td></tr>
<tr>
<td><a class="el" href="group__failover.html#ga5423c0e513264334a83fdb7197cf455e" title="Get the failover ring configuration.">bcm_failover_ring_config_get(int unit, bcm_failover_ring_t* failover_ring)</a>  </td><td>Get the failover ring configuration.   </td></tr>
<tr>
<td><a class="el" href="group__failover.html#ga0498a93ab8149ec4c41652c6835a2adf" title="Initializes 2 level failover data structure.">bcm_failover_multi_level_t_init(bcm_failover_multi_level_t* multi_level_failover)</a>  </td><td>Initializes 2 level failover data structure.   </td></tr>
<tr>
<td><a class="el" href="group__failover.html#ga54e1b6cb44c1876a3e5114232c285329" title="Attaches multiple levels of 2 level protection switching.">bcm_failover_multi_level_attach(int unit, bcm_failover_multi_level_t multi_level_failover)</a>  </td><td>Attaches multiple levels of 2 level protection switching.   </td></tr>
</table>
<h1><a class="anchor" id="failover_egress_protection"></a>
Failover egress protection</h1>
<p>BCM56980 and BCM56880 support protection switching by adding protection next hops at a specific offset from primary next hops. All the protected next hops have the same global configured offset to their primary next hops. Only 1:1 protection is supported and multiple level failover is not supported so far.</p>
<table class="doxtable">
<tr>
<th>API </th><th>Brief  </th></tr>
<tr>
<td><a class="el" href="group__failover.html#gab6affea3baf0464656c428dec31f8b04" title="Get the protection next hop interface for the primary next hop interface.">bcm_failover_egress_protection_get(int unit, bcm_if_t intf, bcm_if_t* prot_intf)</a>  </td><td>Get the protection next hop interface for the primary next hop interface.   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<div class="footer-brcm-wrapper">
<table class="footer-brcm">
	<tbody><tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align="left"></td>
		<td class="footer-brcm"><small><b>Proprietary and Confidential &copy; 2020 Broadcom</b></small>
			<div class="footer-brcm">Broadcom Incorporated reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design.
Information furnished by Broadcom Incorporated is believed to be accurate and reliable. However, Broadcom Incorporated does not assume any liability arising
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license
under its patent rights nor the rights of others.
			</div>
		</td>
	</tr>
</tbody></table>
</div>
</body>
</html>
