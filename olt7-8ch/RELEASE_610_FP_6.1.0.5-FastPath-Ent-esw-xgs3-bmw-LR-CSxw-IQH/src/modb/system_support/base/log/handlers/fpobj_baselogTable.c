/*******************************************************************************
*
* (C) Copyright Broadcom Corporation 2000-2007
*
********************************************************************************
*
* @filename fpobj_baselogTable.c
*
* @purpose
*
* @component object handlers
*
* @comments  Refer to sntp-object.xml
*
* @create  19 January 2008
*
* @author  Rama Sasthri, Kristipati
* @end
*
********************************************************************************/
#include "fpobj_util.h"
#include "_xe_baselogTable_obj.h"
#include "usmdb_mib_rmon_api.h"


/*******************************************************************************
* @function fpObjGet_baselogTable_logEventIndex
*
* @purpose Get 'logEventIndex'
*
* @description [logEventIndex]  The event entry that generated this log entry. The log identified by a particular value of this index is associated with the same eventEntry as identified by the same value of eventIndex.
*
* @notes  
*
* @return
*******************************************************************************/
xLibRC_t fpObjGet_baselogTable_logEventIndex (void *wap, void *bufp)
{

  xLibU32_t objlogEventIndexValue;
  xLibU32_t nextObjlogEventIndexValue;
  xLibU32_t objlogIndexValue;
  fpObjWa_t owa = FPOBJ_INIT_WA (sizeof (xLibU32_t));
  FPOBJ_TRACE_ENTER (bufp);

  /* retrieve key: logEventIndex */
  owa.rc = xLibFilterGet (wap, XOBJ_baselogTable_logEventIndex,
                          (xLibU8_t *) & objlogEventIndexValue, &owa.len);
  if (owa.rc != XLIBRC_SUCCESS)
  {
    FPOBJ_TRACE_CURRENT_KEY (bufp, NULL, 0);
    objlogEventIndexValue = objlogIndexValue = 0;
    owa.l7rc =
      usmDbLogEntryNext (L7_UNIT_CURRENT, objlogEventIndexValue,
                           &objlogIndexValue);
  }
  else
  {
    FPOBJ_TRACE_CURRENT_KEY (bufp, &objlogEventIndexValue, owa.len);
    nextObjlogEventIndexValue = objlogEventIndexValue;  
    do
    {
      objlogIndexValue = 0;
      owa.l7rc =
        usmDbLogEntryNext (L7_UNIT_CURRENT, objlogEventIndexValue,
                             &objlogIndexValue);
    }
    while ((objlogEventIndexValue == nextObjlogEventIndexValue) && (owa.l7rc == L7_SUCCESS));
  }

  if ((owa.l7rc != L7_SUCCESS))
  {
    owa.rc = XLIBRC_ENDOF_TABLE;
    FPOBJ_TRACE_EXIT (bufp, owa);
    return owa.rc;
  }
  nextObjlogEventIndexValue = objlogEventIndexValue;
  FPOBJ_TRACE_NEW_KEY (bufp, &nextObjlogEventIndexValue, owa.len);

  /* return the object value: logEventIndex */
  owa.rc = xLibBufDataSet (bufp, (xLibU8_t *) & nextObjlogEventIndexValue,
                           sizeof (objlogEventIndexValue));
  FPOBJ_TRACE_EXIT (bufp, owa);
  return owa.rc;

}

/*******************************************************************************
* @function fpObjGet_baselogTable_logIndex
*
* @purpose Get 'logIndex'
*
* @description [logIndex]  An index that uniquely identifies an entry in the log table amongst those generated by the same eventEntries. These indexes are assigned beginning with 1 and increase by one with each new log entry. The association 
*
* @notes  
*
* @return
*******************************************************************************/
xLibRC_t fpObjGet_baselogTable_logIndex (void *wap, void *bufp)
{

  xLibU32_t objlogEventIndexValue;
  xLibU32_t nextObjlogEventIndexValue;
  xLibU32_t objlogIndexValue;
  xLibU32_t nextObjlogIndexValue;
  fpObjWa_t owa = FPOBJ_INIT_WA (sizeof (xLibU32_t));
  FPOBJ_TRACE_ENTER (bufp);

  /* retrieve key: logEventIndex */
  owa.rc = xLibFilterGet (wap, XOBJ_baselogTable_logEventIndex,
                          (xLibU8_t *) & objlogEventIndexValue, &owa.len);
  if (owa.rc != XLIBRC_SUCCESS)
  {
    owa.rc = XLIBRC_FILTER_MISSING;
    FPOBJ_TRACE_EXIT (bufp, owa);
    return owa.rc;
  }

  FPOBJ_TRACE_CURRENT_KEY (bufp, &objlogEventIndexValue, owa.len);

  /* retrieve key: logIndex */
  owa.rc = xLibFilterGet (wap, XOBJ_baselogTable_logIndex,
                          (xLibU8_t *) & objlogIndexValue, &owa.len);
  nextObjlogEventIndexValue = objlogEventIndexValue;
  if (owa.rc != XLIBRC_SUCCESS)
  {
    FPOBJ_TRACE_CURRENT_KEY (bufp, NULL, 0);
    objlogIndexValue = 0;
    owa.l7rc = 
      usmDbLogEntryNext (L7_UNIT_CURRENT, objlogEventIndexValue,
                           &objlogIndexValue);
  }
  else
  {
    FPOBJ_TRACE_CURRENT_KEY (bufp, &objlogIndexValue, owa.len);
    owa.l7rc = 
      usmDbLogEntryNext (L7_UNIT_CURRENT, objlogEventIndexValue,
                           &objlogIndexValue);

  }

  if ((objlogEventIndexValue != nextObjlogEventIndexValue) || (owa.l7rc != L7_SUCCESS))
  {
    owa.rc = XLIBRC_ENDOF_TABLE;
    FPOBJ_TRACE_EXIT (bufp, owa);
    return owa.rc;
  }

  nextObjlogIndexValue = objlogIndexValue;
  FPOBJ_TRACE_NEW_KEY (bufp, &nextObjlogIndexValue, owa.len);

  /* return the object value: logIndex */
  owa.rc = xLibBufDataSet (bufp, (xLibU8_t *) & nextObjlogIndexValue, sizeof (objlogIndexValue));
  FPOBJ_TRACE_EXIT (bufp, owa);
  return owa.rc;

}


#if 0
/*******************************************************************************
* @function fpObjGet_baselogTable_logEventIndex_logIndex
*
* @purpose Get 'logEventIndex + logIndex +'
*
* @description [logEventIndex]:  The event entry that generated this log entry.
*              The log identified by a particular value of this index
*              is associated with the same eventEntry as identified by the
*              same value of eventIndex. 
*              [logIndex]:  An index that uniquely identifies an entry in
*              the log table amongst those generated by the same eventEntries.
*              These indexes are assigned beginning with 1 and increase
*              by one with each new log entry. The association 
*
* @note  This is KEY Object
*
* @return
*******************************************************************************/
xLibRC_t fpObjGet_baselogTable_logEventIndex_logIndex (void *wap, void *bufp[],
                                                       xLibU16_t keyCount)
{
  fpObjWa_t owa = FPOBJ_INIT_WA (sizeof (xLibU32_t));
  fpObjWa_t owalogEventIndex = FPOBJ_INIT_WA (sizeof (xLibU32_t));
  xLibU32_t objlogEventIndexValue, nextObjlogEventIndexValue;
  fpObjWa_t owalogIndex = FPOBJ_INIT_WA (sizeof (xLibU32_t));
  xLibU32_t objlogIndexValue, nextObjlogIndexValue;
  objlogEventIndexValue = 0;
  objlogIndexValue = 0;
  void *outlogEventIndex = (void *) bufp[--keyCount];
  void *outlogIndex = (void *) bufp[--keyCount];
  FPOBJ_TRACE_ENTER (outlogEventIndex);
  FPOBJ_TRACE_ENTER (outlogIndex);

  /* retrieve key: logEventIndex */
  owalogEventIndex.rc = xLibFilterGet (wap, XOBJ_baselogTable_logEventIndex,
                                       (xLibU8_t *) & objlogEventIndexValue,
                                       &owalogEventIndex.len);
  if (owalogEventIndex.rc == XLIBRC_SUCCESS)
  {
    /* retrieve key: logIndex */
    owalogIndex.rc = xLibFilterGet (wap, XOBJ_baselogTable_logIndex,
                                    (xLibU8_t *) & objlogIndexValue,
                                    &owalogIndex.len);
  }
  FPOBJ_TRACE_CURRENT_KEY (outlogEventIndex, &objlogEventIndexValue,
                           owalogEventIndex.len);
  FPOBJ_TRACE_CURRENT_KEY (outlogIndex, &objlogIndexValue, owalogIndex.len);
  owa.rc =
    usmDbLogEntryNext (L7_UNIT_CURRENT, &objlogEventIndexValue,
                         &objlogIndexValue);
  if (owa.rc != L7_SUCCESS)
  {
    owa.rc = XLIBRC_FAILURE;
    FPOBJ_TRACE_EXIT (outlogEventIndex, owalogEventIndex);
    FPOBJ_TRACE_EXIT (outlogIndex, owalogIndex);
    return owa.rc;
  }
  nextObjlogEventIndexValue = objlogEventIndexValue;
  nextObjlogIndexValue = objlogIndexValue;
  
  FPOBJ_TRACE_CURRENT_KEY (outlogEventIndex, &nextObjlogEventIndexValue,
                           owalogEventIndex.len);
  FPOBJ_TRACE_CURRENT_KEY (outlogIndex, &nextObjlogIndexValue, owalogIndex.len);

  /* return the object value: logEventIndex */
  xLibBufDataSet (outlogEventIndex,
                  (xLibU8_t *) & nextObjlogEventIndexValue,
                  sizeof (nextObjlogEventIndexValue));

  /* return the object value: logIndex */
  xLibBufDataSet (outlogIndex,
                  (xLibU8_t *) & nextObjlogIndexValue,
                  sizeof (nextObjlogIndexValue));
  FPOBJ_TRACE_EXIT (outlogEventIndex, owalogEventIndex);
  FPOBJ_TRACE_EXIT (outlogIndex, owalogIndex);
  return XLIBRC_SUCCESS;
}

#endif

/*******************************************************************************
* @function fpObjGet_baselogTable_logTime
*
* @purpose Get 'logTime'
*
* @description [logTime]:  The value of sysUpTime when this log entry was
*              created. 
*
* @return
*******************************************************************************/
xLibRC_t fpObjGet_baselogTable_logTime (void *wap, void *bufp)
{
  fpObjWa_t kwa1 = FPOBJ_INIT_WA (sizeof (xLibU32_t));
  xLibU32_t keylogEventIndexValue;
  fpObjWa_t kwa2 = FPOBJ_INIT_WA (sizeof (xLibU32_t));
  xLibU32_t keylogIndexValue;
  fpObjWa_t owa = FPOBJ_INIT_WA (sizeof (xLibU32_t));
  xLibU32_t objlogTimeValue;
  FPOBJ_TRACE_ENTER (bufp);

  /* retrieve key: logEventIndex */
  kwa1.rc = xLibFilterGet (wap, XOBJ_baselogTable_logEventIndex,
                           (xLibU8_t *) & keylogEventIndexValue, &kwa1.len);
  if (kwa1.l7rc != L7_SUCCESS)
  {
    kwa1.rc = XLIBRC_FAILURE;    /* TODO: Change if required */
    FPOBJ_TRACE_EXIT (bufp, kwa1);
    return kwa1.rc;
  }
  FPOBJ_TRACE_CURRENT_KEY (bufp, &keylogEventIndexValue, kwa1.len);

  /* retrieve key: logIndex */
  kwa2.rc = xLibFilterGet (wap, XOBJ_baselogTable_logIndex,
                           (xLibU8_t *) & keylogIndexValue, &kwa2.len);
  if (kwa2.l7rc != L7_SUCCESS)
  {
    kwa2.rc = XLIBRC_FAILURE;    /* TODO: Change if required */
    FPOBJ_TRACE_EXIT (bufp, kwa2);
    return kwa2.rc;
  }
  FPOBJ_TRACE_CURRENT_KEY (bufp, &keylogIndexValue, kwa2.len);

  /* get the value from application */
  owa.l7rc = usmDbLogTimeGet (L7_UNIT_CURRENT, keylogEventIndexValue,
                              keylogIndexValue, &objlogTimeValue);
  if (owa.l7rc != L7_SUCCESS)
  {
    owa.rc = XLIBRC_FAILURE;    /* TODO: Change if required */
    FPOBJ_TRACE_EXIT (bufp, owa);
    return owa.rc;
  }

  /* return the object value: logTime */
  owa.rc = xLibBufDataSet (bufp, (xLibU8_t *) & objlogTimeValue,
                           sizeof (objlogTimeValue));
  FPOBJ_TRACE_EXIT (bufp, owa);
  return owa.rc;
}


/*******************************************************************************
* @function fpObjGet_baselogTable_logDescription
*
* @purpose Get 'logDescription'
*
* @description [logDescription]:  An implementation dependent description
*              of the event that activated this log entry. 
*
* @return
*******************************************************************************/
xLibRC_t fpObjGet_baselogTable_logDescription (void *wap, void *bufp)
{
  fpObjWa_t kwa1 = FPOBJ_INIT_WA (sizeof (xLibU32_t));
  xLibU32_t keylogEventIndexValue;
  fpObjWa_t kwa2 = FPOBJ_INIT_WA (sizeof (xLibU32_t));
  xLibU32_t keylogIndexValue;
  fpObjWa_t owa = FPOBJ_INIT_WA (sizeof (xLibStr256_t));
  xLibStr256_t objlogDescriptionValue;
  FPOBJ_TRACE_ENTER (bufp);

  /* retrieve key: logEventIndex */
  kwa1.rc = xLibFilterGet (wap, XOBJ_baselogTable_logEventIndex,
                           (xLibU8_t *) & keylogEventIndexValue, &kwa1.len);
  if (kwa1.l7rc != L7_SUCCESS)
  {
    kwa1.rc = XLIBRC_FAILURE;    /* TODO: Change if required */
    FPOBJ_TRACE_EXIT (bufp, kwa1);
    return kwa1.rc;
  }
  FPOBJ_TRACE_CURRENT_KEY (bufp, &keylogEventIndexValue, kwa1.len);

  /* retrieve key: logIndex */
  kwa2.rc = xLibFilterGet (wap, XOBJ_baselogTable_logIndex,
                           (xLibU8_t *) & keylogIndexValue, &kwa2.len);
  if (kwa2.l7rc != L7_SUCCESS)
  {
    kwa2.rc = XLIBRC_FAILURE;    /* TODO: Change if required */
    FPOBJ_TRACE_EXIT (bufp, kwa2);
    return kwa2.rc;
  }
  FPOBJ_TRACE_CURRENT_KEY (bufp, &keylogIndexValue, kwa2.len);

  /* get the value from application */
  owa.l7rc = usmDbLogDescriptionGet (L7_UNIT_CURRENT, keylogEventIndexValue,
                                     keylogIndexValue, objlogDescriptionValue);
  if (owa.l7rc != L7_SUCCESS)
  {
    owa.rc = XLIBRC_FAILURE;    /* TODO: Change if required */
    FPOBJ_TRACE_EXIT (bufp, owa);
    return owa.rc;
  }

  (void)stripQuotes(objlogDescriptionValue);
  /* return the object value: logDescription */
  owa.rc = xLibBufDataSet (bufp, (xLibU8_t *) objlogDescriptionValue,
                           strlen (objlogDescriptionValue));
  FPOBJ_TRACE_EXIT (bufp, owa);
  return owa.rc;
}
