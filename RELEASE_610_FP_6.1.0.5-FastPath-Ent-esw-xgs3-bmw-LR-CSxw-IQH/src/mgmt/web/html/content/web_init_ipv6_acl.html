<HTML>
<EMWEB_IF ID="USMWEB_IF_QOS_PACKAGE">
<EMWEB_HEAD C='
    #include <stdio.h>
    #include <stdlib.h>
    #include "l7_common.h"
    #include "log.h"
    #include "web.h"
    #include "ewnet.h"
    #include "usmdb_qos_acl_api.h"

    /* ---------------------------------------------------------------------- */              
    /*  ipv6_acl_cfg.html                                                     */
    /* ---------------------------------------------------------------------- */              
    extern L7_char8 *usmWebGetIPv6ACLDetails();
    
    /* ---------------------------------------------------------------------- */              
    /*  ipv6_acl_summ.html                                                     */
    /* ---------------------------------------------------------------------- */              
    L7_char8 *usmWebIPv6ACLInfoGet(L7_uint32 unit, L7_uint32 aclId);
    '>

<EMWEB_IF ID=USMWEB_IF_IPV6_ACL_CREATE C='
  #ifdef L7_QOS_PACKAGE
    EwaNetHandle      net;
    usmWeb_AppInfo_t  appInfo;
    L7_uint32         aclId;
    L7_uint32         unit;

    unit = usmDbThisUnitGet();
    net = ewsContextNetHandle(ewsContext);
    if (net->app_pointer != L7_NULL)
    {
	    memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
        if (appInfo.data[0] == (L7_MAX_ACL_ID + 3))  /* acl create */
        {
            return "CREATE_IPV6_ACL";
        }
        else
        {
            return NULL;
        }
    }
    else
    {
        if (usmDbQosAclNamedIndexGetFirst(unit, L7_ACL_TYPE_IPV6, &aclId)==L7_SUCCESS)
        {
            return NULL;
        }
        else
        {
            return "CREATE_IPV6_ACL";
        }
    }
	return "CREATE_IPV6_ACL";
	#endif
  '>
</EMWEB_IF>


<EMWEB_IF ID=USMWEB_IF_IPV6_ACL_EXISTS C='
  #ifdef L7_QOS_PACKAGE
  L7_uint32 aclId=0;
  L7_uint32 unit = usmDbThisUnitGet();

  if (usmDbQosAclNamedIndexGetFirst(unit, L7_ACL_TYPE_IPV6, &aclId)==L7_SUCCESS)
  {
        return "IPV6_ACL_EXISTS";
  }
  else
  {
        return NULL;
  }
#endif
  return NULL;
   '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_IPV6_ACL_RULE_CREATE C='
  #ifdef L7_QOS_PACKAGE

  EwaNetHandle      net = ewsContextNetHandle(ewsContext);
  usmWeb_AppInfo_t  appInfo;
  static L7_uint32  aclId, rule, unit, tempRule=0;

  unit = usmDbThisUnitGet();
  if (net->app_pointer != L7_NULL)
  {
	memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
    aclId = appInfo.data[0];
    tempRule = appInfo.data[1];
    if ((usmDbQosAclRuleGetFirst(unit, aclId, &rule) != L7_SUCCESS) || 
        (tempRule > L7_ACL_MAX_RULE_NUM))  
    {
       return "CREATE";
    }
    else
    {
       return NULL;   
    }
  }
  
  if (usmDbQosAclNamedIndexGetFirst(unit, L7_ACL_TYPE_IPV6, &aclId) == L7_SUCCESS)
  {
      if (usmDbQosAclRuleGetFirst(unit, aclId, &rule) == L7_SUCCESS)
      {
        return NULL;  
      }
  }
  return "CREATE";
#endif
'>
</EMWEB_IF>



<EMWEB_IF ID=USMWEB_IPV6_ACL_RULE_LOGGING_ALLOWED_FOR_ACTION C='
  #ifdef L7_QOS_PACKAGE
   EwaNetHandle     net = ewsContextNetHandle(ewsContext);
   usmWeb_AppInfo_t appInfo;
   L7_uint32        aclId, ruleId, 
                    featureId=L7_ACL_LOG_DENY_FEATURE_ID,
                    unit = usmDbThisUnitGet();
   L7_RC_t          rc;
   L7_ACL_ACTION_t  action=L7_ACL_DENY;
   
   if (net->app_pointer != L7_NULL)
   {
     memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
     aclId = appInfo.data[0];
     ruleId = appInfo.data[1];     
     rc = L7_SUCCESS;
   }
   else
   {
     if((rc=usmDbQosAclNamedIndexGetFirst(unit, L7_ACL_TYPE_IPV6, &aclId)) == L7_SUCCESS)
     {
       rc = usmDbQosAclRuleGetFirst(unit, aclId, &ruleId);
     }
   }
   
   if (rc==L7_SUCCESS)
   {
     if ( (rc == usmDbQosAclRuleActionGet(unit, aclId, ruleId, &action)) == L7_SUCCESS)
     {
        switch(action)
        {  
          case L7_ACL_PERMIT:  
            featureId = L7_ACL_LOG_PERMIT_FEATURE_ID;
            break;
          case L7_ACL_DENY: 
            featureId = L7_ACL_LOG_DENY_FEATURE_ID;
            break;
          default: 
            return NULL;
        }
     }
   }
   if (rc != L7_SUCCESS)
   {
      return NULL;
   }
   
   if (usmDbFeaturePresentCheck(unit, L7_FLEX_QOS_ACL_COMPONENT_ID, featureId) == L7_TRUE)
   {
     return "ACL LOGGING ALLOWED";
   }
#endif         
   return NULL;
   '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IPV6_ACL_REDIRECT_INTF_IS_SET C='
  #ifdef L7_QOS_PACKAGE
  EwaNetHandle      net = ewsContextNetHandle(ewsContext);
  usmWeb_AppInfo_t  appInfo;
  L7_uint32         aclId, ruleId, 
                    unit = usmDbThisUnitGet(), 
                    intIfNum;
  L7_RC_t           rc;
  
  if (net->app_pointer != L7_NULL)
  {
	memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
    
    aclId = appInfo.data[0];
    ruleId = appInfo.data[1];
  }
  else
  {
    if((rc=usmDbQosAclNamedIndexGetFirst(unit, L7_ACL_TYPE_IPV6, &aclId)) == L7_SUCCESS)
    {
      rc = usmDbQosAclRuleGetFirst(unit, aclId, &ruleId);
    }

    if (rc != L7_SUCCESS)
    {
      return NULL;
    }
  }

  if (usmDbQosAclRuleRedirectIntfGet(unit, aclId, ruleId, &intIfNum) == L7_SUCCESS)
  {
    return "IPV6 ACL REDIRECT IS SET";
  }
#endif        
  return NULL;
'>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IPV6_ACL_MIRROR_INTF_IS_SET C='
  #ifdef L7_QOS_PACKAGE
  EwaNetHandle      net = ewsContextNetHandle(ewsContext);
  usmWeb_AppInfo_t  appInfo;
  L7_uint32         aclId, ruleId,
                    unit = usmDbThisUnitGet(),
                    intIfNum;
  L7_RC_t           rc;
    
  if (net->app_pointer != L7_NULL)
  {
	memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
    aclId = appInfo.data[0];
    ruleId = appInfo.data[1];
  }
  else
  {
    if ((rc=usmDbQosAclNamedIndexGetFirst(unit, L7_ACL_TYPE_IPV6, &aclId)) == L7_SUCCESS)
    {
      rc = usmDbQosAclRuleGetFirst(unit, aclId, &ruleId);
    }

    if (rc != L7_SUCCESS)
    {
      return NULL;
    }
  }

  if (usmDbQosAclRuleMirrorIntfGet(unit, aclId, ruleId, &intIfNum) == L7_SUCCESS)
  {
    return "ACL MIRROR IS SET";
  }
        
  return NULL;
  #endif
   '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IPV6_MATCH_EVERY_IS_FALSE C='
  #ifdef L7_QOS_PACKAGE
    usmWeb_AppInfo_t appInfo;
    EwaNetHandle     net = ewsContextNetHandle(ewsContext);
    L7_uint32        aclId = 0, ruleId = 0,        
                     unit = usmDbThisUnitGet();
    L7_BOOL          setEvery = L7_FALSE;
            
    if (net->app_pointer != L7_NULL)
    {
      memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
      aclId = appInfo.data[0];
      ruleId = appInfo.data[1];
    }
    else
    {
      if (usmDbQosAclNamedIndexGetFirst(unit, L7_ACL_TYPE_IPV6, &aclId) == L7_SUCCESS)
      {
        if(usmDbQosAclRuleGetFirst(unit, aclId, &ruleId) != L7_SUCCESS)
        {
          return NULL;    
        }
      }
    }
                        
    if((usmDbQosAclRuleEveryGet(unit, aclId, ruleId, &setEvery) == L7_SUCCESS) && (setEvery == L7_FALSE))
    {
      return "DISPLAY_OTHER_FIELDS";
    }
    else
    {    
      return NULL;
    }
#endif
'>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IPV6_MATCH_PROTOCOL_IS_OTHER C='
  #ifdef L7_QOS_PACKAGE
        EwaNetHandle net;
        usmWeb_AppInfo_t appInfo;
    
         net = ewsContextNetHandle(ewsContext);  
        if (net->app_pointer != NULL)
        {
          memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
          if (appInfo.data[2] != 0)
          {
            return "TRUE";
          }
          else
          {
            return NULL;
            }
        }
        
        return NULL;
#endif                  
  '>
</EMWEB_IF>

<EMWEB_IF ID=USMWEB_IF_IPV6_ACTION_IS_PERMIT C='
  #ifdef L7_QOS_PACKAGE
  EwaNetHandle      net = ewsContextNetHandle(ewsContext);
  usmWeb_AppInfo_t  appInfo;
  L7_uint32 aclId,  ruleId;
  L7_uint32         unit = usmDbThisUnitGet();
  L7_ACL_ACTION_t   action = L7_ACL_DENY;
  
  if (net->app_pointer != L7_NULL)
  {
	memcpy(&appInfo, net->app_pointer, sizeof(usmWeb_AppInfo_t));
    aclId = appInfo.data[0];
    ruleId = appInfo.data[1];
  }
  else
  {
    if(usmDbQosAclNamedIndexGetFirst(unit, L7_ACL_TYPE_IPV6, &aclId) == L7_SUCCESS)
    {
      if(usmDbQosAclRuleGetFirst(unit, aclId, &ruleId) != L7_SUCCESS)
      {
        return L7_NULL;
      }
    }
    else 
    {
      return L7_NULL;
    }
  }
  
  if(usmDbQosAclRuleActionGet(unit, aclId, ruleId, &action) == L7_SUCCESS)
  {
    switch(action)
    {
      case L7_ACL_PERMIT:
         return "PERMIT";
      case L7_ACL_DENY: 
      default: 
         return NULL;
    }
  }
#endif  
  return NULL;
  
 '>
</EMWEB_IF>
</EMWEB_IF>
</HTML>


